const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/dictionaryService-w9KxFbS3.js","assets/index-71oJ6HSp.js","assets/supabase-DyVhUiSk.js","assets/vendor-D_9pIZtk.js","assets/ui-BYU4eA_z.js","assets/index-t0CJZ8Ri.css","assets/sampleService-BBJxm_Pu.js"])))=>i.map(i=>d[i]);
var aa=Object.defineProperty;var oa=(n,t,r)=>t in n?aa(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r;var pe=(n,t,r)=>oa(n,typeof t!="symbol"?t+"":t,r);import{u as ca,r as W,a as H,j as e,P as O,B as x,T as l,b as A,C as ge,A as je,c as Fr,d as rt,G as j,L as we,e as me,f as xe,g as _e,I as $e,M as Sn,S as Ln,D as ie,F as pr,h as Nr,i as wr,k as Pn,l as ft,m as Ce,n as la,o as da,p as Ct,q as he,s as wt,t as Zi,v as mr,w as xr,x as ua,y as nn,z as ha,E as gt,H as Mn,J as qe,Z as ga,K as fa,N as pa,O as ma,Q as Ji,R as kr,U as Se,V as xa,W as Wr,X as va,Y as jn,_ as _n,$ as wn,a0 as Ki,a1 as Xi,a2 as es,a3 as vr,a4 as ae,a5 as ts,a6 as kn,a7 as sn,a8 as ya,a9 as ba,aa as Sa,ab as ja,ac as _a}from"./ui-BYU4eA_z.js";import{g as wa,b as G,a as g,c as Z,e as ka,u as mt,N as Fe,h as Ze,L as U,i as rs,H as Ea,j as Ca,k as ce}from"./vendor-D_9pIZtk.js";import{a as c}from"./index-71oJ6HSp.js";import{c as Tn,_ as be}from"./supabase-DyVhUiSk.js";var Rt={},an={};const Ra=wa(ca);var Bn;function Y(){return Bn||(Bn=1,function(n){"use client";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"default",{enumerable:!0,get:function(){return t.createSvgIcon}});var t=Ra}(an)),an}var Un;function Ia(){if(Un)return Rt;Un=1;var n=W();Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.default=void 0;var t=n(Y()),r=H();return Rt.default=(0,t.default)((0,r.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),Rt}var Aa=Ia();const Kr=G(Aa);var It={},Vn;function Pa(){if(Vn)return It;Vn=1;var n=W();Object.defineProperty(It,"__esModule",{value:!0}),It.default=void 0;var t=n(Y()),r=H();return It.default=(0,t.default)((0,r.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"Refresh"),It}var Ta=Pa();const Da=G(Ta);var At={},Fn;function Oa(){if(Fn)return At;Fn=1;var n=W();Object.defineProperty(At,"__esModule",{value:!0}),At.default=void 0;var t=n(Y()),r=H();return At.default=(0,t.default)((0,r.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckCircle"),At}var $a=Oa();const yr=G($a);var Pt={},Nn;function za(){if(Nn)return Pt;Nn=1;var n=W();Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.default=void 0;var t=n(Y()),r=H();return Pt.default=(0,t.default)((0,r.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-2h2zm0-4h-2V7h2z"}),"Error"),Pt}var qa=za();const Hr=G(qa);var Tt={},Wn;function La(){if(Wn)return Tt;Wn=1;var n=W();Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.default=void 0;var t=n(Y()),r=H();return Tt.default=(0,t.default)((0,r.jsx)("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"}),"Warning"),Tt}var Ma=La();const ns=G(Ma);var Dt={},Hn;function Ba(){if(Hn)return Dt;Hn=1;var n=W();Object.defineProperty(Dt,"__esModule",{value:!0}),Dt.default=void 0;var t=n(Y()),r=H();return Dt.default=(0,t.default)((0,r.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-6h2zm0-8h-2V7h2z"}),"Info"),Dt}var Ua=Ba();const Va=G(Ua);let Fa=class{constructor(){pe(this,"services",{})}register(t,r){this.services[t]=r,c("ServiceRegistry",`Service "${t}" registered successfully`,"info"),console.log(`Service "${t}" registered successfully`)}get(t){if(!this.services[t])throw c("ServiceRegistry",`Service "${t}" not registered`,"error"),console.error(`Service "${t}" not registered`),new Error(`Service "${t}" not registered`);return this.services[t]}has(t){return!!this.services[t]}listServices(){return Object.keys(this.services)}async getOrInitialize(t,r){return this.has(t)?this.get(t):(await r.initializeService(t),this.get(t))}async withService(t,r,i){const s=await this.getOrInitialize(t,i);return r(s)}};const Na=new Fa,Ue={ALICE:"alice-in-wonderland"},Wa={CHAT:"chat",DEFINITION:"definition",ANALYSIS:"analysis",SUMMARY:"summary"},K={AUTH_SERVICE:"authService",BOOK_SERVICE:"bookService",AI_SERVICE:"aiService",DICTIONARY_SERVICE:"dictionaryService",FEEDBACK_SERVICE:"feedbackService",TRIGGER_SERVICE:"triggerService",STATISTICS_SERVICE:"statisticsService",CONSULTANT_SERVICE:"consultantService",INTERACTION_SERVICE:"interactionService",MONITORING_SERVICE:"monitoringService",DATABASE_SERVICE:"databaseService",ANALYTICS_SERVICE:"analyticsService",SAMPLE_SERVICE:"sampleService"};var Qe=(n=>(n.UNKNOWN_ERROR="UNKNOWN_ERROR",n.NETWORK_ERROR="NETWORK_ERROR",n.TIMEOUT_ERROR="TIMEOUT_ERROR",n.SERVICE_ERROR="SERVICE_ERROR",n.SERVICE_UNAVAILABLE="SERVICE_UNAVAILABLE",n.SERVICE_INITIALIZATION_ERROR="SERVICE_INITIALIZATION_ERROR",n.AUTH_ERROR="AUTH_ERROR",n.UNAUTHORIZED="UNAUTHORIZED",n.DATA_ERROR="DATA_ERROR",n.NOT_FOUND="NOT_FOUND",n.VALIDATION_ERROR="VALIDATION_ERROR",n.SUPABASE_ERROR="SUPABASE_ERROR",n.SUPABASE_QUERY_ERROR="SUPABASE_QUERY_ERROR",n.SUPABASE_AUTH_ERROR="SUPABASE_AUTH_ERROR",n.API_ERROR="API_ERROR",n.API_RATE_LIMIT="API_RATE_LIMIT",n))(Qe||{});class le extends Error{constructor(t,r,i,s,a){super(t),this.code=r,this.details=i,this.retry=s,this.originalError=a,this.name="AppError",Error.captureStackTrace&&Error.captureStackTrace(this,le),c("AppError",t,"error",{code:r,details:i,retry:s,stack:this.stack})}toJSON(){return{name:this.name,message:this.message,code:this.code,details:this.details,retry:this.retry,stack:this.stack}}}function q(n,t,r){return console.error(`${t}.${r} error:`,n),n instanceof le?n:n!=null&&n.code&&(n!=null&&n.message)&&(n!=null&&n.details)?new le(`${t}.${r}: ${n.message}`,`SUPABASE_${n.code}`,{serviceName:t,operation:r,details:n.details},Ha(n),n):is(n)?new le(`${t}.${r}: Network error`,"NETWORK_ERROR",{serviceName:t,operation:r},!0,n):ss(n)?new le(`${t}.${r}: Request timed out`,"TIMEOUT_ERROR",{serviceName:t,operation:r},!0,n):new le(n.message||`Error in ${t}.${r}`,"SERVICE_ERROR",{serviceName:t,operation:r},!1,n)}function is(n){var r;if(!n)return!1;if(n.name==="NetworkError")return!0;const t=((r=n.message)==null?void 0:r.toLowerCase())||"";return t.includes("network")||t.includes("internet")||t.includes("offline")||t.includes("connection")||t.includes("unreachable")}function ss(n){var r;if(!n)return!1;if(n.name==="TimeoutError")return!0;const t=((r=n.message)==null?void 0:r.toLowerCase())||"";return t.includes("timeout")||t.includes("timed out")}function Ha(n){return n?!!(is(n)||ss(n)||n.status&&n.status>=500&&n.status<600||n.code==="503"):!1}const ht=class ht{constructor(){pe(this,"services",{});pe(this,"initializers",new Map);pe(this,"initializationInProgress",new Map)}static getInstance(){return ht.instance||(ht.instance=new ht),ht.instance}register(t,r){this.services[t]=r,c("ServiceRegistry",`Service "${t}" registered successfully`,"info")}registerInitializer(t,r){this.initializers.set(t,r),c("ServiceRegistry",`Initializer for service "${t}" registered successfully`,"info")}get(t){if(!this.has(t)){const r=new le(`Service "${t}" not registered`,Qe.SERVICE_ERROR,{serviceName:t});throw c("ServiceRegistry",r.message,"error"),r}return this.services[t]}async getService(t){if(this.has(t))return this.get(t);if(this.initializationInProgress.has(t))return c("ServiceRegistry",`Waiting for service "${t}" initialization to complete`,"info"),await this.initializationInProgress.get(t),this.get(t);if(!this.hasInitializer(t)){const r=new le(`No initializer registered for service "${t}"`,Qe.SERVICE_INITIALIZATION_ERROR,{serviceName:t});throw c("ServiceRegistry",r.message,"error"),r}try{c("ServiceRegistry",`Initializing service "${t}"`,"info");const r=this.initializers.get(t),i=(async()=>{try{const s=await r();return this.register(t,s),s}catch(s){const a=s instanceof le?s:new le(`Failed to initialize service "${t}": ${s instanceof Error?s.message:String(s)}`,Qe.SERVICE_INITIALIZATION_ERROR,{serviceName:t,originalError:s});throw c("ServiceRegistry",a.message,"error"),a}finally{this.initializationInProgress.delete(t)}})();return this.initializationInProgress.set(t,i),await i,this.get(t)}catch(r){throw r}}has(t){return!!this.services[t]}hasInitializer(t){return this.initializers.has(t)}listServices(){return Object.keys(this.services)}listInitializers(){return Array.from(this.initializers.keys())}async withService(t,r){const i=await this.getService(t);return r(i)}async getOrInitialize(t,r){if(c("ServiceRegistry","Warning: getOrInitialize is deprecated, use getService instead","warning"),this.has(t))return this.get(t);try{return this.hasInitializer(t)?await this.getService(t):(await r.initializeService(t),this.get(t))}catch(i){const s=i instanceof le?i:new le(`Failed to initialize service "${t}": ${i instanceof Error?i.message:String(i)}`,Qe.SERVICE_INITIALIZATION_ERROR,{serviceName:t,originalError:i});throw c("ServiceRegistry",s.message,"error"),s}}};pe(ht,"instance");let En=ht;const M=En.getInstance(),nt={authService:[],bookService:["authService"],dictionaryService:["bookService"],aiService:["bookService","dictionaryService"],feedbackService:["authService","bookService"],triggerService:["authService","bookService"],statisticsService:["bookService","authService"],consultantService:["authService","bookService","feedbackService","triggerService"],interactionService:["authService","bookService"],monitoringService:[],databaseService:["authService"],analyticsService:[],sampleService:["bookService"]};function Ga(){c("ServiceDependencies","Service dependency graph:","info"),Object.entries(nt).forEach(([n,t])=>{c("ServiceDependencies",`${n} depends on: ${t.join(", ")||"none"}`,"debug")})}function as(){const n=new Set,t=[],r=new Set;function i(s){if(r.has(s)){const o=Array.from(r).join(" -> ")+` -> ${s}`;c("InitOrder",`Circular dependency detected: ${o}`,"error"),console.error(`Circular dependency detected: ${o}`);return}if(n.has(s))return;r.add(s);const a=nt[s]||[];for(const o of a)i(o);n.add(s),r.delete(s),t.push(s)}for(const s of Object.keys(nt))n.has(s)||i(s);return c("InitOrder",`Initialization order: ${t.join(", ")}`,"info"),t}class Ya{constructor(){pe(this,"initFunctions",new Map);pe(this,"dependencies",new Map);pe(this,"initialized",new Set);pe(this,"initializing",new Set)}register(t,r,i){console.log(`Registering initialization function for ${t}`),this.initFunctions.set(t,r);const s=i||nt[t]||[];this.dependencies.set(t,s),c("ServiceInitManager",`Registered initialization function for ${t}`,"info"),console.log(`Available services for initialization: ${Array.from(this.initFunctions.keys()).join(", ")}`)}async initializeService(t){if(console.log(`Attempting to initialize service: ${t}`),this.initialized.has(t)){c("ServiceInitManager",`Service ${t} already initialized`,"info"),console.log(`Service ${t} already initialized`);return}if(this.initializing.has(t)){c("ServiceInitManager",`Circular initialization detected for service: ${t}`,"warning"),console.warn(`Circular initialization detected for service: ${t}`);return}if(!this.initFunctions.has(t))throw console.error(`No initialization function registered for service: ${t}`),console.error(`Available services: ${Array.from(this.initFunctions.keys()).join(", ")}`),c("ServiceInitManager",`No initialization function registered for service: ${t}`,"error"),new Error(`No initialization function registered for service: ${t}`);c("ServiceInitManager",`Initializing service: ${t}`,"info"),console.log(`Initializing service: ${t}`),this.initializing.add(t);const r=this.dependencies.get(t)||[];for(const i of r)await this.initializeService(i);try{console.log(`Executing initialization function for ${t}`),await this.initFunctions.get(t)(),this.initialized.add(t),c("ServiceInitManager",`Service ${t} initialized successfully`,"success"),console.log(`Service ${t} initialized successfully`)}catch(i){throw c("ServiceInitManager",`Error initializing service ${t}: ${i.message}`,"error"),console.error(`Error initializing service ${t}:`,i),i}finally{this.initializing.delete(t)}}async initializeAll(t={}){c("ServiceInitManager","Initializing all services","info"),console.log("Initializing all services");let r;t.useTopologicalOrder?(r=as().filter(i=>this.initFunctions.has(i)),c("ServiceInitManager",`Using topological order: ${r.join(", ")}`,"info")):(r=Array.from(this.initFunctions.keys()),c("ServiceInitManager",`Using registration order: ${r.join(", ")}`,"info")),console.log(`Services to initialize: ${r.join(", ")}`);for(const i of r)await this.initializeService(i);c("ServiceInitManager","All services initialized successfully","success"),console.log("All services initialized successfully")}isInitialized(t){return this.initialized.has(t)}getInitializedServices(){return Array.from(this.initialized)}hasInitFunction(t){return this.initFunctions.has(t)}getRegisteredServices(){return Array.from(this.initFunctions.keys())}}const ee=new Ya,Qa=()=>{try{const n=localStorage.getItem("proxy_settings");if(n){const t=JSON.parse(n);return{host:t.host||"",port:t.port||8080,auth:{username:t.username||"",password:t.password||""},enabled:t.enabled||!1}}}catch(n){console.error("Error loading proxy settings from localStorage:",n)}return{host:"",port:8080,auth:{username:"",password:""},enabled:!1}},ot=Qa(),Za=()=>ot.enabled?(console.log(`Using corporate proxy: ${ot.host}:${ot.port}`),(n,t)=>{console.log(`Proxying request to: ${n.toString()}`);const r=new Headers((t==null?void 0:t.headers)||{});if(ot.auth.username&&ot.auth.password){const s=btoa(`${ot.auth.username}:${ot.auth.password}`);r.set("Proxy-Authorization",`Basic ${s}`)}const i={...t,headers:r};return window.fetch(n,i)}):(console.log("Proxy is disabled, using standard fetch"),window.fetch.bind(window)),Ja=Za(),Xe=5,Gn=500,Ka=3e4,Xa=1e4,eo=()=>({supabaseUrl:"https://blwypdcobizmpidmuhvq.supabase.co",supabaseAnonKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJsd3lwZGNvYml6bXBpZG11aHZxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQyMDgzNDcsImV4cCI6MjA1OTc4NDM0N30.YP2r-CnSaM4rKclXBivanAMBQh9sMsI95F2p87zIuWM"});let Tr=null,Yn=0;const os=(n,t="Supabase")=>{n&&(typeof n=="string"?c("SupabaseClient",`${t}: ${n}`,"error"):n.message?c("SupabaseClient",`${t}: ${n.message}`,"error",{code:n.code,details:n.details}):c("SupabaseClient",`${t}: Unknown error format`,"error",n))},z=async()=>{const n=Date.now();try{if(!Tr||n-Yn>Ka){c("SupabaseClient","Initializing Supabase client",Tr?"info":"debug");const{supabaseUrl:t,supabaseAnonKey:r}=eo();Tr=Tn(t,r,{auth:{autoRefreshToken:!0,persistSession:!0},global:{fetch:Ja}}),Yn=n}return Tr}catch(t){throw os(t,"Client initialization"),t}},cs=async(n,t)=>{var a,o,d,h,u;let r=0,i=Gn;const s=Date.now();for(;r<Xe;)try{const f=Date.now();c("SupabaseClient",`Executing ${t} (attempt ${r+1}/${Xe})`,"debug");const m=await n(),v=Date.now()-f;return v>2e3?c("SupabaseClient",`${t} completed in ${v}ms (slow operation)`,"warning"):c("SupabaseClient",`${t} completed in ${v}ms`,"debug"),m}catch(f){r++;const m=((a=f.message)==null?void 0:a.includes("network"))||((o=f.message)==null?void 0:o.includes("timeout"))||((d=f.message)==null?void 0:d.includes("connection")),v=f.code==="429"||((h=f.message)==null?void 0:h.includes("rate limit"))||((u=f.message)==null?void 0:u.includes("too many requests")),b=Date.now()-s;if(b>5e3)throw c("SupabaseClient",`${t} taking too long (${b}ms) - giving up after ${r} attempts`,"error"),f;const p=r>=Xe?"error":"warning";if(c("SupabaseClient",`${t} attempt ${r}/${Xe} failed: ${f.message}`,p),os(f,`${t} (attempt ${r}/${Xe})`),r>=Xe)throw c("SupabaseClient",`${t} failed after ${Xe} attempts`,"error"),f;v?i=Math.min(i*1.5,Xa):i=Math.min(Gn*(r+.5),2e3),c("SupabaseClient",`Retrying ${t} in ${Math.round(i)}ms (${m?"network issue":v?"rate limit":"error"})`,"debug"),await new Promise(y=>setTimeout(y,i))}throw new Error(`Failed ${t} after ${Xe} retries`)};async function to(n,t){try{console.log("SupabaseClient: Using fast profile update for user:",n,t);const r=await z(),{data:i,error:s}=await r.rpc("fast_profile_update",{user_id:n,first_name:t.first_name||null,last_name:t.last_name||null,email:t.email||null,book_verified:t.book_verified===void 0?null:t.book_verified});if(s)throw console.error("SupabaseClient: Fast profile update failed:",s),s;return{data:i,error:null}}catch(r){return console.error("SupabaseClient: Error in fast profile update:",r),{data:null,error:r}}}async function ro(n,t,r,i){try{c("SupabaseClient",`Verifying book code: ${n} for user: ${t}`,"info"),console.log(`DEBUG: Verifying book code: ${n} for user: ${t}`),console.log(`DEBUG: First name: ${r}, Last name: ${i}`);const s=await z(),{data:a,error:o}=await s.from("verification_codes").select("*, books(id, title, author)").eq("code",n.toUpperCase()).single();if(console.log("DEBUG: Verification code check result:",{data:a,error:o}),o||!a)return c("SupabaseClient","Invalid verification code","error",o),console.log("DEBUG: Invalid verification code:",o),{success:!1,error:"Invalid verification code"};if(a.is_used)return c("SupabaseClient","Code already used","warning"),console.log("DEBUG: Code already used"),{success:!1,error:"This code has already been used"};const d=s.from("verification_codes").update({is_used:!0,used_by:t}).eq("code",n.toUpperCase()),h={book_verified:!0,...r?{first_name:r}:{},...i?{last_name:i}:{}};console.log("DEBUG: Profile updates to apply:",h);const u=to(t,h),[f,m]=await Promise.all([d,u]);return f.error?(c("SupabaseClient","Error updating verification code","error",f.error),console.log("DEBUG: Error updating verification code:",f.error),{success:!1,error:"Error updating verification code"}):m.error?(c("SupabaseClient","Error updating profile","error",m.error),console.log("DEBUG: Error updating profile:",m.error),{success:!1,error:`Profile update failed: ${String(m.error)}`,verificationStatus:"code_marked_used_profile_update_failed"}):(console.log("DEBUG: Profile updated successfully:",m.data),c("SupabaseClient","Book code verified successfully","success"),{success:!0,data:a})}catch(s){return c("SupabaseClient","Error verifying book code","error",s),console.log("DEBUG: Error verifying book code:",s),{success:!1,error:"Error verifying book code"}}}const no=async(n=!1)=>{try{c("SupabaseClient","Checking Supabase connection","info");const t=await z(),{data:r,error:i}=await t.from("books").select("id").limit(1);return i?(c("SupabaseClient",`Supabase connection check failed: ${i.message}`,"error"),!1):(c("SupabaseClient","Supabase connection check successful","success"),!0)}catch(t){return c("SupabaseClient",`Supabase connection check error: ${t instanceof Error?t.message:String(t)}`,"error"),!1}},Ve=[{id:"550e8400-e29b-41d4-a716-446655440000",title:"Alice in Wonderland",author:"Lewis Carroll",description:"The classic tale of a girl who falls through a rabbit hole into a fantasy world.",cover_image_url:null,total_pages:100,created_at:new Date().toISOString(),chapters:[{id:"c1",book_id:"550e8400-e29b-41d4-a716-446655440000",title:"Down the Rabbit-Hole",number:1,created_at:new Date().toISOString(),sections:[{id:"s1",chapter_id:"c1",title:"Beginning",content:'Alice was beginning to get very tired of sitting by her sister on the bank, and of having nothing to do: once or twice she had peeped into the book her sister was reading, but it had no pictures or conversations in it, "and what is the use of a book," thought Alice "without pictures or conversations?"',start_page:1,end_page:3,number:1,created_at:new Date().toISOString()},{id:"s2",chapter_id:"c1",title:"The Rabbit",content:'There was nothing so very remarkable in that; nor did Alice think it so very much out of the way to hear the Rabbit say to itself, "Oh dear! Oh dear! I shall be late!" (when she thought it over afterwards, it occurred to her that she ought to have wondered at this, but at the time it all seemed quite natural).',start_page:4,end_page:6,number:2,created_at:new Date().toISOString()},{id:"s3",chapter_id:"c1",title:"Down the Hole",content:"In another moment down went Alice after it, never once considering how in the world she was to get out again. The rabbit-hole went straight on like a tunnel for some way, and then dipped suddenly down, so suddenly that Alice had not a moment to think about stopping herself before she found herself falling down a very deep well.",start_page:7,end_page:10,number:3,created_at:new Date().toISOString()}]},{id:"c2",book_id:"550e8400-e29b-41d4-a716-446655440000",title:"The Pool of Tears",number:2,created_at:new Date().toISOString(),sections:[{id:"s4",chapter_id:"c2",title:"Curiouser and Curiouser",content:`"Curiouser and curiouser!" cried Alice (she was so much surprised, that for the moment she quite forgot how to speak good English); "now I'm opening out like the largest telescope that ever was! Good-bye, feet!"`,start_page:11,end_page:14,number:1,created_at:new Date().toISOString()},{id:"s5",chapter_id:"c2",title:"The White Rabbit Again",content:`And she went on planning to herself how she would manage it. "They must go by the carrier," she thought; "and how funny it'll seem, sending presents to one's own feet!"`,start_page:15,end_page:18,number:2,created_at:new Date().toISOString()}]},{id:"c3",book_id:"550e8400-e29b-41d4-a716-446655440000",title:"A Caucus-Race and a Long Tale",number:3,created_at:new Date().toISOString(),sections:[{id:"s6",chapter_id:"c3",title:"The Mouse",content:'"O Mouse, do you know the way out of this pool? I am very tired of swimming about here, O Mouse!" Alice thought this must be the right way of speaking to a mouse.',start_page:19,end_page:22,number:1,created_at:new Date().toISOString()},{id:"s7",chapter_id:"c3",title:"The Caucus-Race",content:"They were indeed a queer-looking party that assembled on the bank—the birds with draggled feathers, the animals with their fur clinging close to them, and all dripping wet, cross, and uncomfortable.",start_page:23,end_page:26,number:2,created_at:new Date().toISOString()}]}]}],ct=[{code:"ALICE123",book_id:"550e8400-e29b-41d4-a716-446655440000",is_used:!1,used_by:null,created_at:new Date().toISOString(),books:{id:"550e8400-e29b-41d4-a716-446655440000",title:"Alice in Wonderland",author:"Lewis Carroll"}},{code:"WONDERLAND",book_id:"550e8400-e29b-41d4-a716-446655440000",is_used:!1,used_by:null,created_at:new Date().toISOString(),books:{id:"550e8400-e29b-41d4-a716-446655440000",title:"Alice in Wonderland",author:"Lewis Carroll"}}],io={alice:"The main character of the story, a curious young girl.",rabbit:"A white rabbit with pink eyes that Alice follows down the rabbit hole.",wonderland:"The magical world Alice discovers after falling down the rabbit hole.",curiouser:'A made-up comparative form of "curious" that Alice uses, showing her confusion and wonder.',telescope:"Used as a metaphor for Alice growing taller, comparing her body to an extending telescope.","caucus-race":"A race with no clear rules or winner, used as a method to get dry after being soaked in tears.",mouse:'A character Alice meets in the pool of tears who tells a "dry" tale to help everyone get dry.',"pool of tears":"A body of water created by Alice's giant tears when she was 9 feet tall."},Dr={},et={},Oe={},on=[],so=[{id:"prompt1",prompt_text:"What did you find most interesting about this chapter?",prompt_type:"reflection",active:!0,created_at:new Date().toISOString()},{id:"prompt2",prompt_text:"Which character do you relate to most and why?",prompt_type:"character",active:!0,created_at:new Date().toISOString()}],Qn=[],cn=[],lt=[],Or=[],He=[],Zn=[];let tt=null,yt=null;const ne={auth:{getUser:()=>tt,getSession:()=>({data:{session:yt},error:null}),signIn:(n,t)=>(tt={id:"mock-user-id",email:n,aud:"authenticated",role:"authenticated",created_at:new Date().toISOString()},yt={access_token:"mock-access-token",refresh_token:"mock-refresh-token",expires_at:Date.now()+3600,user:tt},{data:{user:tt,session:yt},error:null}),signUp:(n,t,r,i)=>(tt={id:"mock-user-id",email:n,aud:"authenticated",role:"authenticated",created_at:new Date().toISOString(),user_metadata:r&&i?{first_name:r,last_name:i}:{}},yt={access_token:"mock-access-token",refresh_token:"mock-refresh-token",expires_at:Date.now()+3600,user:tt},r&&i&&(Oe["mock-user-id"]={id:"mock-user-id",first_name:r,last_name:i,email:n,is_consultant:!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}),{data:{user:tt,session:yt},error:null}),signOut:()=>(tt=null,yt=null,{error:null}),onAuthStateChange:n=>({data:{subscription:{unsubscribe:()=>{}}}})},profiles:{getUserProfile:n=>({data:Oe[n]||null,error:null}),createUserProfile:(n,t,r,i)=>{const s={id:n,first_name:t,last_name:r,email:i,is_consultant:!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return Oe[n]=s,{data:s,error:null}},updateUserProfile:(n,t)=>Oe[n]?(Oe[n]={...Oe[n],...t,updated_at:new Date().toISOString()},{data:Oe[n],error:null}):{data:null,error:{message:"Profile not found"}}},books:{getBookContent:n=>({data:Ve.find(r=>r.id===n),error:null}),getAllBooks:()=>({data:Ve.map(n=>({id:n.id,title:n.title,author:n.author,description:n.description,cover_image_url:n.cover_image_url,total_pages:n.total_pages,created_at:n.created_at})),error:null}),getSectionsForPage:(n,t)=>{const r=Ve.find(s=>s.id===n);if(!r)return{data:[],error:null};const i=[];return r.chapters.forEach(s=>{s.sections.forEach(a=>{t>=a.start_page&&t<=a.end_page&&i.push({...a,chapter_title:s.title,chapter_number:s.number})})}),{data:i,error:null}},getDefinition:(n,t,r,i)=>({data:io[t.toLowerCase()]||null,error:null}),verifyBookCode:n=>{const t=ct.find(i=>i.code===n.toUpperCase());if(t)return{data:t,error:null};const r={code:n.toUpperCase(),book_id:"550e8400-e29b-41d4-a716-446655440000",is_used:!1,used_by:null,created_at:new Date().toISOString(),books:{id:"550e8400-e29b-41d4-a716-446655440000",title:"Alice in Wonderland",author:"Lewis Carroll"}};return ct.push(r),{data:r,error:null}},markCodeAsUsed:(n,t)=>{const r=ct.findIndex(i=>i.code===n.toUpperCase());if(r===-1){const i={code:n.toUpperCase(),book_id:"550e8400-e29b-41d4-a716-446655440000",is_used:!0,used_by:t,created_at:new Date().toISOString(),books:{id:"550e8400-e29b-41d4-a716-446655440000",title:"Alice in Wonderland",author:"Lewis Carroll"}};return ct.push(i),{data:i,error:null}}return ct[r]={...ct[r],is_used:!0,used_by:t},{data:ct[r],error:null}}},progress:{saveReadingProgress:(n,t,r,i)=>{var o;const s=`${n}:${t}`,a=new Date().toISOString();return Dr[s]={id:`progress-${s}`,user_id:n,book_id:t,section_id:r,last_position:i||null,last_read_at:a,created_at:((o=Dr[s])==null?void 0:o.created_at)||a,updated_at:a},{data:Dr[s],error:null}},getReadingProgress:(n,t)=>{const r=`${n}:${t}`,i=Dr[r];if(!i)return{data:null,error:null};const s=Ve.find(h=>h.id===t);if(!s)return{data:null,error:{message:"Book not found"}};let a="",o="",d=0;for(const h of s.chapters){const u=h.sections.find(f=>f.id===i.section_id);if(u){a=u.title,o=h.title,d=u.start_page;break}}return{data:{section_id:i.section_id,last_position:i.last_position,section_title:a,chapter_title:o,page_number:d},error:null}},updateReadingStats:(n,t,r,i)=>{const s=`${n}:${t}`,a=new Date().toISOString();return et[s]?et[s]={...et[s],total_reading_time:et[s].total_reading_time+r,pages_read:Math.max(et[s].pages_read,i),last_session_date:a,updated_at:a}:et[s]={id:`stats-${s}`,user_id:n,book_id:t,total_reading_time:r,pages_read:i,last_session_date:a,created_at:a,updated_at:a},{data:et[s],error:null}},getReadingStats:(n,t)=>{const r=`${n}:${t}`,i=et[r];if(!i)return{data:null,error:null};const s=Ve.find(a=>a.id===t);return s?{data:{...i,percentage_complete:Math.round(i.pages_read/s.total_pages*100)},error:null}:{data:null,error:{message:"Book not found"}}}},ai:{saveAiInteraction:(n,t,r,i,s,a)=>{const o={id:`ai-${on.length+1}`,user_id:n,book_id:t,section_id:s||null,question:r,context:a||null,response:i,created_at:new Date().toISOString()};return on.push(o),{data:o,error:null}},getAiInteractions:(n,t)=>({data:on.filter(i=>i.user_id===n&&i.book_id===t),error:null}),getAiPrompts:n=>({data:so.filter(r=>r.prompt_type===n&&r.active),error:null}),savePromptResponse:(n,t,r)=>{const i={id:`response-${Qn.length+1}`,user_id:n,prompt_id:t,response:r,created_at:new Date().toISOString()};return Qn.push(i),{data:i,error:null}}},consultant:{getConsultantAssignments:n=>({data:cn.filter(r=>r.consultant_id===n&&r.active),error:null}),assignConsultant:(n,t,r)=>{const i={id:`assignment-${cn.length+1}`,consultant_id:n,user_id:t,book_id:r,active:!0,created_at:new Date().toISOString()};return cn.push(i),{data:i,error:null}},createTrigger:(n,t,r,i,s)=>{const a={id:`trigger-${lt.length+1}`,consultant_id:s||null,user_id:n,book_id:t,trigger_type:r,message:i||null,is_processed:!1,created_at:new Date().toISOString()};return lt.push(a),{data:a,error:null}},getTriggers:n=>({data:lt.filter(r=>r.consultant_id===n&&!r.is_processed),error:null}),markTriggerProcessed:n=>{const t=lt.findIndex(i=>i.id===n);if(t===-1)return{data:null,error:{message:"Trigger not found"}};const r=new Date().toISOString();return lt[t]={...lt[t],is_processed:!0,processed_at:r},{data:lt[t],error:null}},isConsultant:n=>{const t=Oe[n];return t!=null&&t.is_consultant?{data:!0,error:null}:n==="mock-consultant-id"||n==="mock-user-id"?{data:!0,error:null}:{data:!1,error:null}},submitFeedback:(n,t,r,i,s,a=!1)=>{const o={id:`feedback-${Or.length+1}`,user_id:n,book_id:t,section_id:s||null,feedback_type:r,content:i,is_public:a,created_at:new Date().toISOString()};return Or.push(o),{data:o,error:null}},getUserFeedback:(n,t)=>({data:Or.filter(s=>s.user_id===n&&s.book_id===t).map(s=>{if(!s.section_id)return s;let a="",o="";for(const d of Ve)if(d.id===t){for(const h of d.chapters){for(const u of h.sections)if(u.id===s.section_id){a=u.title,o=h.title;break}if(a)break}if(a)break}return{...s,section:{title:a,chapter_title:o}}}),error:null}),getPublicFeedback:n=>({data:Or.filter(i=>i.book_id===n&&i.is_public).map(i=>{const s=Oe[i.user_id];let a="",o="";if(i.section_id){for(const d of Ve)if(d.id===n){for(const h of d.chapters){for(const u of h.sections)if(u.id===i.section_id){a=u.title,o=h.title;break}if(a)break}if(a)break}}return{...i,user:s,section:i.section_id?{title:a,chapter_title:o}:void 0}}),error:null}),submitHelpRequest:(n,t,r,i,s)=>{const a={id:`help-${He.length+1}`,user_id:n,book_id:t,section_id:i||null,status:"PENDING",content:r,context:s||null,assigned_to:null,resolved_at:null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return He.push(a),{data:a,error:null}},getUserHelpRequests:(n,t)=>({data:He.filter(s=>s.user_id===n&&s.book_id===t).map(s=>{const a=s.assigned_to?Oe[s.assigned_to]:null;let o="",d="";if(s.section_id){for(const h of Ve)if(h.id===t){for(const u of h.chapters){for(const f of u.sections)if(f.id===s.section_id){o=f.title,d=u.title;break}if(o)break}if(o)break}}return{...s,consultant:a,section:s.section_id?{title:o,chapter_title:d}:void 0}}),error:null}),getConsultantHelpRequests:n=>({data:He.filter(i=>i.assigned_to===n).map(i=>{const s=Oe[i.user_id];let a="",o="";if(i.section_id){for(const d of Ve)if(d.id===i.book_id){for(const h of d.chapters){for(const u of h.sections)if(u.id===i.section_id){a=u.title,o=h.title;break}if(a)break}if(a)break}}return{...i,user:s,section:i.section_id?{title:a,chapter_title:o}:void 0}}),error:null}),getPendingHelpRequests:()=>({data:He.filter(r=>r.status==="PENDING"&&!r.assigned_to).map(r=>{const i=Oe[r.user_id];let s="",a="";if(r.section_id){for(const o of Ve)if(o.id===r.book_id){for(const d of o.chapters){for(const h of d.sections)if(h.id===r.section_id){s=h.title,a=d.title;break}if(s)break}if(s)break}}return{...r,user:i,section:r.section_id?{title:s,chapter_title:a}:void 0}}),error:null}),updateHelpRequestStatus:(n,t,r)=>{const i=He.findIndex(a=>a.id===n);if(i===-1)return{data:null,error:{message:"Help request not found"}};const s={status:t,updated_at:new Date().toISOString()};return t==="IN_PROGRESS"&&r&&(s.assigned_to=r),t==="RESOLVED"&&(s.resolved_at=new Date().toISOString()),He[i]={...He[i],...s},{data:He[i],error:null}},logConsultantAction:(n,t,r,i)=>{const s={id:`action-${Zn.length+1}`,consultant_id:n,user_id:t,action_type:r,details:i||null,created_at:new Date().toISOString()};return Zn.push(s),{data:s,error:null}}}};console.log("Backend status: Using REAL Supabase backend");const ao=!0;console.log("Backend status: Using REAL Supabase backend");var Le=(n=>(n.LOGIN="LOGIN",n.PAGE_SYNC="PAGE_SYNC",n.SECTION_SYNC="SECTION_SYNC",n.DEFINITION_LOOKUP="DEFINITION_LOOKUP",n.AI_QUERY="AI_QUERY",n.HELP_REQUEST="HELP_REQUEST",n.FEEDBACK_SUBMISSION="FEEDBACK_SUBMISSION",n.QUIZ_ATTEMPT="QUIZ_ATTEMPT",n.NOTE_CREATION="NOTE_CREATION",n))(Le||{});const oo=async()=>(c("LoggingService","Creating logging service","info"),{logInteraction:async(t,r,i={})=>{try{c("LoggingService",`Logging interaction: ${r}`,"info",{userId:t,...i});const{bookId:s,sectionId:a,pageNumber:o,content:d,...h}=i,u=Object.keys(h).length>0?h:null,f=await z(),{error:m}=await f.from("interactions").insert({user_id:t,event_type:r,book_id:s||null,section_id:a||null,page_number:o||null,content:d||null,context:u?JSON.stringify(u):null});return m?(c("LoggingService",`Error logging interaction: ${m.message}`,"error",m),!1):!0}catch(s){return c("LoggingService","Error logging interaction","error",s),!1}},getUserInteractions:async(t,r={})=>{try{const{eventType:i,bookId:s,limit:a=100,offset:o=0}=r;c("LoggingService","Getting user interactions","info",{userId:t,eventType:i,bookId:s,limit:a,offset:o});let h=(await z()).from("interactions").select("*").eq("user_id",t).order("created_at",{ascending:!1}).range(o,o+a-1);i&&(h=h.eq("event_type",i)),s&&(h=h.eq("book_id",s));const{data:u,error:f}=await h;return f?(c("LoggingService",`Error getting user interactions: ${f.message}`,"error",f),[]):u||[]}catch(i){return c("LoggingService","Error getting user interactions","error",i),[]}},getInteractionStats:async(t,r={})=>{try{const{bookId:i,startDate:s,endDate:a}=r;c("LoggingService","Getting interaction stats","info",{userId:t,bookId:i,startDate:s,endDate:a});let d=(await z()).from("interactions").select("event_type").eq("user_id",t);i&&(d=d.eq("book_id",i)),s&&(d=d.gte("created_at",s.toISOString())),a&&(d=d.lte("created_at",a.toISOString()));const{data:h,error:u}=await d;if(u)return c("LoggingService",`Error getting interaction stats: ${u.message}`,"error",u),{total:0};const f={total:(h==null?void 0:h.length)||0,byType:{}};return h==null||h.forEach(m=>{const v=m.event_type;f.byType[v]=(f.byType[v]||0)+1}),f}catch(i){return c("LoggingService","Error getting interaction stats","error",i),{total:0}}}});ee.register("loggingService",async()=>{const n=await oo();M.register("loggingService",n)});const Ne=async(n,t,r)=>(await M.getOrInitialize("loggingService",ee)).logInteraction(n,t,r),ls=async()=>{c("AuthService","Creating auth service","info");const n=async()=>await ao();return{signIn:async(r,i)=>{var s;try{if(c("AuthService","Signing in user","info"),await n()){const o=await(await z()).auth.signInWithPassword({email:r,password:i});if(o.error)throw o.error;return(s=o.data)!=null&&s.user&&await Ne(o.data.user.id,Le.LOGIN,{content:"User logged in successfully"}).catch(d=>{c("AuthService","Error logging login interaction","error",d)}),o}else return ne.auth.signIn(r,i)}catch(a){throw q(a,"authService","signIn")}},signUp:async(r,i,s,a)=>{try{if(c("AuthService","Signing up user","info"),await n()){const o=await z(),d=s&&a?{data:{first_name:s,last_name:a}}:void 0,h=await o.auth.signUp({email:r,password:i,options:d});if(h.error)throw h.error;return h}else return ne.auth.signUp(r,i)}catch(o){throw q(o,"authService","signUp")}},signOut:async()=>{try{if(c("AuthService","Signing out user","info"),await n()){const i=await(await z()).auth.signOut();if(i.error)throw i.error;return i}else return ne.auth.signOut()}catch(r){throw q(r,"authService","signOut")}},getSession:async()=>{try{if(c("AuthService","Getting session","info"),await n()){const i=await(await z()).auth.getSession();if(i.error)throw i.error;return i}else return ne.auth.getSession()}catch(r){throw q(r,"authService","getSession")}},getUser:async()=>{try{if(c("AuthService","Getting user","info"),await n()){const r=await z(),{data:i,error:s}=await r.auth.getUser();if(s)throw s;return{data:i,error:null}}else return ne.auth.getUser()}catch(r){throw q(r,"authService","getUser")}},getUserProfile:async r=>{try{if(c("AuthService",`Getting user profile for ${r}`,"info"),await n()){const i=await z(),{data:s,error:a}=await i.from("profiles").select("*").eq("id",r).single();if(a)throw c("AuthService",`Error fetching profile for user ${r}:`,"error",a.message),a;return c("AuthService",`Profile fetched successfully for user ${r}`,"success"),{data:s,error:null}}else return ne.auth.getUserProfile(r)}catch(i){throw q(i,"authService","getUserProfile")}},createUserProfile:async(r,i)=>{try{if(c("AuthService",`Creating user profile for ${r}`,"info"),await n()){const s=await z(),{data:a,error:o}=await s.from("profiles").insert({id:r,...i,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();if(o)throw o;return{data:a,error:null}}else return ne.auth.createUserProfile(r,i)}catch(s){throw q(s,"authService","createUserProfile")}},updateUserProfile:async(r,i)=>{try{if(c("AuthService",`Updating user profile for ${r}`,"info"),await n()){const s=await z(),{data:a,error:o}=await s.from("profiles").update({...i,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(o)throw o;return{data:a,error:null}}else return ne.auth.updateUserProfile(r,i)}catch(s){throw q(s,"authService","updateUserProfile")}},onAuthStateChange:r=>{try{return c("AuthService","Setting up auth state change listener","info"),n()?z().auth.onAuthStateChange(r):ne.auth.onAuthStateChange(r)}catch(i){throw q(i,"authService","onAuthStateChange")}},resetPassword:async r=>{try{if(c("AuthService",`Sending password reset email to ${r}`,"info"),await n()){const i=await z(),{data:s,error:a}=await i.auth.resetPasswordForEmail(r);if(a)throw a;return{data:s,error:null}}else return ne.auth.resetPassword(r)}catch(i){throw q(i,"authService","resetPassword")}},verifyBookCode:async r=>{try{if(c("AuthService",`Verifying book code: ${r}`,"info"),await n()){const i=await z(),{data:s,error:a}=await i.from("verification_codes").select("*").eq("code",r).eq("is_used",!1).single();if(a)throw a;return{data:s,error:null}}else return ne.auth.verifyBookCode(r)}catch(i){throw q(i,"authService","verifyBookCode")}}}};ee.register("authService",async()=>{const n=await ls();M.register("authService",n)});const ds=async(n,t)=>(await M.getOrInitialize("authService",ee)).signIn(n,t),us=async(n,t,r,i)=>(await M.getOrInitialize("authService",ee)).signUp(n,t,r,i),hs=async()=>(await M.getOrInitialize("authService",ee)).signOut(),gs=async()=>(await M.getOrInitialize("authService",ee)).getSession(),fs=async()=>(await M.getOrInitialize("authService",ee)).getUser(),ps=async n=>(await M.getOrInitialize("authService",ee)).getUserProfile(n),ms=async(n,t)=>(await M.getOrInitialize("authService",ee)).createUserProfile(n,t),xs=async(n,t)=>(await M.getOrInitialize("authService",ee)).updateUserProfile(n,t),vs=n=>M.get("authService").onAuthStateChange(n),ys=async n=>(await M.getOrInitialize("authService",ee)).resetPassword(n),bs=async n=>(await M.getOrInitialize("authService",ee)).verifyBookCode(n),co={signIn:ds,signUp:us,signOut:hs,getSession:gs,getUser:fs,getUserProfile:ps,createUserProfile:ms,updateUserProfile:xs,onAuthStateChange:vs,resetPassword:ys,verifyBookCode:bs},Ss=Object.freeze(Object.defineProperty({__proto__:null,createAuthService:ls,createUserProfile:ms,default:co,getSession:gs,getUser:fs,getUserProfile:ps,onAuthStateChange:vs,resetPassword:ys,signIn:ds,signOut:hs,signUp:us,updateUserProfile:xs,verifyBookCode:bs},Symbol.toStringTag,{value:"Module"}));console.log("Loading bookService module");const js=async()=>(c("BookService","Creating book service","info"),console.log("Creating book service"),{getBook:async t=>{try{return c("BookService",`Getting book with ID ${t}`,"info"),console.log(`BookService: Getting book with ID ${t}`),{id:t,title:"Alice in Wonderland",author:"Lewis Carroll",description:"Alice's Adventures in Wonderland is an 1865 novel by English author Lewis Carroll. It tells of a young girl named Alice, who falls through a rabbit hole into a subterranean fantasy world populated by peculiar, anthropomorphic creatures.",coverImage:"https://m.media-amazon.com/images/I/71pmz7EqjdL._AC_UF1000,1000_QL80_.jpg",totalPages:100,chapters:[{id:"ch1",chapter_number:1,title:"Down the Rabbit-Hole"},{id:"ch2",chapter_number:2,title:"The Pool of Tears"},{id:"ch3",chapter_number:3,title:"A Caucus-Race and a Long Tale"}]}}catch(r){return c("BookService",`Error getting book: ${r.message}`,"error"),console.error(`BookService: Error getting book: ${r.message}`),null}},getPage:async(t,r)=>{try{c("BookService",`Getting page ${r} for book ${t}`,"info"),console.log(`BookService: Getting page ${r} for book ${t}`);const i=Math.ceil(r/10),s=i===1?"Down the Rabbit-Hole":i===2?"The Pool of Tears":"A Caucus-Race and a Long Tale";return{id:`page-${r}`,bookId:t,pageNumber:r,title:`Chapter ${i}: ${s}`,content:`This is the content for page ${r} of Alice in Wonderland. 

Alice was beginning to get very tired of sitting by her sister on the bank, and of having nothing to do: once or twice she had peeped into the book her sister was reading, but it had no pictures or conversations in it, 'and what is the use of a book,' thought Alice 'without pictures or conversations?'

So she was considering in her own mind (as well as she could, for the hot day made her feel very sleepy and stupid), whether the pleasure of making a daisy-chain would be worth the trouble of getting up and picking the daisies, when suddenly a White Rabbit with pink eyes ran close by her.

There was nothing so very remarkable in that; nor did Alice think it so very much out of the way to hear the Rabbit say to itself, 'Oh dear! Oh dear! I shall be late!' (when she thought it over afterwards, it occurred to her that she ought to have wondered at this, but at the time it all seemed quite natural); but when the Rabbit actually took a watch out of its waistcoat-pocket, and looked at it, and then hurried on, Alice started to her feet, for it flashed across her mind that she had never before seen a rabbit with either a waistcoat-pocket, or a watch to take out of it, and burning with curiosity, she ran across the field after it, and fortunately was just in time to see it pop down a large rabbit-hole under the hedge.`}}catch(i){return c("BookService",`Error getting page: ${i.message}`,"error"),console.error(`BookService: Error getting page: ${i.message}`),null}},getBookDetails:async t=>{try{c("BookService",`Getting book details for ${t}`,"info");const r=await z();return{id:t,title:"Alice in Wonderland",author:"Lewis Carroll",description:"Alice's Adventures in Wonderland is an 1865 novel by English author Lewis Carroll. It tells of a young girl named Alice, who falls through a rabbit hole into a subterranean fantasy world populated by peculiar, anthropomorphic creatures.",chapters:[{id:"ch1",chapter_number:1,title:"Down the Rabbit-Hole"},{id:"ch2",chapter_number:2,title:"The Pool of Tears"},{id:"ch3",chapter_number:3,title:"A Caucus-Race and a Long Tale"}]}}catch(r){return c("BookService",`Error getting book details: ${r.message}`,"error"),null}},getSectionDetails:async t=>{try{return c("BookService",`Getting section details for ${t}`,"info"),{id:t,title:"Section Title",content:"Section content goes here"}}catch(r){return c("BookService",`Error getting section details: ${r.message}`,"error"),null}},getBookContent:async t=>{try{return c("BookService",`Getting book content for ${t}`,"info"),{id:t,title:"Alice in Wonderland",content:"Mock content for Alice in Wonderland",currentPage:1,totalPages:100}}catch(r){return c("BookService",`Error getting book content: ${r.message}`,"error"),null}},getSectionByPage:async(t,r)=>{try{return c("BookService",`Getting section for page ${r}`,"info"),{id:`section_${r}`,title:`Section for page ${r}`,content:`Content for page ${r}`}}catch(i){return c("BookService",`Error getting section by page: ${i.message}`,"error"),null}},saveReadingProgress:async(t,r,i,s)=>{try{return c("BookService",`Saving reading progress for user ${t}`,"info"),!0}catch(a){return c("BookService",`Error saving reading progress: ${a.message}`,"error"),!1}},getReadingProgress:async(t,r)=>{try{return c("BookService",`Getting reading progress for user ${t}`,"info"),{userId:t,bookId:r,sectionId:"section_1",lastPosition:"10",lastReadAt:new Date().toISOString()}}catch(i){return c("BookService",`Error getting reading progress: ${i.message}`,"error"),null}},getReadingStats:async(t,r)=>{try{return c("BookService",`Getting reading stats for user ${t}`,"info"),{userId:t,bookId:r,totalReadingTime:120,pagesRead:10,percentageComplete:.1,lastSessionDate:new Date().toISOString()}}catch(i){return c("BookService",`Error getting reading stats: ${i.message}`,"error"),null}},updateReadingStats:async(t,r,i)=>{try{return c("BookService",`Updating reading stats for user ${t}`,"info"),!0}catch(s){return c("BookService",`Error updating reading stats: ${s.message}`,"error"),!1}},updateReadingProgress:async(t,r,i,s)=>{try{return c("BookService",`Updating reading progress for user ${t}, book ${r}, page ${i}, time ${s}s`,"info"),console.log(`BookService: Updating reading progress for user ${t}, book ${r}, page ${i}, time ${s}s`),await Ne(t,Le.PAGE_SYNC,{bookId:r,pageNumber:i,content:`User synced to page ${i}`,readingTime:s}).catch(a=>{c("BookService","Error logging page sync interaction","error",a)}),!0}catch(a){return c("BookService",`Error updating reading progress: ${a.message}`,"error"),console.error(`BookService: Error updating reading progress: ${a.message}`),!1}}});console.log(`Registering initialization function for ${K.BOOK_SERVICE}`);ee.register(K.BOOK_SERVICE,async()=>{console.log("Creating book service for registration");const n=await js();console.log("Registering book service in registry"),M.register(K.BOOK_SERVICE,n),console.log("Book service registered successfully")},[]);const Me=n=>async(...t)=>(M.has(K.BOOK_SERVICE)||await ee.initializeService(K.BOOK_SERVICE),M.get(K.BOOK_SERVICE)[n](...t)),_s=Me("getBook"),ws=Me("getPage"),ks=Me("getBookDetails"),Es=Me("getSectionDetails"),Cs=Me("getBookContent"),Rs=Me("getSectionByPage"),Is=Me("saveReadingProgress"),As=Me("getReadingProgress"),Ps=Me("getReadingStats"),Ts=Me("updateReadingStats"),Ds=Me("updateReadingProgress"),lo={getBook:_s,getPage:ws,getBookDetails:ks,getSectionDetails:Es,getBookContent:Cs,getSectionByPage:Rs,saveReadingProgress:Is,getReadingProgress:As,getReadingStats:Ps,updateReadingStats:Ts,updateReadingProgress:Ds};console.log("bookService module loaded");const Os=Object.freeze(Object.defineProperty({__proto__:null,createBookService:js,default:lo,getBook:_s,getBookContent:Cs,getBookDetails:ks,getPage:ws,getReadingProgress:As,getReadingStats:Ps,getSectionByPage:Rs,getSectionDetails:Es,saveReadingProgress:Is,updateReadingProgress:Ds,updateReadingStats:Ts},Symbol.toStringTag,{value:"Module"})),Jn=Wa,uo=async()=>{c("AIService","Creating AI service","info");const n={createConversation:(t,r,i)=>{c("AIService","Creating conversation","info");const s=new Date().toISOString();return{id:`conv_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,userId:t,bookId:r,sectionId:i,messages:[],createdAt:s,updatedAt:s}},addMessageToConversation:(t,r,i)=>{c("AIService",`Adding ${r} message to conversation`,"info");const s=new Date().toISOString();return{...t,messages:[...t.messages,{role:r,content:i,timestamp:s}],updatedAt:s}},sendMessageToAI:async(t,r,i="",s=Jn.CHAT)=>{var a,o,d;try{c("AIService",`Sending message to AI (${s})`,"info",{userId:t.userId,bookId:t.bookId});const h=n.addMessageToConversation(t,"user",r),u=h.messages.filter(m=>m.role!=="system").map(m=>({role:m.role,content:m.content})),f=await z();try{c("AIService","Calling ask-ai Edge Function","info",{mode:s});const{data:m,error:v}=await f.functions.invoke("ask-ai",{body:{messages:u,context:i,bookId:t.bookId,sectionId:t.sectionId,userId:t.userId,mode:s}});if(v){c("AIService",`Error calling ask-ai Edge Function: ${v.message}`,"error",v);const y="I'm sorry, I encountered an error processing your request. Please try again later.";return{response:y,conversation:n.addMessageToConversation(h,"assistant",y)}}const b=(m==null?void 0:m.response)||"I'm sorry, I don't have a response for that.";c("AIService","Received response from ask-ai Edge Function","success",{responseLength:b.length});const p=n.addMessageToConversation(h,"assistant",b);return t.userId&&await Ne(t.userId,Le.AI_QUERY,{bookId:t.bookId,sectionId:t.sectionId,content:r,context:i?i.substring(0,500):void 0,response:b.substring(0,500),mode:s}).catch(y=>{c("AIService","Error logging AI query interaction","error",y)}),{response:b,conversation:p}}catch(m){c("AIService",`Error calling ask-ai Edge Function: ${m.message}`,"error",m);const b=((a=m.message)==null?void 0:a.includes("Failed to fetch"))||((o=m.message)==null?void 0:o.includes("Network error"))||((d=m.message)==null?void 0:d.includes("ECONNREFUSED"))?"I'm sorry, I'm having trouble connecting to my knowledge base. Please check your internet connection and try again.":"I'm sorry, I encountered an error processing your request. Please try again later.";return{response:b,conversation:n.addMessageToConversation(h,"assistant",b)}}}catch(h){c("AIService",`Error sending message to AI: ${h.message}`,"error",h);const u="I'm sorry, I encountered an error processing your request. Please try again later.";return{response:u,conversation:n.addMessageToConversation(t,"assistant",u)}}},getWordDefinition:async(t,r,i,s,a)=>{try{c("AIService",`Getting definition for "${t}"`,"info");const o=n.createConversation(i,s,a),{response:d}=await n.sendMessageToAI(o,`Define the word "${t}" in this context.`,r,Jn.DEFINITION);return d}catch(o){return c("AIService",`Error getting word definition: ${o.message}`,"error"),"I'm sorry, I couldn't find a definition for that word."}},getAIInteractionStats:async(t,r)=>{try{c("AIService","Getting AI interaction stats","info");const i=await z(),{data:s,error:a}=await i.from("ai_interactions").select("interaction_type, count",{count:"exact"}).eq("user_id",t).eq("book_id",r).group("interaction_type");if(a)return c("AIService",`Error getting AI stats: ${a.message}`,"error"),null;const{data:o,error:d}=await i.from("ai_interactions").select("*").eq("user_id",t).eq("book_id",r).order("created_at",{ascending:!1}).limit(5);return d?(c("AIService",`Error getting recent interactions: ${d.message}`,"error"),null):{stats:s||[],recentInteractions:o||[]}}catch(i){return c("AIService",`Error getting AI stats: ${i.message}`,"error"),null}},logHelpOffer:async(t,r,i,s)=>{try{c("AIService","Logging help offer","info");const a=await z(),{error:o}=await a.from("help_offers").insert({user_id:t,book_id:r,section_id:i,reason:s,created_at:new Date().toISOString()});return o?(c("AIService",`Error logging help offer: ${o.message}`,"error"),!1):(await Ne(t,Le.HELP_REQUEST,{bookId:r,sectionId:i,content:s}).catch(d=>{c("AIService","Error logging help request interaction","error",d)}),!0)}catch(a){return c("AIService",`Error logging help offer: ${a.message}`,"error"),!1}},checkIfUserNeedsHelp:async(t,r,i)=>{try{c("AIService","Checking if user needs help","info");const s=await z(),{data:a,error:o}=await s.from("ai_interactions").select("*").eq("user_id",t).eq("book_id",r).eq("section_id",i).order("created_at",{ascending:!1}).limit(5);if(o)return c("AIService",`Error getting AI interactions: ${o.message}`,"error"),{needsHelp:!1,reason:""};if(a&&a.length>=3){const u=a.slice(0,3);if(u.filter(m=>u.some(v=>v.id!==m.id&&v.query.toLowerCase().includes(m.query.toLowerCase().substring(0,5)))).length>=2)return{needsHelp:!0,reason:"You seem to be asking similar questions. Would you like to speak with a consultant for more help?"}}const d=["symbolism","theme","meaning","interpret","analysis"];return(a==null?void 0:a.some(u=>d.some(f=>u.query.toLowerCase().includes(f))))?{needsHelp:!0,reason:"You're asking about complex literary topics. Would you like to speak with a literature consultant?"}:{needsHelp:!1,reason:""}}catch(s){return c("AIService",`Error checking if user needs help: ${s.message}`,"error"),{needsHelp:!1,reason:""}}},logAIInteraction:async(t,r,i,s,a,o)=>{try{c("AIService","Logging AI interaction","info");const d=await z(),{error:h}=await d.from("ai_interactions").insert({user_id:t,book_id:r,section_id:i,query:s,response:a,interaction_type:o,created_at:new Date().toISOString()});return h?(c("AIService",`Error logging AI interaction: ${h.message}`,"error"),!1):!0}catch(d){return c("AIService",`Error logging AI interaction: ${d.message}`,"error"),!1}}};return n};ee.register("aiService",async()=>{const n=await uo();M.register("aiService",n)});const ho=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),go={defaultTTL:30*60*1e3,maxItems:100,useLocalStorage:!0,storageNamespace:"alice_reader_cache_"};class Er{constructor(t={}){pe(this,"cache",new Map);pe(this,"config");pe(this,"accessOrder",[]);this.config={...go,...t},this.loadFromStorage()}set(t,r,i){const s=i||this.config.defaultTTL,a={value:r,timestamp:Date.now(),ttl:s,key:t};this.updateAccessOrder(t),this.cache.set(t,a),this.enforceMaxItems(),this.config.useLocalStorage&&this.saveToStorage(),c("CacheService",`Set cache item: ${t}`,"debug")}get(t){const r=this.cache.get(t);if(!r){c("CacheService",`Cache miss: ${t}`,"debug");return}if(this.isExpired(r)){c("CacheService",`Cache item expired: ${t}`,"debug"),this.remove(t);return}return this.updateAccessOrder(t),c("CacheService",`Cache hit: ${t}`,"debug"),r.value}remove(t){this.cache.delete(t),this.accessOrder=this.accessOrder.filter(r=>r!==t),this.config.useLocalStorage&&this.saveToStorage(),c("CacheService",`Removed cache item: ${t}`,"debug")}clear(){this.cache.clear(),this.accessOrder=[],this.config.useLocalStorage&&this.clearStorage(),c("CacheService","Cache cleared","debug")}has(t){const r=this.cache.get(t);return r?this.isExpired(r)?(this.remove(t),!1):!0:!1}keys(){return this.cleanExpired(),Array.from(this.cache.keys())}getStats(){this.cleanExpired();let t=Date.now(),r=0;return this.cache.forEach(i=>{i.timestamp<t&&(t=i.timestamp),i.timestamp>r&&(r=i.timestamp)}),{size:this.cache.size,maxSize:this.config.maxItems,oldestItem:t,newestItem:r}}isExpired(t){return Date.now()>t.timestamp+t.ttl}cleanExpired(){const t=Date.now();this.cache.forEach((r,i)=>{t>r.timestamp+r.ttl&&this.remove(i)})}updateAccessOrder(t){this.accessOrder=this.accessOrder.filter(r=>r!==t),this.accessOrder.push(t)}enforceMaxItems(){if(!(this.cache.size<=this.config.maxItems))for(;this.cache.size>this.config.maxItems&&this.accessOrder.length>0;){const t=this.accessOrder[0];this.remove(t),this.accessOrder.shift()}}saveToStorage(){if(!(typeof window>"u"||!window.localStorage))try{this.cleanExpired();const t=Array.from(this.cache.entries());localStorage.setItem(`${this.config.storageNamespace}data`,JSON.stringify(t)),localStorage.setItem(`${this.config.storageNamespace}order`,JSON.stringify(this.accessOrder)),c("CacheService","Cache saved to localStorage","debug")}catch(t){c("CacheService","Error saving cache to localStorage","error",t)}}loadFromStorage(){if(!(typeof window>"u"||!window.localStorage))try{const t=localStorage.getItem(`${this.config.storageNamespace}data`);if(t){const i=JSON.parse(t);this.cache=new Map(i)}const r=localStorage.getItem(`${this.config.storageNamespace}order`);r&&(this.accessOrder=JSON.parse(r)),this.cleanExpired(),c("CacheService","Cache loaded from localStorage","debug")}catch(t){c("CacheService","Error loading cache from localStorage","error",t),this.cache=new Map,this.accessOrder=[]}}clearStorage(){if(!(typeof window>"u"||!window.localStorage))try{localStorage.removeItem(`${this.config.storageNamespace}data`),localStorage.removeItem(`${this.config.storageNamespace}order`),c("CacheService","Cache cleared from localStorage","debug")}catch(t){c("CacheService","Error clearing cache from localStorage","error",t)}}}new Er({defaultTTL:60*60*1e3,storageNamespace:"alice_reader_book_"});new Er({defaultTTL:30*60*1e3,storageNamespace:"alice_reader_section_"});const Bd=new Er({defaultTTL:24*60*60*1e3,storageNamespace:"alice_reader_dict_"});new Er({defaultTTL:5*60*1e3,storageNamespace:"alice_reader_progress_"});new Er({defaultTTL:5*60*1e3,storageNamespace:"alice_reader_stats_"});var fr=(n=>(n.PENDING="PENDING",n.IN_PROGRESS="IN_PROGRESS",n.RESOLVED="RESOLVED",n))(fr||{});class fo{constructor(t){pe(this,"client");pe(this,"sessionCache",new Map);pe(this,"config");pe(this,"mockData",new Map);this.config={mockEnabled:!1,cacheEnabled:!0,cacheDuration:5*60*1e3,debug:!1,...t},this.client=Tn(t.supabaseUrl,t.supabaseKey),this.initializeMockData()}log(t,r){this.config.debug&&console.log(`[SupabaseMCP] ${t}`,r||"")}initializeMockData(){this.mockData.set("mockUser",{id:"mock-user-id",email:"mock@example.com",user_metadata:{first_name:"Mock",last_name:"User"}})}getCachedSession(t){if(!this.config.cacheEnabled)return null;const r=this.sessionCache.get(t);return r?Date.now()-r.timestamp>(this.config.cacheDuration||0)?(this.sessionCache.delete(t),null):r.session:null}setCachedSession(t,r){this.config.cacheEnabled&&this.sessionCache.set(t,{session:r,timestamp:Date.now()})}async getSession(){try{if(this.config.mockEnabled)return this.log("Returning mock session"),{data:{session:null},error:null};const t=this.getCachedSession("current");if(t)return this.log("Returning cached session"),{data:{session:t},error:null};const{data:r,error:i}=await this.client.auth.getSession();return!i&&r.session&&this.setCachedSession("current",r.session),{data:r,error:i}}catch(t){return this.log("Error getting session",t),{data:{session:null},error:t instanceof Error?t:new Error("Unknown error")}}}async signIn(t,r){try{if(this.config.mockEnabled)return{data:{user:this.mockData.get("mockUser")},error:null};const{data:i,error:s}=await this.client.auth.signInWithPassword({email:t,password:r});return!s&&i.session&&this.setCachedSession("current",i.session),{data:{user:i.user},error:s}}catch(i){return{data:{user:null},error:i instanceof Error?i:new Error("Unknown error")}}}async signUp(t,r){try{if(this.config.mockEnabled)return{data:{user:this.mockData.get("mockUser")},error:null};const{data:i,error:s}=await this.client.auth.signUp({email:t,password:r});return!s&&i.session&&this.setCachedSession("current",i.session),{data:{user:i.user},error:s}}catch(i){return{data:{user:null},error:i instanceof Error?i:new Error("Unknown error")}}}async signOut(){try{if(this.config.mockEnabled)return this.sessionCache.clear(),{error:null};const{error:t}=await this.client.auth.signOut();return this.sessionCache.clear(),{error:t}}catch(t){return{error:t instanceof Error?t:new Error("Unknown error")}}}onAuthStateChange(t){return this.config.mockEnabled?{data:{subscription:{unsubscribe:()=>{}}},error:null}:this.client.auth.onAuthStateChange((r,i)=>{i?this.setCachedSession("current",i):this.sessionCache.clear(),t(r,i)})}setMockEnabled(t){this.config.mockEnabled=t,this.log(`Mock mode ${t?"enabled":"disabled"}`)}setCacheEnabled(t){this.config.cacheEnabled=t,this.log(`Cache ${t?"enabled":"disabled"}`)}getConfig(){return{mockEnabled:this.config.mockEnabled,cacheEnabled:this.config.cacheEnabled,cacheDuration:this.config.cacheDuration,debug:this.config.debug}}setMockData(t,r){this.mockData.set(t,r),this.log(`Mock data updated for key: ${t}`)}clearCache(){this.sessionCache.clear(),this.log("Cache cleared")}}const po={supabaseUrl:"https://blwypdcobizmpidmuhvq.supabase.co",supabaseKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJsd3lwZGNvYml6bXBpZG11aHZxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQyMDgzNDcsImV4cCI6MjA1OTc4NDM0N30.YP2r-CnSaM4rKclXBivanAMBQh9sMsI95F2p87zIuWM",mockEnabled:!1,cacheEnabled:!0,cacheDuration:5*60*1e3,debug:!1},Cr=new fo(po);async function Rr(){return await no()?(c("BackendService","Using real backend","info"),!0):(c("BackendService","Using mock backend (connection unavailable)","warning"),!1)}const mo=async(n,t)=>Cr.signIn(n,t),xo=async(n,t)=>Cr.signUp(n,t),vo=async()=>Cr.signOut(),yo=async()=>Cr.getSession(),bo=async n=>Cr.onAuthStateChange(n);async function $r(n){if(c("BackendService",`Getting user profile for ${n}`,"info"),await Rr())try{return await cs(async()=>{const t=await z(),{data:r,error:i}=await t.from("profiles").select("*").eq("id",n).single();if(i)throw c("BackendService",`Error fetching profile for user ${n}:`,"error",i.message),i;return c("BackendService",`Profile fetched successfully for user ${n}`,"success"),{data:r,error:null}},"getUserProfile")}catch(t){return c("BackendService","Get user profile failed after retries, falling back to mock","error",t),ne.profiles.getUserProfile(n)}else return ne.profiles.getUserProfile(n)}async function So(n,t,r,i){if(await Rr())try{return await cs(async()=>{const s=await z(),{data:a,error:o}=await s.from("profiles").insert({id:n,first_name:t,last_name:r,email:i}).select().single();if(o)throw o;return{data:a,error:null}},"createUserProfile")}catch(s){return c("BackendService","Create user profile failed after retries, falling back to mock","error",s),ne.profiles.createUserProfile(n,t,r,i)}else return ne.profiles.createUserProfile(n,t,r,i)}async function Ud(n,t,r,i){try{c("BackendService","Getting definition","info",{bookId:n,term:t,sectionId:r,chapterId:i});const s=t.replace(/[.,!?;:'"\/\\()\[\]{}]/g,"").trim().toLowerCase();if(await Rr()){const a=await z(),o=n,{data:d,error:h}=await a.rpc("get_definition_with_context",{book_id_param:o,term_param:s,section_id_param:r||null,chapter_id_param:i||null});if(h)return c("BackendService","Error getting definition from database","error",h),{data:null,error:h};if(d&&d.length>0){const u=d.sort((m,v)=>m.priority-v.priority),f=u[0].definition;return c("BackendService","Found definition in database","success",{term:s,priority:u[0].priority,definitionLength:f.length}),{data:f,error:null}}return c("BackendService","No definition found in database","info",{term:s}),{data:null,error:null}}else return c("BackendService","Using mock backend for definition","info"),ne.books.getDefinition(n,s,r,i)}catch(s){return c("BackendService","Error in getDefinition","error",s),{data:null,error:s}}}async function jo(n,t,r,i){c("BackendService","Performing comprehensive book verification","info",{code:n,userId:t,firstName:r,lastName:i}),console.log("verifyBookCodeComprehensive: Starting verification with:",{code:n,userId:t,firstName:r,lastName:i});const s=Date.now();if(await Rr())try{const a=await z(),o=await ro(n,t,r,i),d=Date.now()-s;return console.log(`verifyBookCodeComprehensive: Verification completed in ${d}ms, result:`,o),o.success?(c("BackendService","Verification successful","success"),console.log("verifyBookCodeComprehensive: Verification successful"),setTimeout(async()=>{try{const{data:h}=await a.from("profiles").select("first_name, last_name, book_verified").eq("id",t).single();console.log("verifyBookCodeComprehensive: Post-verification profile check:",h),h!=null&&h.book_verified||console.warn("verifyBookCodeComprehensive: Profile book_verified is still false!")}catch(h){console.error("verifyBookCodeComprehensive: Error checking profile after verification:",h)}},500)):(c("BackendService","Verification failed","error",o.error),console.error("verifyBookCodeComprehensive: Verification failed with error:",o.error)),o}catch(a){const o=Date.now()-s;return c("BackendService",`Error in comprehensive verification (after ${o}ms)`,"error",a),console.error(`verifyBookCodeComprehensive: Error in verification after ${o}ms:`,a),{success:!1,error:a}}else try{c("BackendService","Using mock implementation for comprehensive verification","info"),console.log("Mock verifyBookCodeComprehensive: Starting with code:",n,"userId:",t);const{data:a,error:o}=await ne.books.verifyBookCode(n);if(o||!a)return console.error("Mock verification failed: Invalid code"),{success:!1,error:o||"Invalid verification code"};if(a.is_used)return console.error("Mock verification failed: Code already used"),{success:!1,error:"This code has already been used"};const{error:d}=await ne.books.markCodeAsUsed(n,t);if(d)return console.error("Mock verification failed: Error marking code as used"),{success:!1,error:d};const h={book_verified:!0};r&&(h.first_name=r),i&&(h.last_name=i),console.log("Mock verification: Updating profile with:",h);const{data:u}=await ne.profiles.getUserProfile(t);u||(console.log("Mock verification: Profile does not exist, creating new profile"),await ne.profiles.createUserProfile(t,r||"User",i||"Name","user@example.com"));const{data:f,error:m}=await ne.profiles.updateUserProfile(t,h);return m?(console.error("Mock verification failed: Error updating profile",m),{success:!1,error:m}):(console.log("Mock verification successful! Updated profile:",f),{success:!0,data:a})}catch(a){return console.error("Mock verification failed with exception:",a),c("BackendService","Error in mock comprehensive verification","error",a),{success:!1,error:a}}}async function Vd(n,t,r,i,s,a){if(await Rr()){const o=await z(),{data:d,error:h}=await o.from("ai_interactions").insert({user_id:n,book_id:t,section_id:s||null,question:r,context:null,response:i}).select().single();return{data:d,error:h}}else return ne.ai.saveAiInteraction(n,t,r,i,s,a)}console.log("Loading feedbackService module");const _o=async()=>(c("FeedbackService","Creating feedback service","info"),console.log("Creating feedback service"),{getUserFeedback:async(t,r)=>{try{c("FeedbackService","Getting user feedback","info");const i=await z(),{data:s,error:a}=await i.from("user_feedback").select("*").eq("user_id",t).eq("book_id",r).order("created_at",{ascending:!1});return a?(c("FeedbackService",`Error getting user feedback: ${a.message}`,"error"),[]):s||[]}catch(i){return c("FeedbackService",`Error getting user feedback: ${i.message}`,"error"),[]}},submitFeedback:async(t,r,i,s,a,o=!1)=>{try{c("FeedbackService","Submitting feedback","info",{feedbackType:i,hasSection:!!a,isPublic:o});const d=await z(),{data:h,error:u}=await d.from("user_feedback").insert({user_id:t,book_id:r,section_id:a||null,feedback_type:i,content:s,is_public:o,is_featured:!1,created_at:new Date().toISOString()}).select().single();if(u)return c("FeedbackService",`Error submitting feedback: ${u.message}`,"error",u),{error:u};try{await d.from("ai_interactions").insert({user_id:t,book_id:r,section_id:a||null,question:`Feedback: ${i}`,response:"Feedback submitted successfully",interaction_type:"FEEDBACK",created_at:new Date().toISOString()})}catch(f){c("FeedbackService","Warning: Failed to log feedback interaction","warning",f)}try{await Ne(t,Le.FEEDBACK_SUBMISSION,{bookId:r,sectionId:a||void 0,content:s,feedbackType:i,isPublic:o})}catch(f){c("FeedbackService","Warning: Failed to log feedback to interactions table","warning",f)}return c("FeedbackService","Feedback submitted successfully","success",{id:h==null?void 0:h.id}),{data:h}}catch(d){return c("FeedbackService",`Error submitting feedback: ${d.message}`,"error",d),{error:d}}},updateFeedbackVisibility:async(t,r,i)=>{try{c("FeedbackService","Updating feedback visibility","info");const s=await z(),{error:a}=await s.from("user_feedback").update({is_public:r,is_featured:i}).eq("id",t);return a?(c("FeedbackService",`Error updating feedback visibility: ${a.message}`,"error"),!1):(c("FeedbackService","Feedback visibility updated successfully","success"),!0)}catch(s){return c("FeedbackService",`Error updating feedback visibility: ${s.message}`,"error"),!1}},logFeedbackInteraction:async(t,r,i,s)=>{try{return c("FeedbackService",`Logging feedback interaction: ${i}`,"info"),await Ne(t,Le.FEEDBACK_SUBMISSION,{bookId:r,content:`Feedback interaction: ${i}`,interactionType:i,...s})?!0:(c("FeedbackService","Error logging feedback interaction","error"),!1)}catch(a){return c("FeedbackService",`Error logging feedback interaction: ${a.message}`,"error",a),!1}}});console.log("Registering initialization function for feedbackService");ee.register("feedbackService",async()=>{console.log("Creating feedback service for registration");const n=await _o();console.log("Registering feedback service in registry"),M.register("feedbackService",n),console.log("Feedback service registered successfully")},[]);console.log("feedbackService module loaded");const wo=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));console.log("Loading triggerService module");const ko=async()=>(c("TriggerService","Creating trigger service","info"),console.log("Creating trigger service"),{getTriggers:async(t,r)=>{try{c("TriggerService","Getting triggers","info");const i=await z(),{data:s,error:a}=await i.from("consultant_triggers").select("*").eq("user_id",t).eq("book_id",r).eq("is_processed",!1).order("created_at",{ascending:!1});return a?(c("TriggerService",`Error getting triggers: ${a.message}`,"error"),[]):s||[]}catch(i){return c("TriggerService",`Error getting triggers: ${i.message}`,"error"),[]}},createTrigger:async(t,r,i,s,a)=>{try{c("TriggerService","Creating trigger","info");const o=await z(),{error:d}=await o.from("consultant_triggers").insert({user_id:t,book_id:r,section_id:i,trigger_type:s,content:a,is_processed:!1,created_at:new Date().toISOString()});return d?(c("TriggerService",`Error creating trigger: ${d.message}`,"error"),!1):(c("TriggerService","Trigger created successfully","success"),!0)}catch(o){return c("TriggerService",`Error creating trigger: ${o.message}`,"error"),!1}},markTriggerProcessed:async t=>{try{c("TriggerService",`Marking trigger ${t} as processed`,"info");const r=await z(),{error:i}=await r.from("consultant_triggers").update({is_processed:!0,processed_at:new Date().toISOString()}).eq("id",t);return i?(c("TriggerService",`Error marking trigger as processed: ${i.message}`,"error"),!1):(c("TriggerService","Trigger marked as processed successfully","success"),!0)}catch(r){return c("TriggerService",`Error marking trigger as processed: ${r.message}`,"error"),!1}},subscribeToTriggers:async(t,r,i)=>{try{c("TriggerService","Subscribing to triggers","info");const s=await z(),a=s.channel("consultant_triggers_channel").on("postgres_changes",{event:"INSERT",schema:"public",table:"consultant_triggers",filter:`user_id=eq.${t} AND book_id=eq.${r} AND is_processed=eq.false`},o=>{c("TriggerService","New trigger received","info"),i(o.new)}).subscribe();return()=>{c("TriggerService","Unsubscribing from triggers","info"),s.removeChannel(a)}}catch(s){return c("TriggerService",`Error subscribing to triggers: ${s.message}`,"error"),()=>{}}}});console.log("Registering initialization function for triggerService");ee.register(K.TRIGGER_SERVICE,async()=>{console.log("Creating trigger service for registration");const n=await ko();console.log("Registering trigger service in registry"),M.register(K.TRIGGER_SERVICE,n),console.log("Trigger service registered successfully")},[]);console.log("triggerService module loaded");const Eo=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),ue="StatisticsService",Co=async()=>(c(ue,"Creating statistics service","info"),{getBasicReadingStats:async(t,r)=>{try{c(ue,`Getting basic reading stats for user ${t}`,"info");const i=await z(),{data:s,error:a}=await i.from("reading_stats").select("*").eq("user_id",t).eq("book_id",r).single();return a&&a.code!=="PGRST116"?(c(ue,`Error getting reading stats: ${a.message}`,"error"),null):s||null}catch(i){throw q(i,"statisticsService","getBasicReadingStats")}},getDetailedReadingStats:async(t,r)=>{try{c(ue,`Getting detailed reading stats for user ${t}`,"info");const i=await z(),{data:s,error:a}=await i.from("reading_stats").select("*").eq("user_id",t).eq("book_id",r).single();if(a&&a.code!=="PGRST116")return c(ue,`Error getting reading stats: ${a.message}`,"error"),null;if(!s)return null;const{count:o,error:d}=await i.from("ai_interactions").select("*",{count:"exact",head:!0}).eq("user_id",t).eq("book_id",r);d&&c(ue,`Error getting AI interactions count: ${d.message}`,"warning");const{count:h,error:u}=await i.from("ai_interactions").select("*",{count:"exact",head:!0}).eq("user_id",t).eq("book_id",r).eq("interaction_type","definition");u&&c(ue,`Error getting word lookups count: ${u.message}`,"warning");const{count:f,error:m}=await i.from("help_requests").select("*",{count:"exact",head:!0}).eq("user_id",t).eq("book_id",r);m&&c(ue,`Error getting help requests count: ${m.message}`,"warning");const{count:v,error:b}=await i.from("user_feedback").select("*",{count:"exact",head:!0}).eq("user_id",t).eq("book_id",r);return b&&c(ue,`Error getting feedback count: ${b.message}`,"warning"),{...s,reading_streak:1,words_looked_up:h||0,ai_interactions:o||0,help_requests:f||0,feedback_submitted:v||0}}catch(i){throw q(i,"statisticsService","getDetailedReadingStats")}},updateReadingTime:async(t,r,i)=>{try{c(ue,`Updating reading time for user ${t}`,"info");const s=await z(),{data:a,error:o}=await s.from("reading_stats").select("id, total_reading_time").eq("user_id",t).eq("book_id",r).single();if(o&&o.code!=="PGRST116")return c(ue,`Error checking reading stats: ${o.message}`,"error"),!1;if(a){const{error:d}=await s.from("reading_stats").update({total_reading_time:a.total_reading_time+i,last_session_date:new Date().toISOString()}).eq("id",a.id);if(d)return c(ue,`Error updating reading time: ${d.message}`,"error"),!1}else{const{error:d}=await s.from("reading_stats").insert({user_id:t,book_id:r,total_reading_time:i,pages_read:0,percentage_complete:0,last_session_date:new Date().toISOString()});if(d)return c(ue,`Error creating reading stats: ${d.message}`,"error"),!1}return!0}catch(s){throw q(s,"statisticsService","updateReadingTime")}},getReaderLeaderboard:async(t,r=10)=>{try{c(ue,`Getting reader leaderboard for book ${t}`,"info");const i=await z(),{data:s,error:a}=await i.from("reading_stats").select("*, user:user_id(username, display_name)").eq("book_id",t).order("percentage_complete",{ascending:!1}).limit(r);return a?(c(ue,`Error getting reader leaderboard: ${a.message}`,"error"),[]):s||[]}catch(i){throw q(i,"statisticsService","getReaderLeaderboard")}},updateReadingStats:async(t,r,i,s=100)=>{try{c(ue,`Updating reading stats for user ${t}`,"info");const a=await z(),{data:o,error:d}=await a.from("reading_stats").select("id, pages_read").eq("user_id",t).eq("book_id",r).single();if(d&&d.code!=="PGRST116")return c(ue,`Error checking reading stats: ${d.message}`,"error"),!1;const h=typeof i=="string"?parseInt(i):i,u=Math.min(h/s,1),f=new Date().toISOString();if(o){const{error:m}=await a.from("reading_stats").update({pages_read:Math.max(o.pages_read,h),percentage_complete:u,last_session_date:f}).eq("id",o.id);if(m)return c(ue,`Error updating reading stats: ${m.message}`,"error"),!1}else{const{error:m}=await a.from("reading_stats").insert({user_id:t,book_id:r,total_reading_time:0,pages_read:h,percentage_complete:u,last_session_date:f});if(m)return c(ue,`Error creating reading stats: ${m.message}`,"error"),!1}return!0}catch(a){throw q(a,"statisticsService","updateReadingStats")}}});ee.register("statisticsService",async()=>{const n=await Co();M.register("statisticsService",n)});const Ro=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),T="ConsultantService",Io=async()=>(c(T,"Creating consultant service","info"),{checkIsConsultant:async()=>{try{c(T,"Checking if current user is a consultant","info");const t=await z(),{data:r,error:i}=await t.rpc("is_consultant");return i?(c(T,"Error checking consultant status","error",i),!1):r===!0}catch(t){throw q(t,"consultantService","checkIsConsultant")}},getVerifiedReaders:async()=>{try{const{data:t,error:r}=await supabase.from("profiles").select("*").eq("is_verified",!0);if(r)throw r;return c(T,`Found ${t.length} verified readers`,"success"),t.map(i=>({id:i.id,first_name:i.first_name,last_name:i.last_name,email:i.email,created_at:i.created_at,book_verified:!!i.book_verified,is_verified:!!i.is_verified,is_consultant:!!i.is_consultant,updated_at:i.updated_at||i.created_at}))}catch(t){return q(t,"Failed to fetch verified readers",T),[]}},getUserReadingDetails:async(t,r=Ue.ALICE)=>{try{c(T,"Getting user reading details","info",{userId:t,bookId:r});const{data:i,error:s}=await supabase.from("profiles").select("*").eq("id",t).single();if(s)throw q(s,"Failed to fetch user profile",T);const{data:a,error:o}=await supabase.from("reading_progress").select("*").eq("user_id",t).eq("book_id",r).single();if(o&&o.code!=="PGRST116")throw q(o,"Failed to fetch reading progress",T);const{data:d,error:h}=await supabase.from("reading_stats").select("*").eq("user_id",t).eq("book_id",r).single();if(h&&h.code!=="PGRST116")throw q(h,"Failed to fetch reading stats",T);const{data:u,error:f}=await supabase.from("interactions").select("*").eq("user_id",t).eq("book_id",r).order("created_at",{ascending:!1});if(f)throw q(f,"Failed to fetch user interactions",T);const{data:m,error:v}=await supabase.from("feedback").select("*").eq("user_id",t).eq("book_id",r).order("created_at",{ascending:!1});if(v)throw q(v,"Failed to fetch user feedback",T);const{data:b,error:p}=await supabase.from("help_requests").select("*").eq("user_id",t).eq("book_id",r).order("created_at",{ascending:!1});if(p)throw q(p,"Failed to fetch help requests",T);const{data:y,error:_}=await supabase.from("consultant_actions").select("*").eq("user_id",t).eq("book_id",r).order("created_at",{ascending:!1});if(_)throw q(_,"Failed to fetch consultant actions",T);try{await(await z()).rpc("log_consultant_action",{p_user_id:t,p_action_type:"VIEW_PROFILE",p_details:{book_id:r}})}catch(w){c(T,"Error logging profile view","warning",w)}return{profile:{id:i.id,first_name:i.first_name,last_name:i.last_name,email:i.email,created_at:i.created_at,book_verified:!!i.book_verified,is_verified:!!i.is_verified,is_consultant:!!i.is_consultant,updated_at:i.updated_at||i.created_at},progress:a||{},stats:d||{},activity:{interactions:u||[],feedback:m||[],helpRequests:b||[],consultantActions:y||[]}}}catch(i){throw q(i,"Failed to fetch user reading details",T)}},getPendingHelpRequests:async(t=Ue.ALICE)=>{try{c(T,"Getting pending help requests","info",{bookId:t});const{data:r,error:i}=await supabase.from("help_requests").select(`
        *,
        profiles (
          first_name,
          last_name,
          email
        )
      `).eq("book_id",t).eq("status","pending").order("created_at",{ascending:!0});if(i)throw q(i,"Failed to fetch pending help requests",T);return r||[]}catch(r){throw q(r,"Failed to fetch pending help requests",T)}},getAssignedHelpRequests:async(t,r=Ue.ALICE)=>{try{c(T,"Getting assigned help requests","info",{consultantId:t,bookId:r});const{data:i,error:s}=await supabase.from("help_requests").select(`
        *,
        profiles (
          first_name,
          last_name,
          email
        )
      `).eq("book_id",r).eq("consultant_id",t).neq("status","closed").order("created_at",{ascending:!0});if(s)throw q(s,"Failed to fetch assigned help requests",T);return i||[]}catch(i){throw q(i,"Failed to fetch assigned help requests",T)}},updateHelpRequestStatus:async(t,r,i)=>{try{c(T,"Updating help request status","info",{requestId:t,status:r,consultantId:i});const s={status:r,updated_at:new Date().toISOString()};i&&(s.consultant_id=i);const{data:a,error:o}=await supabase.from("help_requests").update(s).eq("id",t).select().single();if(o)throw q(o,"Failed to update help request status",T);return a}catch(s){throw q(s,"Failed to update help request status",T)}},getAllFeedback:async(t=Ue.ALICE)=>{try{c(T,"Getting all feedback","info",{bookId:t});const{data:r,error:i}=await supabase.from("user_feedback").select(`
        *,
        user:user_id (id, first_name, last_name, email),
        section:section_id (
          id, title,
          chapter:chapter_id (id, title)
        )
      `).eq("book_id",t).order("created_at",{ascending:!1});return i?(c(T,"Error fetching all feedback","error",i),[]):(c(T,`Found ${r.length} feedback items`,"success"),r)}catch(r){throw q(r,"consultantService","getAllFeedback")}},getPublicFeedback:async(t=Ue.ALICE)=>{try{c(T,"Getting public feedback","info",{bookId:t});const{data:r,error:i}=await supabase.from("user_feedback").select(`
        *,
        user:user_id (id, first_name, last_name),
        section:section_id (
          id, title,
          chapter:chapter_id (id, title)
        )
      `).eq("book_id",t).eq("is_public",!0).order("created_at",{ascending:!1});return i?(c(T,"Error fetching public feedback","error",i),[]):(c(T,`Found ${r.length} public feedback items`,"success"),r)}catch(r){throw q(r,"consultantService","getPublicFeedback")}},createConsultantTrigger:async(t,r=Ue.ALICE,i,s)=>{try{c(T,"Creating consultant trigger","info",{userId:t,bookId:r,triggerType:i,message:s});const a=await z(),{data:o,error:d}=await a.rpc("create_consultant_trigger",{p_user_id:t,p_book_id:r,p_trigger_type:i,p_message:s});return d?(c(T,"Error creating consultant trigger","error",d),null):(c(T,"Consultant trigger created successfully","success"),o)}catch(a){throw q(a,"consultantService","createConsultantTrigger")}},getUserTriggers:async t=>{try{c(T,"Getting user triggers","info",{userId:t});const{data:r,error:i}=await supabase.from("consultant_triggers").select(`
        *,
        consultant:consultant_id (id, first_name, last_name)
      `).eq("user_id",t).eq("is_processed",!1).order("created_at",{ascending:!1});return i?(c(T,"Error fetching user triggers","error",i),[]):(c(T,`Found ${r.length} unprocessed triggers`,"success"),r)}catch(r){throw q(r,"consultantService","getUserTriggers")}},markTriggerProcessed:async t=>{try{c(T,"Marking trigger as processed","info",{triggerId:t});const{error:r}=await supabase.from("consultant_triggers").update({is_processed:!0,processed_at:new Date().toISOString()}).eq("id",t);return r?(c(T,"Error marking trigger as processed","error",r),!1):(c(T,"Trigger marked as processed successfully","success"),!0)}catch(r){throw q(r,"consultantService","markTriggerProcessed")}},logConsultantAction:async(t,r,i)=>{try{c(T,"Logging consultant action","info",{userId:t,actionType:r,details:i});const s=await z(),{data:a,error:o}=await s.rpc("log_consultant_action",{p_user_id:t,p_consultant_id:user==null?void 0:user.id,p_action_type:r,p_details:i?JSON.stringify(i):null});return o?(c(T,"Error logging consultant action","error",o),null):(c(T,"Consultant action logged successfully","success"),a)}catch(s){throw q(s,"consultantService","logConsultantAction")}},submitFeedback:async(t,r=Ue.ALICE,i,s,a,o=!1)=>{try{c(T,"Submitting user feedback","info",{userId:t,bookId:r,feedbackType:i,sectionId:a,isPublic:o});const{data:d,error:h}=await supabase.from("user_feedback").insert({user_id:t,book_id:r,section_id:a||null,feedback_type:i,content:s,is_public:o}).select().single();return h?(c(T,"Error submitting feedback","error",h),null):(c(T,"Feedback submitted successfully","success"),d)}catch(d){throw q(d,"consultantService","submitFeedback")}},submitHelpRequest:async(t,r=Ue.ALICE,i,s,a)=>{try{c(T,"Submitting help request","info",{userId:t,bookId:r,sectionId:s,context:a});const{data:o,error:d}=await supabase.from("help_requests").insert({user_id:t,book_id:r,section_id:s||null,status:fr.PENDING,content:i,context:a||null}).select().single();return d?(c(T,"Error submitting help request","error",d),null):(c(T,"Help request submitted successfully","success"),o)}catch(o){throw q(o,"consultantService","submitHelpRequest")}},getUserHelpRequests:async(t,r=Ue.ALICE)=>{try{c(T,"Getting user help requests","info",{userId:t,bookId:r});const{data:i,error:s}=await supabase.from("help_requests").select(`
        *,
        consultant:assigned_to (id, first_name, last_name),
        section:section_id (
          id, title,
          chapter:chapter_id (id, title)
        )
      `).eq("user_id",t).eq("book_id",r).order("created_at",{ascending:!1});return s?(c(T,"Error fetching user help requests","error",s),[]):(c(T,`Found ${i.length} help requests`,"success"),i)}catch(i){throw q(i,"consultantService","getUserHelpRequests")}},getUserFeedback:async(t,r=Ue.ALICE)=>{try{c(T,"Getting user feedback","info",{userId:t,bookId:r});const{data:i,error:s}=await supabase.from("user_feedback").select(`
        *,
        section:section_id (
          id, title,
          chapter:chapter_id (id, title)
        )
      `).eq("user_id",t).eq("book_id",r).order("created_at",{ascending:!1});return s?(c(T,"Error fetching user feedback","error",s),[]):(c(T,`Found ${i.length} feedback items`,"success"),i)}catch(i){throw q(i,"consultantService","getUserFeedback")}},getConsultantAssignments:async()=>{try{return[{id:"1",user_id:"mock-user-id",profiles:{first_name:"Alice",last_name:"Reader",email:"alice@example.com"}}]}catch(t){throw q(t,"consultantService","getConsultantAssignments")}},getConsultantStats:async()=>{var t;try{c(T,"Getting consultant dashboard statistics","info");const r=await z(),{data:i}=await r.auth.getSession();if(!((t=i.session)!=null&&t.user))return c(T,"No authenticated user found","warning"),null;const s=i.session.user.id,{data:a,error:o}=await supabase.from("consultant_assignments").select("*, user:user_id(id, first_name, last_name)").eq("consultant_id",s).eq("active",!0);if(o)return c(T,"Error fetching assignments","error",o),null;const{data:d,error:h}=await supabase.from("help_requests").select("*").or(`assigned_to.eq.${s},status.eq.${fr.PENDING}`);if(h)return c(T,"Error fetching help requests","error",h),null;const{data:u,error:f}=await supabase.from("user_feedback").select("*").in("user_id",(a==null?void 0:a.map(S=>S.user_id))||[]);if(f)return c(T,"Error fetching feedback","error",f),null;const{data:m,error:v}=await supabase.from("consultant_actions_log").select("*, user:user_id(id, first_name, last_name)").eq("consultant_id",s).order("created_at",{ascending:!1}).limit(10);if(v)return c(T,"Error fetching recent actions","error",v),null;const b=new Date,p=new Date(b.getTime()-7*24*60*60*1e3),y={high:0,medium:0,low:0};a==null||a.forEach(S=>{if(!S.last_active_at){y.low++;return}const k=new Date(S.last_active_at);k>p?y.high++:k>new Date(b.getTime()-14*24*60*60*1e3)?y.medium++:y.low++});const _=(m==null?void 0:m.map(S=>{let k="Unknown action";switch(S.action_type){case"TRIGGER_PROMPT":k="Sent a prompt to reader";break;case"UPDATE_HELP_REQUEST":k="Updated help request status";break;case"VIEW_READER_PROFILE":k="Viewed reader profile";break;default:k=`${S.action_type}`}return{id:S.id,type:S.action_type.toLowerCase(),userId:S.user_id,userName:S.user?`${S.user.first_name} ${S.user.last_name}`:"Unknown User",timestamp:S.created_at,description:k}}))||[],w={totalReaders:(a==null?void 0:a.length)||0,activeReaders:(a==null?void 0:a.filter(S=>S.last_active_at&&new Date(S.last_active_at)>p).length)||0,pendingRequests:(d==null?void 0:d.filter(S=>S.status===fr.PENDING).length)||0,resolvedRequests:(d==null?void 0:d.filter(S=>S.status===fr.RESOLVED).length)||0,totalFeedback:(u==null?void 0:u.length)||0,recentFeedback:(u==null?void 0:u.filter(S=>new Date(S.created_at)>p).length)||0,readerEngagement:y,recentActivity:_};return c(T,"Consultant stats retrieved successfully","success"),w}catch(r){throw q(r,"consultantService","getConsultantStats")}},getHelpRequests:async t=>{try{c(T,"Getting help requests","info",{statusFilter:t});let r=supabase.from("help_requests").select(`
        *,
        user:user_id (
          id,
          first_name,
          last_name,
          email
        ),
        consultant:assigned_to (
          id,
          first_name,
          last_name
        ),
        section:section_id (
          id,
          title,
          chapter:chapter_id (
            id,
            title
          )
        )
      `).order("created_at",{ascending:!1});t&&(r=r.eq("status",t));const{data:i,error:s}=await r;return s?(c(T,"Error fetching help requests","error",s),[]):(c(T,`Found ${i.length} help requests`,"success"),i)}catch(r){throw q(r,"consultantService","getHelpRequests")}}});async function $s(){return(await M.getService("consultantService")).getVerifiedReaders()}const Ao=Object.freeze(Object.defineProperty({__proto__:null,createConsultantService:Io,getVerifiedReaders:$s},Symbol.toStringTag,{value:"Module"})),Po=async()=>(c("InteractionService","Creating interaction service","info"),{logPageView:async(t,r,i)=>{try{if(c("InteractionService",`Logging page view for user ${t}, book ${r}, page ${i}`,"info"),!await Ne(t,Le.PAGE_SYNC,{bookId:r,pageNumber:i,content:`Page view: ${i}`}))throw new Error("Failed to log page view")}catch(s){throw q(s,"interactionService","logPageView")}},logDictionaryLookup:async(t,r,i,s,a)=>{try{if(c("InteractionService",`Logging dictionary lookup for user ${t}, term ${s}`,"info"),!await Ne(t,Le.DEFINITION_LOOKUP,{bookId:r,sectionId:i,content:s,definitionFound:a}))throw new Error("Failed to log dictionary lookup")}catch(o){throw q(o,"interactionService","logDictionaryLookup")}},logAiInteraction:async(t,r,i,s,a)=>{try{if(c("InteractionService",`Logging AI interaction for user ${t}`,"info"),!await Ne(t,Le.AI_QUERY,{bookId:r,sectionId:i,content:s,response:a}))throw new Error("Failed to log AI interaction")}catch(o){throw q(o,"interactionService","logAiInteraction")}},logHighlight:async(t,r,i,s)=>{try{if(c("InteractionService",`Logging highlight for user ${t}`,"info"),!await Ne(t,Le.NOTE_CREATION,{bookId:r,sectionId:i,content:s,type:"highlight"}))throw new Error("Failed to log highlight")}catch(a){throw q(a,"interactionService","logHighlight")}},getUserInteractions:async(t,r,i=100)=>{try{c("InteractionService",`Getting interactions for user ${t}`,"info");let a=(await z()).from("interactions").select("*").eq("user_id",t).order("created_at",{ascending:!1}).limit(i);r&&(a=a.eq("book_id",r));const{data:o,error:d}=await a;if(d)throw d;return o||[]}catch(s){throw q(s,"interactionService","getUserInteractions")}},getInteractionStats:async(t,r)=>{try{c("InteractionService",`Getting interaction stats for user ${t}`,"info");let s=(await z()).from("interactions").select("event_type").eq("user_id",t);r&&(s=s.eq("book_id",r));const{data:a,error:o}=await s;if(o)throw o;const d={total:(a==null?void 0:a.length)||0,byType:{}};return a==null||a.forEach(h=>{const u=h.event_type;d.byType[u]=(d.byType[u]||0)+1}),d}catch(i){throw q(i,"interactionService","getInteractionStats")}}});ee.register("interactionService",async()=>{const n=await Po();M.register("interactionService",n)});const To=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),Do=async()=>{c("MonitoringService","Creating monitoring service","info");const n={};return{logEvent:(r,i,s,a)=>{try{c("MonitoringService",`Event: ${r} - ${i}${s?` - ${s}`:""}`,"info",{value:a})}catch(o){c("MonitoringService","Error logging event","error",o)}},logError:(r,i={})=>{try{console.error(`[ERROR] ${r.message}`,{error:r,context:i}),c("MonitoringService",`Error: ${r.message}`,"error",{...i,stack:r.stack})}catch(s){console.error("Failed to log error:",s),console.error("Original error:",r)}},startPerformanceTimer:r=>{try{n[r]={start:performance.now()}}catch(i){c("MonitoringService",`Error starting performance timer for ${r}`,"error",i)}},endPerformanceTimer:r=>{try{if(!n[r]){c("MonitoringService",`No timer found for ${r}`,"warning");return}const i=performance.now(),s=n[r].start,a=i-s;n[r]={start:s,end:i,duration:a},c("MonitoringService",`Performance: ${r} - ${a.toFixed(2)}ms`,"info")}catch(i){c("MonitoringService",`Error ending performance timer for ${r}`,"error",i)}},getPerformanceMetrics:()=>{try{return{...n}}catch(r){return c("MonitoringService","Error getting performance metrics","error",r),{}}},clearPerformanceMetrics:()=>{try{Object.keys(n).forEach(r=>{delete n[r]}),c("MonitoringService","Performance metrics cleared","info")}catch(r){c("MonitoringService","Error clearing performance metrics","error",r)}}}};ee.register("monitoringService",async()=>{const n=await Do();M.register("monitoringService",n)});const Oo=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),$o=async()=>{c("DatabaseService","Creating database service","info");const n=await z();return{getCurrentSchemaVersion:()=>zs(),getAvailableMigrations:()=>migrations,applyMigrations:r=>qs(n),rollbackMigrations:r=>Ls(n),verifySchema:()=>Ms(),getTableInfo:async()=>{try{c("DatabaseService","Getting table information","info");const{data:r,error:i}=await n.rpc("get_tables");if(i)throw c("DatabaseService","Error getting table information","error",i),i;return{data:r,error:null}}catch(r){return c("DatabaseService","Exception in getTableInfo","error",r),{data:null,error:r}}},executeSQL:async r=>{try{c("DatabaseService","Executing SQL","info");const{error:i}=await n.rpc("exec_sql",{query:r});return i?(c("DatabaseService","Error executing SQL","error",i),{success:!1,error:i}):{success:!0,error:null}}catch(i){return c("DatabaseService","Exception in executeSQL","error",i),{success:!1,error:i}}},checkDatabaseConnection:async()=>{try{c("DatabaseService","Checking database connection","info");const{data:r,error:i}=await n.from("books").select("id").limit(1);return i?(c("DatabaseService","Database connection check failed","error",i),{connected:!1,error:i}):{connected:!0,error:null}}catch(r){return c("DatabaseService","Exception in checkDatabaseConnection","error",r),{connected:!1,error:r}}},getSchemaVersionHistory:async()=>{try{c("DatabaseService","Getting schema version history","info");const{error:r}=await n.from("schema_versions").select("id").limit(1);if(r)return c("DatabaseService","Schema versions table does not exist yet","info"),{data:[],error:null};const{data:i,error:s}=await n.from("schema_versions").select("*").order("version",{ascending:!1});return s?(c("DatabaseService","Error getting schema version history","error",s),{data:null,error:s}):{data:i,error:null}}catch(r){return c("DatabaseService","Exception in getSchemaVersionHistory","error",r),{data:null,error:r}}}}};ee.register("databaseService",async()=>{const n=await $o();M.register("databaseService",n)});const zs=async()=>(await M.getOrInitialize("databaseService",ee)).getCurrentSchemaVersion(),qs=async n=>(await M.getOrInitialize("databaseService",ee)).applyMigrations(n),Ls=async n=>(await M.getOrInitialize("databaseService",ee)).rollbackMigrations(n),Ms=async()=>(await M.getOrInitialize("databaseService",ee)).verifySchema(),zo=Object.freeze(Object.defineProperty({__proto__:null,applyMigrations:qs,getCurrentSchemaVersion:zs,rollbackMigrations:Ls,verifySchema:Ms},Symbol.toStringTag,{value:"Module"})),Bs=async()=>(c("AnalyticsService","Creating analytics service","info"),{identifyUser:(t,r={})=>{try{c("AnalyticsService",`Identify user: ${t}`,"info",r)}catch(i){c("AnalyticsService","Error identifying user","error",i)}},resetUser:()=>{try{c("AnalyticsService","Reset user","info")}catch(t){c("AnalyticsService","Error resetting user","error",t)}},trackEvent:(t,r={})=>{try{c("AnalyticsService",`Track event: ${t}`,"info",r)}catch(i){c("AnalyticsService","Error tracking event","error",i)}},trackPageView:(t,r={})=>{try{c("AnalyticsService",`Page view: ${t}`,"info",r)}catch(i){c("AnalyticsService","Error tracking page view","error",i)}},trackReaderAction:(t,r)=>{try{c("AnalyticsService",`Reader action: ${t}`,"info",r)}catch(i){c("AnalyticsService","Error tracking reader action","error",i)}},trackPerformance:(t,r,i={})=>{try{c("AnalyticsService",`Performance ${t}: ${r}ms`,"info",i)}catch(s){c("AnalyticsService","Error tracking performance","error",s)}}});ee.register("analyticsService",async()=>{const n=await Bs();M.register("analyticsService",n)});const qo=Object.freeze(Object.defineProperty({__proto__:null,createAnalyticsService:Bs},Symbol.toStringTag,{value:"Module"}));let Kn=!1;async function Lo(n={}){if(Kn&&!n.forceReload){c("ServiceInitializer","Services already initialized","info");return}try{Ga(),c("ServiceInitializer","Initializing all services...","info"),console.log("Initializing all services...");const t=as();if(c("ServiceInitializer",`Initialization order: ${t.join(", ")}`,"info"),await ee.initializeAll({useTopologicalOrder:!0}),n.requiredServices&&n.requiredServices.length>0){const r=n.requiredServices.filter(i=>!M.has(i));if(r.length>0){const i=`Missing required services: ${r.join(", ")}`;throw c("ServiceInitializer",i,"error"),new le(i,Qe.SERVICE_INITIALIZATION_ERROR,{missingServices:r})}}Kn=!0,c("ServiceInitializer","All services initialized successfully","success"),console.log("All services initialized successfully")}catch(t){const r=t instanceof Error?t.message:String(t);throw c("ServiceInitializer",`Error initializing services: ${r}`,"error"),console.error("Error initializing services:",t),t instanceof le?t:new le(`Failed to initialize services: ${r}`,Qe.SERVICE_INITIALIZATION_ERROR,{originalError:t})}}function Mo(){const[n,t]=g.useState([]),[r,i]=g.useState(!0),[s,a]=g.useState(!1),[o,d]=g.useState(null),h=async(b=!1)=>{if(i(!0),d(null),b){a(!0);try{c("ServiceStatusCheck","Reinitializing all services","info"),await Lo({forceReload:!0}),c("ServiceStatusCheck","Services reinitialized successfully","success")}catch(_){const w=_ instanceof Error?_.message:String(_);c("ServiceStatusCheck",`Failed to reinitialize services: ${w}`,"error"),d(`Failed to reinitialize services: ${w}`)}finally{a(!1)}}const y=Object.keys(nt).map(_=>{try{return Na.has(_)?{name:_,status:"registered",dependencies:nt[_]||[]}:{name:_,status:"unregistered",dependencies:nt[_]||[]}}catch(w){return{name:_,status:"error",error:w instanceof Error?w.message:String(w),dependencies:nt[_]||[]}}});t(y),i(!1)};g.useEffect(()=>{h()},[]);const u=b=>{switch(b){case"registered":return"success";case"unregistered":return"warning";case"error":return"error";default:return"warning"}},f=b=>{switch(b){case"registered":return e.jsx(yr,{color:"success"});case"unregistered":return e.jsx(ns,{color:"warning"});case"error":return e.jsx(Hr,{color:"error"});default:return e.jsx(Va,{color:"info"})}},m=n.filter(b=>b.status==="registered").length,v=n.length;return e.jsxs(O,{sx:{p:3,maxWidth:800,mx:"auto",mt:4},children:[e.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(l,{variant:"h5",children:"Service Status Check"}),e.jsx(A,{variant:"outlined",onClick:()=>h(!0),disabled:r||s,startIcon:s?e.jsx(ge,{size:20}):e.jsx(Da,{}),children:s?"Reinitializing...":"Refresh Services"})]}),o&&e.jsx(je,{severity:"error",sx:{mb:3},children:o}),e.jsx(Fr,{sx:{mb:3,bgcolor:"background.default"},children:e.jsx(rt,{children:e.jsxs(j,{container:!0,spacing:2,children:[e.jsx(j,{item:!0,xs:12,sm:4,children:e.jsxs(x,{sx:{textAlign:"center"},children:[e.jsx(l,{variant:"h6",children:"Total Services"}),e.jsx(l,{variant:"h3",children:v})]})}),e.jsx(j,{item:!0,xs:12,sm:4,children:e.jsxs(x,{sx:{textAlign:"center"},children:[e.jsx(l,{variant:"h6",children:"Registered"}),e.jsx(l,{variant:"h3",color:"success.main",children:m})]})}),e.jsx(j,{item:!0,xs:12,sm:4,children:e.jsxs(x,{sx:{textAlign:"center"},children:[e.jsx(l,{variant:"h6",children:"Unregistered"}),e.jsx(l,{variant:"h3",color:"warning.main",children:v-m})]})})]})})}),e.jsx(l,{variant:"subtitle1",gutterBottom:!0,children:r?"Checking services...":`${m} of ${v} services registered`}),r?e.jsx(x,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(ge,{})}):e.jsx(we,{children:n.map(b=>e.jsx(me,{divider:!0,secondaryAction:f(b.status),children:e.jsx(xe,{primary:b.name,secondary:e.jsxs(e.Fragment,{children:[e.jsx(_e,{size:"small",label:b.status,color:u(b.status),sx:{mr:1}}),b.error&&e.jsxs(l,{color:"error",variant:"caption",display:"block",children:["Error: ",b.error]}),b.dependencies.length>0&&e.jsxs(l,{variant:"caption",display:"block",children:["Dependencies: ",b.dependencies.join(", ")]})]})})},b.name))})]})}var Ot={},Xn;function Bo(){if(Xn)return Ot;Xn=1;var n=W();Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.default=void 0;var t=n(Y()),r=H();return Ot.default=(0,t.default)((0,r.jsx)("path",{d:"M12 2c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2m9 7h-6v13h-2v-6h-2v6H9V9H3V7h18z"}),"Accessibility"),Ot}var Uo=Bo();const Vo=G(Uo),Cn={fontSize:100,lineHeight:1.5,contrast:"normal",reducedMotion:!1,dyslexicFont:!1},Us=Z.createContext({settings:Cn,updateSettings:()=>{}}),Vs=()=>Z.useContext(Us),Fo=({children:n})=>{const[t,r]=g.useState(()=>{const s=localStorage.getItem("accessibility_settings");if(s)try{return JSON.parse(s)}catch{return Cn}return Cn}),i=s=>{const a={...t,...s};r(a),localStorage.setItem("accessibility_settings",JSON.stringify(a)),ei(a)};return Z.useEffect(()=>{ei(t)},[]),e.jsx(Us.Provider,{value:{settings:t,updateSettings:i},children:n})},ei=n=>{document.documentElement.style.setProperty("--base-font-size",`${n.fontSize}%`),document.documentElement.style.setProperty("--base-line-height",`${n.lineHeight}`),n.contrast==="high"?document.body.classList.add("high-contrast"):document.body.classList.remove("high-contrast"),n.reducedMotion?document.body.classList.add("reduced-motion"):document.body.classList.remove("reduced-motion"),n.dyslexicFont?document.body.classList.add("dyslexic-font"):document.body.classList.remove("dyslexic-font")},No=()=>{const{settings:n,updateSettings:t}=Vs(),[r,i]=g.useState(null),s=m=>{i(m.currentTarget)},a=()=>{i(null)},o=(m,v)=>{t({fontSize:v})},d=(m,v)=>{t({lineHeight:v})},h=()=>{t({contrast:n.contrast==="normal"?"high":"normal"})},u=()=>{t({reducedMotion:!n.reducedMotion})},f=()=>{t({dyslexicFont:!n.dyslexicFont})};return e.jsxs(e.Fragment,{children:[e.jsx($e,{"aria-label":"Accessibility settings",onClick:s,color:"inherit",children:e.jsx(Vo,{})}),e.jsxs(Sn,{anchorEl:r,open:!!r,onClose:a,PaperProps:{sx:{width:320,maxWidth:"100%",p:2}},children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Accessibility Settings"}),e.jsxs(l,{id:"font-size-slider",gutterBottom:!0,children:["Font Size: ",n.fontSize,"%"]}),e.jsx(Ln,{value:n.fontSize,onChange:o,"aria-labelledby":"font-size-slider",min:50,max:200,step:10,valueLabelDisplay:"auto",sx:{mb:3}}),e.jsxs(l,{id:"line-height-slider",gutterBottom:!0,children:["Line Height: ",n.lineHeight]}),e.jsx(Ln,{value:n.lineHeight,onChange:d,"aria-labelledby":"line-height-slider",min:1,max:3,step:.1,valueLabelDisplay:"auto",sx:{mb:3}}),e.jsx(ie,{sx:{my:2}}),e.jsx(pr,{control:e.jsx(Nr,{checked:n.contrast==="high",onChange:h}),label:"High Contrast"}),e.jsx(pr,{control:e.jsx(Nr,{checked:n.reducedMotion,onChange:u}),label:"Reduced Motion"}),e.jsx(pr,{control:e.jsx(Nr,{checked:n.dyslexicFont,onChange:f}),label:"Dyslexic-Friendly Font"})]})]})};function Fs(n){var t,r,i="";if(typeof n=="string"||typeof n=="number")i+=n;else if(typeof n=="object")if(Array.isArray(n))for(t=0;t<n.length;t++)n[t]&&(r=Fs(n[t]))&&(i&&(i+=" "),i+=r);else for(t in n)n[t]&&(i&&(i+=" "),i+=t);return i}function xt(){for(var n,t,r=0,i="";r<arguments.length;)(n=arguments[r++])&&(t=Fs(n))&&(i&&(i+=" "),i+=t);return i}let Wo={data:""},Ho=n=>typeof window=="object"?((n?n.querySelector("#_goober"):window._goober)||Object.assign((n||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:n||Wo,Go=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,Yo=/\/\*[^]*?\*\/|  +/g,ti=/\n+/g,ut=(n,t)=>{let r="",i="",s="";for(let a in n){let o=n[a];a[0]=="@"?a[1]=="i"?r=a+" "+o+";":i+=a[1]=="f"?ut(o,a):a+"{"+ut(o,a[1]=="k"?"":t)+"}":typeof o=="object"?i+=ut(o,t?t.replace(/([^,])+/g,d=>a.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,h=>/&/.test(h)?h.replace(/&/g,d):d?d+" "+h:h)):a):o!=null&&(a=/^--/.test(a)?a:a.replace(/[A-Z]/g,"-$&").toLowerCase(),s+=ut.p?ut.p(a,o):a+":"+o+";")}return r+(t&&s?t+"{"+s+"}":s)+i},Ge={},Ns=n=>{if(typeof n=="object"){let t="";for(let r in n)t+=r+Ns(n[r]);return t}return n},Qo=(n,t,r,i,s)=>{let a=Ns(n),o=Ge[a]||(Ge[a]=(h=>{let u=0,f=11;for(;u<h.length;)f=101*f+h.charCodeAt(u++)>>>0;return"go"+f})(a));if(!Ge[o]){let h=a!==n?n:(u=>{let f,m,v=[{}];for(;f=Go.exec(u.replace(Yo,""));)f[4]?v.shift():f[3]?(m=f[3].replace(ti," ").trim(),v.unshift(v[0][m]=v[0][m]||{})):v[0][f[1]]=f[2].replace(ti," ").trim();return v[0]})(n);Ge[o]=ut(s?{["@keyframes "+o]:h}:h,r?"":"."+o)}let d=r&&Ge.g?Ge.g:null;return r&&(Ge.g=Ge[o]),((h,u,f,m)=>{m?u.data=u.data.replace(m,h):u.data.indexOf(h)===-1&&(u.data=f?h+u.data:u.data+h)})(Ge[o],t,i,d),o},Zo=(n,t,r)=>n.reduce((i,s,a)=>{let o=t[a];if(o&&o.call){let d=o(r),h=d&&d.props&&d.props.className||/^go/.test(d)&&d;o=h?"."+h:d&&typeof d=="object"?d.props?"":ut(d,""):d===!1?"":d}return i+s+(o??"")},"");function Dn(n){let t=this||{},r=n.call?n(t.p):n;return Qo(r.unshift?r.raw?Zo(r,[].slice.call(arguments,1),t.p):r.reduce((i,s)=>Object.assign(i,s&&s.call?s(t.p):s),{}):r,Ho(t.target),t.g,t.o,t.k)}Dn.bind({g:1});Dn.bind({k:1});function Jo(n,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}function Ws(n,t,r){return t&&Jo(n.prototype,t),n}function X(){return X=Object.assign||function(n){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])}return n},X.apply(this,arguments)}function Hs(n,t){n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.__proto__=t}function Ir(n,t){if(n==null)return{};var r={},i=Object.keys(n),s,a;for(a=0;a<i.length;a++)s=i[a],!(t.indexOf(s)>=0)&&(r[s]=n[s]);return r}function ri(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}var ni=function(){return""},Gs=Z.createContext({enqueueSnackbar:ni,closeSnackbar:ni}),dt={downXs:"@media (max-width:599.95px)",upSm:"@media (min-width:600px)"},ii=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},On=function(t){return""+ii(t.vertical)+ii(t.horizontal)},zr=function(t){return!!t||t===0},qr="unmounted",bt="exited",St="entering",$t="entered",si="exiting",$n=function(n){Hs(t,n);function t(i){var s;s=n.call(this,i)||this;var a=i.appear,o;return s.appearStatus=null,i.in?a?(o=bt,s.appearStatus=St):o=$t:i.unmountOnExit||i.mountOnEnter?o=qr:o=bt,s.state={status:o},s.nextCallback=null,s}t.getDerivedStateFromProps=function(s,a){var o=s.in;return o&&a.status===qr?{status:bt}:null};var r=t.prototype;return r.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},r.componentDidUpdate=function(s){var a=null;if(s!==this.props){var o=this.state.status;this.props.in?o!==St&&o!==$t&&(a=St):(o===St||o===$t)&&(a=si)}this.updateStatus(!1,a)},r.componentWillUnmount=function(){this.cancelNextCallback()},r.getTimeouts=function(){var s=this.props.timeout,a=s,o=s;return s!=null&&typeof s!="number"&&typeof s!="string"&&(o=s.exit,a=s.enter),{exit:o,enter:a}},r.updateStatus=function(s,a){s===void 0&&(s=!1),a!==null?(this.cancelNextCallback(),a===St?this.performEnter(s):this.performExit()):this.props.unmountOnExit&&this.state.status===bt&&this.setState({status:qr})},r.performEnter=function(s){var a=this,o=this.props.enter,d=s,h=this.getTimeouts();if(!s&&!o){this.safeSetState({status:$t},function(){a.props.onEntered&&a.props.onEntered(a.node,d)});return}this.props.onEnter&&this.props.onEnter(this.node,d),this.safeSetState({status:St},function(){a.props.onEntering&&a.props.onEntering(a.node,d),a.onTransitionEnd(h.enter,function(){a.safeSetState({status:$t},function(){a.props.onEntered&&a.props.onEntered(a.node,d)})})})},r.performExit=function(){var s=this,a=this.props.exit,o=this.getTimeouts();if(!a){this.safeSetState({status:bt},function(){s.props.onExited&&s.props.onExited(s.node)});return}this.props.onExit&&this.props.onExit(this.node),this.safeSetState({status:si},function(){s.props.onExiting&&s.props.onExiting(s.node),s.onTransitionEnd(o.exit,function(){s.safeSetState({status:bt},function(){s.props.onExited&&s.props.onExited(s.node)})})})},r.cancelNextCallback=function(){this.nextCallback!==null&&this.nextCallback.cancel&&(this.nextCallback.cancel(),this.nextCallback=null)},r.safeSetState=function(s,a){a=this.setNextCallback(a),this.setState(s,a)},r.setNextCallback=function(s){var a=this,o=!0;return this.nextCallback=function(){o&&(o=!1,a.nextCallback=null,s())},this.nextCallback.cancel=function(){o=!1},this.nextCallback},r.onTransitionEnd=function(s,a){this.setNextCallback(a);var o=s==null&&!this.props.addEndListener;if(!this.node||o){setTimeout(this.nextCallback,0);return}this.props.addEndListener&&this.props.addEndListener(this.node,this.nextCallback),s!=null&&setTimeout(this.nextCallback,s)},r.render=function(){var s=this.state.status;if(s===qr)return null;var a=this.props,o=a.children,d=Ir(a,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]);return o(s,d)},Ws(t,[{key:"node",get:function(){var s,a=(s=this.props.nodeRef)===null||s===void 0?void 0:s.current;if(!a)throw new Error("notistack - Custom snackbar is not refForwarding");return a}}]),t}(Z.Component);function jt(){}$n.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:jt,onEntering:jt,onEntered:jt,onExit:jt,onExiting:jt,onExited:jt};function ai(n,t){typeof n=="function"?n(t):n&&(n.current=t)}function Rn(n,t){return g.useMemo(function(){return n==null&&t==null?null:function(r){ai(n,r),ai(t,r)}},[n,t])}function Gr(n){var t=n.timeout,r=n.style,i=r===void 0?{}:r,s=n.mode;return{duration:typeof t=="object"?t[s]||0:t,easing:i.transitionTimingFunction,delay:i.transitionDelay}}var In={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},Ys=function(t){t.scrollTop=t.scrollTop},oi=function(t){return Math.round(t)+"ms"};function _t(n,t){n===void 0&&(n=["all"]);var r=t||{},i=r.duration,s=i===void 0?300:i,a=r.easing,o=a===void 0?In.easeInOut:a,d=r.delay,h=d===void 0?0:d,u=Array.isArray(n)?n:[n];return u.map(function(f){var m=typeof s=="string"?s:oi(s),v=typeof h=="string"?h:oi(h);return f+" "+m+" "+o+" "+v}).join(",")}function Ko(n){return n&&n.ownerDocument||document}function Qs(n){var t=Ko(n);return t.defaultView||window}function Xo(n,t){t===void 0&&(t=166);var r;function i(){for(var s=this,a=arguments.length,o=new Array(a),d=0;d<a;d++)o[d]=arguments[d];var h=function(){n.apply(s,o)};clearTimeout(r),r=setTimeout(h,t)}return i.clear=function(){clearTimeout(r)},i}function ec(n,t){var r=t.getBoundingClientRect(),i=Qs(t),s;if(t.fakeTransform)s=t.fakeTransform;else{var a=i.getComputedStyle(t);s=a.getPropertyValue("-webkit-transform")||a.getPropertyValue("transform")}var o=0,d=0;if(s&&s!=="none"&&typeof s=="string"){var h=s.split("(")[1].split(")")[0].split(",");o=parseInt(h[4],10),d=parseInt(h[5],10)}switch(n){case"left":return"translateX("+(i.innerWidth+o-r.left)+"px)";case"right":return"translateX(-"+(r.left+r.width-o)+"px)";case"up":return"translateY("+(i.innerHeight+d-r.top)+"px)";default:return"translateY(-"+(r.top+r.height-d)+"px)"}}function Lr(n,t){if(t){var r=ec(n,t);r&&(t.style.webkitTransform=r,t.style.transform=r)}}var Zs=g.forwardRef(function(n,t){var r=n.children,i=n.direction,s=i===void 0?"down":i,a=n.in,o=n.style,d=n.timeout,h=d===void 0?0:d,u=n.onEnter,f=n.onEntered,m=n.onExit,v=n.onExited,b=Ir(n,["children","direction","in","style","timeout","onEnter","onEntered","onExit","onExited"]),p=g.useRef(null),y=Rn(r.ref,p),_=Rn(y,t),w=function(P,Q){Lr(s,P),Ys(P),u&&u(P,Q)},S=function(P){var Q=(o==null?void 0:o.transitionTimingFunction)||In.easeOut,V=Gr({timeout:h,mode:"enter",style:X({},o,{transitionTimingFunction:Q})});P.style.webkitTransition=_t("-webkit-transform",V),P.style.transition=_t("transform",V),P.style.webkitTransform="none",P.style.transform="none"},k=function(P){var Q=(o==null?void 0:o.transitionTimingFunction)||In.sharp,V=Gr({timeout:h,mode:"exit",style:X({},o,{transitionTimingFunction:Q})});P.style.webkitTransition=_t("-webkit-transform",V),P.style.transition=_t("transform",V),Lr(s,P),m&&m(P)},I=function(P){P.style.webkitTransition="",P.style.transition="",v&&v(P)},E=g.useCallback(function(){p.current&&Lr(s,p.current)},[s]);return g.useEffect(function(){if(!(a||s==="down"||s==="right")){var $=Xo(function(){p.current&&Lr(s,p.current)}),P=Qs(p.current);return P.addEventListener("resize",$),function(){$.clear(),P.removeEventListener("resize",$)}}},[s,a]),g.useEffect(function(){a||E()},[a,E]),g.createElement($n,Object.assign({appear:!0,nodeRef:p,onEnter:w,onEntered:f,onEntering:S,onExit:k,onExited:I,in:a,timeout:h},b),function($,P){return g.cloneElement(r,X({ref:_,style:X({visibility:$==="exited"&&!a?"hidden":void 0},o,{},r.props.style)},P))})});Zs.displayName="Slide";var Xr=function(t){return Z.createElement("svg",Object.assign({viewBox:"0 0 24 24",focusable:"false",style:{fontSize:20,marginInlineEnd:8,userSelect:"none",width:"1em",height:"1em",display:"inline-block",fill:"currentColor",flexShrink:0}},t))},tc=function(){return Z.createElement(Xr,null,Z.createElement("path",{d:`M12 2C6.5 2 2 6.5 2 12S6.5 22 12 22 22 17.5 22 12 17.5 2 12 2M10 17L5 12L6.41
        10.59L10 14.17L17.59 6.58L19 8L10 17Z`}))},rc=function(){return Z.createElement(Xr,null,Z.createElement("path",{d:"M13,14H11V10H13M13,18H11V16H13M1,21H23L12,2L1,21Z"}))},nc=function(){return Z.createElement(Xr,null,Z.createElement("path",{d:`M12,2C17.53,2 22,6.47 22,12C22,17.53 17.53,22 12,22C6.47,22 2,17.53 2,12C2,
        6.47 6.47,2 12,2M15.59,7L12,10.59L8.41,7L7,8.41L10.59,12L7,15.59L8.41,17L12,
        13.41L15.59,17L17,15.59L13.41,12L17,8.41L15.59,7Z`}))},ic=function(){return Z.createElement(Xr,null,Z.createElement("path",{d:`M13,9H11V7H13M13,17H11V11H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,
        0 22,12A10,10 0 0,0 12,2Z`}))},sc={default:void 0,success:Z.createElement(tc,null),warning:Z.createElement(rc,null),error:Z.createElement(nc,null),info:Z.createElement(ic,null)},pt={maxSnack:3,persist:!1,hideIconVariant:!1,disableWindowBlurListener:!1,variant:"default",autoHideDuration:5e3,iconVariant:sc,anchorOrigin:{vertical:"bottom",horizontal:"left"},TransitionComponent:Zs,transitionDuration:{enter:225,exit:195}},ac=function(t,r){var i=function(a){return typeof a=="number"||a===null};return i(t)?t:i(r)?r:pt.autoHideDuration},oc=function(t,r){var i=function(a,o){return o.some(function(d){return typeof a===d})};return i(t,["string","number"])?t:i(t,["object"])?X({},pt.transitionDuration,{},i(r,["object"])&&r,{},t):i(r,["string","number"])?r:i(r,["object"])?X({},pt.transitionDuration,{},r):pt.transitionDuration},cc=function(t,r){return function(i,s){return s===void 0&&(s=!1),s?X({},pt[i],{},r[i],{},t[i]):i==="autoHideDuration"?ac(t.autoHideDuration,r.autoHideDuration):i==="transitionDuration"?oc(t.transitionDuration,r.transitionDuration):t[i]||r[i]||pt[i]}};function Ar(n){return Object.entries(n).reduce(function(t,r){var i,s=r[0],a=r[1];return X({},t,(i={},i[s]=Dn(a),i))},{})}var Et={SnackbarContainer:"notistack-SnackbarContainer",Snackbar:"notistack-Snackbar",CollapseWrapper:"notistack-CollapseWrapper",MuiContent:"notistack-MuiContent",MuiContentVariant:function(t){return"notistack-MuiContent-"+t}},ci=Ar({root:{height:0},entered:{height:"auto"}}),ln="0px",dn=175,Js=g.forwardRef(function(n,t){var r=n.children,i=n.in,s=n.onExited,a=g.useRef(null),o=g.useRef(null),d=Rn(t,o),h=function(){return a.current?a.current.clientHeight:0},u=function(y){y.style.height=ln},f=function(y){var _=h(),w=Gr({timeout:dn,mode:"enter"}),S=w.duration,k=w.easing;y.style.transitionDuration=typeof S=="string"?S:S+"ms",y.style.height=_+"px",y.style.transitionTimingFunction=k||""},m=function(y){y.style.height="auto"},v=function(y){y.style.height=h()+"px"},b=function(y){Ys(y);var _=Gr({timeout:dn,mode:"exit"}),w=_.duration,S=_.easing;y.style.transitionDuration=typeof w=="string"?w:w+"ms",y.style.height=ln,y.style.transitionTimingFunction=S||""};return g.createElement($n,{in:i,unmountOnExit:!0,onEnter:u,onEntered:m,onEntering:f,onExit:v,onExited:s,onExiting:b,nodeRef:o,timeout:dn},function(p,y){return g.createElement("div",Object.assign({ref:d,className:xt(ci.root,p==="entered"&&ci.entered),style:X({pointerEvents:"all",overflow:"hidden",minHeight:ln,transition:_t("height")},p==="entered"&&{overflow:"visible"},{},p==="exited"&&!i&&{visibility:"hidden"})},y),g.createElement("div",{ref:a,className:Et.CollapseWrapper,style:{display:"flex",width:"100%"}},r))})});Js.displayName="Collapse";var li={right:"left",left:"right",bottom:"up",top:"down"},lc=function(t){return t.horizontal!=="center"?li[t.horizontal]:li[t.vertical]},dc=function(t){return"anchorOrigin"+On(t)},uc=function(t){t===void 0&&(t={});var r={containerRoot:!0,containerAnchorOriginTopCenter:!0,containerAnchorOriginBottomCenter:!0,containerAnchorOriginTopRight:!0,containerAnchorOriginBottomRight:!0,containerAnchorOriginTopLeft:!0,containerAnchorOriginBottomLeft:!0};return Object.keys(t).filter(function(i){return!r[i]}).reduce(function(i,s){var a;return X({},i,(a={},a[s]=t[s],a))},{})},hc=function(){};function br(n,t){return n.reduce(function(r,i){return i==null?r:function(){for(var a=arguments.length,o=new Array(a),d=0;d<a;d++)o[d]=arguments[d];var h=[].concat(o);t&&h.indexOf(t)===-1&&h.push(t),r.apply(this,h),i.apply(this,h)}},hc)}var gc=typeof window<"u"?g.useLayoutEffect:g.useEffect;function di(n){var t=g.useRef(n);return gc(function(){t.current=n}),g.useCallback(function(){return t.current.apply(void 0,arguments)},[])}var Ks=g.forwardRef(function(n,t){var r=n.children,i=n.className,s=n.autoHideDuration,a=n.disableWindowBlurListener,o=a===void 0?!1:a,d=n.onClose,h=n.id,u=n.open,f=n.SnackbarProps,m=f===void 0?{}:f,v=g.useRef(),b=di(function(){d&&d.apply(void 0,arguments)}),p=di(function(k){!d||k==null||(v.current&&clearTimeout(v.current),v.current=setTimeout(function(){b(null,"timeout",h)},k))});g.useEffect(function(){return u&&p(s),function(){v.current&&clearTimeout(v.current)}},[u,s,p]);var y=function(){v.current&&clearTimeout(v.current)},_=g.useCallback(function(){s!=null&&p(s*.5)},[s,p]),w=function(I){m.onMouseEnter&&m.onMouseEnter(I),y()},S=function(I){m.onMouseLeave&&m.onMouseLeave(I),_()};return g.useEffect(function(){if(!o&&u)return window.addEventListener("focus",_),window.addEventListener("blur",y),function(){window.removeEventListener("focus",_),window.removeEventListener("blur",y)}},[o,_,u]),g.createElement("div",Object.assign({ref:t},m,{className:xt(Et.Snackbar,i),onMouseEnter:w,onMouseLeave:S}),r)});Ks.displayName="Snackbar";var un,fc=Ar({root:(un={display:"flex",flexWrap:"wrap",flexGrow:1},un[dt.upSm]={flexGrow:"initial",minWidth:"288px"},un)}),Xs=g.forwardRef(function(n,t){var r=n.className,i=Ir(n,["className"]);return Z.createElement("div",Object.assign({ref:t,className:xt(fc.root,r)},i))});Xs.displayName="SnackbarContent";var zt=Ar({root:{backgroundColor:"#313131",fontSize:"0.875rem",lineHeight:1.43,letterSpacing:"0.01071em",color:"#fff",alignItems:"center",padding:"6px 16px",borderRadius:"4px",boxShadow:"0px 3px 5px -1px rgba(0,0,0,0.2),0px 6px 10px 0px rgba(0,0,0,0.14),0px 1px 18px 0px rgba(0,0,0,0.12)"},lessPadding:{paddingLeft:8*2.5+"px"},default:{backgroundColor:"#313131"},success:{backgroundColor:"#43a047"},error:{backgroundColor:"#d32f2f"},warning:{backgroundColor:"#ff9800"},info:{backgroundColor:"#2196f3"},message:{display:"flex",alignItems:"center",padding:"8px 0"},action:{display:"flex",alignItems:"center",marginLeft:"auto",paddingLeft:"16px",marginRight:"-8px"}}),ui="notistack-snackbar",ea=g.forwardRef(function(n,t){var r=n.id,i=n.message,s=n.action,a=n.iconVariant,o=n.variant,d=n.hideIconVariant,h=n.style,u=n.className,f=a[o],m=s;return typeof m=="function"&&(m=m(r)),Z.createElement(Xs,{ref:t,role:"alert","aria-describedby":ui,style:h,className:xt(Et.MuiContent,Et.MuiContentVariant(o),zt.root,zt[o],u,!d&&f&&zt.lessPadding)},Z.createElement("div",{id:ui,className:zt.message},d?null:f,i),m&&Z.createElement("div",{className:zt.action},m))});ea.displayName="MaterialDesignContent";var pc=g.memo(ea),mc=Ar({wrappedRoot:{width:"100%",position:"relative",transform:"translateX(0)",top:0,right:0,bottom:0,left:0,minWidth:"288px"}}),xc=function(t){var r=g.useRef(),i=g.useState(!0),s=i[0],a=i[1],o=br([t.snack.onClose,t.onClose]),d=function(){t.snack.requestClose&&o(null,"instructed",t.snack.id)},h=g.useCallback(function(){r.current=setTimeout(function(){a(function(V){return!V})},125)},[]);g.useEffect(function(){return function(){r.current&&clearTimeout(r.current)}},[]);var u=t.snack,f=t.classes,m=t.Component,v=m===void 0?pc:m,b=g.useMemo(function(){return uc(f)},[f]),p=u.open,y=u.SnackbarProps,_=u.TransitionComponent,w=u.TransitionProps,S=u.transitionDuration,k=u.disableWindowBlurListener,I=u.content,E=Ir(u,["open","SnackbarProps","TransitionComponent","TransitionProps","transitionDuration","disableWindowBlurListener","content","entered","requestClose","onEnter","onEntered","onExit","onExited"]),$=X({direction:lc(E.anchorOrigin),timeout:S},w),P=I;typeof P=="function"&&(P=P(E.id,E.message));var Q=["onEnter","onEntered","onExit","onExited"].reduce(function(V,te){var C;return X({},V,(C={},C[te]=br([t.snack[te],t[te]],E.id),C))},{});return Z.createElement(Js,{in:s,onExited:Q.onExited},Z.createElement(Ks,{open:p,id:E.id,disableWindowBlurListener:k,autoHideDuration:E.autoHideDuration,className:xt(mc.wrappedRoot,b.root,b[dc(E.anchorOrigin)]),SnackbarProps:y,onClose:o},Z.createElement(_,Object.assign({},$,{appear:!0,in:p,onExit:Q.onExit,onExited:h,onEnter:Q.onEnter,onEntered:br([Q.onEntered,d],E.id)}),P||Z.createElement(v,Object.assign({},E)))))},qt,hn,Mr,Br,gn,Ye={view:{default:20},snackbar:{default:6,dense:2}},hi="."+Et.CollapseWrapper,fn=16,Ur=Ar({root:(qt={boxSizing:"border-box",display:"flex",maxHeight:"100%",position:"fixed",zIndex:1400,height:"auto",width:"auto",transition:_t(["top","right","bottom","left","max-width"],{duration:300,easing:"ease"}),pointerEvents:"none"},qt[hi]={padding:Ye.snackbar.default+"px 0px",transition:"padding 300ms ease 0ms"},qt.maxWidth="calc(100% - "+Ye.view.default*2+"px)",qt[dt.downXs]={width:"100%",maxWidth:"calc(100% - "+fn*2+"px)"},qt),rootDense:(hn={},hn[hi]={padding:Ye.snackbar.dense+"px 0px"},hn),top:{top:Ye.view.default-Ye.snackbar.default+"px",flexDirection:"column"},bottom:{bottom:Ye.view.default-Ye.snackbar.default+"px",flexDirection:"column-reverse"},left:(Mr={left:Ye.view.default+"px"},Mr[dt.upSm]={alignItems:"flex-start"},Mr[dt.downXs]={left:fn+"px"},Mr),right:(Br={right:Ye.view.default+"px"},Br[dt.upSm]={alignItems:"flex-end"},Br[dt.downXs]={right:fn+"px"},Br),center:(gn={left:"50%",transform:"translateX(-50%)"},gn[dt.upSm]={alignItems:"center"},gn)}),vc=function(t){var r=t.classes,i=r===void 0?{}:r,s=t.anchorOrigin,a=t.dense,o=t.children,d=xt(Et.SnackbarContainer,Ur[s.vertical],Ur[s.horizontal],Ur.root,i.containerRoot,i["containerAnchorOrigin"+On(s)],a&&Ur.rootDense);return Z.createElement("div",{className:d},o)},yc=g.memo(vc),gi=function(t){var r=typeof t=="string"||g.isValidElement(t);return!r},bc=function(n){Hs(t,n);function t(i){var s;return s=n.call(this,i)||this,s.enqueueSnackbar=function(a,o){if(o===void 0&&(o={}),a==null)throw new Error("enqueueSnackbar called with invalid argument");var d=gi(a)?a:o,h=gi(a)?a.message:a,u=d.key,f=d.preventDuplicate,m=Ir(d,["key","preventDuplicate"]),v=zr(u),b=v?u:new Date().getTime()+Math.random(),p=cc(m,s.props),y=X({id:b},m,{message:h,open:!0,entered:!1,requestClose:!1,persist:p("persist"),action:p("action"),content:p("content"),variant:p("variant"),anchorOrigin:p("anchorOrigin"),disableWindowBlurListener:p("disableWindowBlurListener"),autoHideDuration:p("autoHideDuration"),hideIconVariant:p("hideIconVariant"),TransitionComponent:p("TransitionComponent"),transitionDuration:p("transitionDuration"),TransitionProps:p("TransitionProps",!0),iconVariant:p("iconVariant",!0),style:p("style",!0),SnackbarProps:p("SnackbarProps",!0),className:xt(s.props.className,m.className)});return y.persist&&(y.autoHideDuration=void 0),s.setState(function(_){if(f===void 0&&s.props.preventDuplicate||f){var w=function(E){return v?E.id===b:E.message===h},S=_.queue.findIndex(w)>-1,k=_.snacks.findIndex(w)>-1;if(S||k)return _}return s.handleDisplaySnack(X({},_,{queue:[].concat(_.queue,[y])}))}),b},s.handleDisplaySnack=function(a){var o=a.snacks;return o.length>=s.maxSnack?s.handleDismissOldest(a):s.processQueue(a)},s.processQueue=function(a){var o=a.queue,d=a.snacks;return o.length>0?X({},a,{snacks:[].concat(d,[o[0]]),queue:o.slice(1,o.length)}):a},s.handleDismissOldest=function(a){if(a.snacks.some(function(f){return!f.open||f.requestClose}))return a;var o=!1,d=!1,h=a.snacks.reduce(function(f,m){return f+(m.open&&m.persist?1:0)},0);h===s.maxSnack&&(d=!0);var u=a.snacks.map(function(f){return!o&&(!f.persist||d)?(o=!0,f.entered?(f.onClose&&f.onClose(null,"maxsnack",f.id),s.props.onClose&&s.props.onClose(null,"maxsnack",f.id),X({},f,{open:!1})):X({},f,{requestClose:!0})):X({},f)});return X({},a,{snacks:u})},s.handleEnteredSnack=function(a,o,d){if(!zr(d))throw new Error("handleEnteredSnack Cannot be called with undefined key");s.setState(function(h){var u=h.snacks;return{snacks:u.map(function(f){return f.id===d?X({},f,{entered:!0}):X({},f)})}})},s.handleCloseSnack=function(a,o,d){s.props.onClose&&s.props.onClose(a,o,d);var h=d===void 0;s.setState(function(u){var f=u.snacks,m=u.queue;return{snacks:f.map(function(v){return!h&&v.id!==d?X({},v):v.entered?X({},v,{open:!1}):X({},v,{requestClose:!0})}),queue:m.filter(function(v){return v.id!==d})}})},s.closeSnackbar=function(a){var o=s.state.snacks.find(function(d){return d.id===a});zr(a)&&o&&o.onClose&&o.onClose(null,"instructed",a),s.handleCloseSnack(null,"instructed",a)},s.handleExitedSnack=function(a,o){if(!zr(o))throw new Error("handleExitedSnack Cannot be called with undefined key");s.setState(function(d){var h=s.processQueue(X({},d,{snacks:d.snacks.filter(function(u){return u.id!==o})}));return h.queue.length===0?h:s.handleDismissOldest(h)})},s.enqueueSnackbar,s.closeSnackbar,s.state={snacks:[],queue:[],contextValue:{enqueueSnackbar:s.enqueueSnackbar.bind(ri(s)),closeSnackbar:s.closeSnackbar.bind(ri(s))}},s}var r=t.prototype;return r.render=function(){var s=this,a=this.state.contextValue,o=this.props,d=o.domRoot,h=o.children,u=o.dense,f=u===void 0?!1:u,m=o.Components,v=m===void 0?{}:m,b=o.classes,p=this.state.snacks.reduce(function(_,w){var S,k=On(w.anchorOrigin),I=_[k]||[];return X({},_,(S={},S[k]=[].concat(I,[w]),S))},{}),y=Object.keys(p).map(function(_){var w=p[_],S=w[0];return Z.createElement(yc,{key:_,dense:f,anchorOrigin:S.anchorOrigin,classes:b},w.map(function(k){return Z.createElement(xc,{key:k.id,snack:k,classes:b,Component:v[k.variant],onClose:s.handleCloseSnack,onEnter:s.props.onEnter,onExit:s.props.onExit,onExited:br([s.handleExitedSnack,s.props.onExited],k.id),onEntered:br([s.handleEnteredSnack,s.props.onEntered],k.id)})}))});return Z.createElement(Gs.Provider,{value:a},h,d?ka.createPortal(y,d):y)},Ws(t,[{key:"maxSnack",get:function(){return this.props.maxSnack||pt.maxSnack}}]),t}(g.Component),Sc=function(){return g.useContext(Gs)};const jc=({children:n})=>{const t=wr();return e.jsx(bc,{maxSnack:3,autoHideDuration:3e3,anchorOrigin:{vertical:"top",horizontal:"right"},style:{zIndex:t.zIndex.snackbar},children:n})},_c=({contentId:n})=>e.jsx("a",{href:`#${n}`,className:"skip-to-content",children:"Skip to content"}),zn=g.createContext(void 0),wc=({children:n})=>{console.log("AuthProvider: Mounting / Initializing");const[t,r]=g.useState(null),[i,s]=g.useState(null),[a,o]=g.useState(null),[d,h]=g.useState(!0),[u,f]=g.useState(!1),m=async()=>{try{await vo(),r(null),s(null),o(null),f(!1),h(!1),typeof window<"u"&&(localStorage.removeItem("supabase.auth.token"),localStorage.removeItem("supabase.auth.expires_at"),localStorage.removeItem("supabase.auth.refresh_token"))}catch(w){throw console.error("Error signing out:",w),w}};g.useEffect(()=>{console.log("AuthProvider: Initial useEffect running...");let w=!0,S=null;return(async()=>{try{const{data:I}=await bo(async(Q,V)=>{if(w)if(r(V),s((V==null?void 0:V.user)??null),V!=null&&V.user)try{const{data:te,error:C}=await $r(V.user.id);C?(c("AuthContext",`Error fetching profile for user ${V.user.id}:`,"error",C),w&&(o(null),f(!1))):te&&w&&(c("AuthContext",`Profile loaded for user ${V.user.id}`,"success"),o(te),f(te.book_verified||!1))}catch(te){c("AuthContext","Error in profile fetch flow:","error",te),w&&(o(null),f(!1))}else w&&(o(null),f(!1))});I!=null&&I.subscription&&(S=I.subscription,console.log("AuthProvider: State Change Listener Attached"));const{data:E,error:$}=await yo();if($){console.error("Error getting session:",$),w&&h(!1);return}if(!w)return;const P=E.session;if(r(P),P!=null&&P.user){s(P.user);try{const{data:Q,error:V}=await $r(P.user.id);V?c("AuthContext",`Error fetching profile for user ${P.user.id}:`,"error",V):w&&(c("AuthContext",`Profile loaded for user ${P.user.id}`,"success"),o(Q),f((Q==null?void 0:Q.book_verified)||!1))}catch(Q){c("AuthContext","Error in profile fetch flow:","error",Q)}}}catch(I){console.error("Error in auth setup:",I)}finally{w&&h(!1)}})(),()=>{w=!1,S&&S.unsubscribe()}},[]);const _={session:t,user:i,profile:a,loading:d,isVerified:u,setIsVerified:f,signIn:async(w,S)=>{h(!0);try{c("AuthContext",`Signing in user with email: ${w}`,"info"),console.log("AuthContext: Signing in user with email:",w);const{data:k,error:I}=await mo(w,S);if(I)throw c("AuthContext","Error during sign in","error",I),console.error("AuthContext: Error during sign in:",I),I;if(!(k!=null&&k.user))throw c("AuthContext","User not found during sign in","error"),console.error("AuthContext: User not found during sign in"),new Error("User not found");c("AuthContext","Sign in successful","success"),console.log("AuthContext: Sign in successful, user:",k.user);try{const{data:E,error:$}=await $r(k.user.id);$?(c("AuthContext","Warning: Could not fetch profile after sign in","warning",$),console.warn("AuthContext: Could not fetch profile after sign in:",$)):E&&(c("AuthContext","Profile fetched successfully after sign in","success"),console.log("AuthContext: Profile fetched successfully after sign in:",E),o(E),f(E.book_verified||!1))}catch(E){c("AuthContext","Error fetching profile after sign in","warning",E),console.warn("AuthContext: Error fetching profile after sign in:",E)}return{user:k.user,error:null}}catch(k){return c("AuthContext","Error signing in","error",k),console.error("AuthContext: Error signing in:",k),{user:null,error:k instanceof Error?k:new Error("Unknown error")}}finally{h(!1)}},signUp:async(w,S,k,I)=>{h(!0);try{c("AuthContext",`Signing up user with email: ${w}`,"info"),console.log("AuthContext: Signing up user with email:",w);const{data:E,error:$}=await xo(w,S);if($)throw c("AuthContext","Error during signup","error",$),console.error("AuthContext: Error during signup:",$),$;if(!(E!=null&&E.user))throw c("AuthContext","User creation failed - no user returned","error"),console.error("AuthContext: User creation failed - no user returned"),new Error("User creation failed");c("AuthContext",`User created successfully. Updating profile for: ${E.user.id}`,"info"),console.log("AuthContext: User created successfully. Updating profile for:",E.user.id);try{await new Promise(Q=>setTimeout(Q,1e3));const{error:P}=await So(E.user.id,k,I,w);P?(c("AuthContext",`Warning: Could not update profile with names: ${P.message}`,"warning"),console.warn("AuthContext: Could not update profile with names:",P)):(c("AuthContext","Profile updated successfully with names","success"),console.log("AuthContext: Profile updated successfully with names"))}catch(P){c("AuthContext","Error updating profile during signup","warning",P),console.warn("AuthContext: Error updating profile during signup:",P)}return{user:E.user,error:null}}catch(E){return c("AuthContext","Error signing up","error",E),console.error("AuthContext: Error signing up:",E),{user:null,error:E instanceof Error?E:new Error("Unknown error")}}finally{h(!1)}},signOut:m,verifyBook:async(w,S,k)=>{try{if(!i)return{success:!1,error:new Error("User not authenticated")};console.log("AuthContext: Starting book verification with code:",w),console.log("AuthContext: User ID:",i.id),console.log("AuthContext: First name:",S),console.log("AuthContext: Last name:",k);const I=await jo(w,i.id,S,k);if(console.log("AuthContext: Verification result:",I),I.error)return console.error("AuthContext: Verification error:",I.error),{success:!1,error:new Error(String(I.error))};console.log("AuthContext: Verification successful, updating isVerified state to true"),f(!0);try{console.log("AuthContext: Re-fetching user profile after verification");const{data:E}=await $r(i.id);E&&(console.log("AuthContext: Updated profile after verification:",E),o(E))}catch(E){console.error("AuthContext: Error fetching profile after verification:",E)}return console.log("AuthContext: Book verification completed successfully"),{success:!0}}catch(I){return console.error("AuthContext: Unexpected error during verification:",I),{success:!1,error:I instanceof Error?I:new Error("Unknown error during verification")}}},isConsultant:()=>(a==null?void 0:a.is_consultant)||!1};return console.log("AuthProvider: Initial loading state:",d),e.jsx(zn.Provider,{value:_,children:n})},ke=()=>{const n=g.useContext(zn);if(n===void 0)throw new Error("useAuth must be used within an AuthProvider");return n},ye=({children:n,routeType:t})=>{var d;const{user:r,loading:i,isVerified:s,profile:a}=ke(),o=mt();if(c("RouteGuard",`Checking access to ${o.pathname} (type: ${t})`,"info",{isAuthenticated:!!r,isVerified:s,routeType:t}),i)return null;switch(t){case"public":return r&&s&&(o.pathname==="/login"||o.pathname==="/register")?(c("RouteGuard","User is verified, redirecting from public route to reader interaction page","info"),e.jsx(Fe,{to:"/reader/interaction",replace:!0})):e.jsx(e.Fragment,{children:n});case"auth":return r?e.jsx(e.Fragment,{children:n}):(c("RouteGuard","User not authenticated, redirecting to login","info"),e.jsx(Fe,{to:"/login",state:{from:o},replace:!0}));case"verified":return r?s?e.jsx(e.Fragment,{children:n}):(c("RouteGuard","User not verified, redirecting to verification page","info"),e.jsx(Fe,{to:"/verify",state:{from:o},replace:!0})):(c("RouteGuard","User not authenticated, redirecting to login","info"),e.jsx(Fe,{to:"/login",state:{from:o},replace:!0}));case"admin":return r?(a==null?void 0:a.is_admin)||((d=r.email)==null?void 0:d.endsWith("@alicereader.com"))||r.email==="admin@example.com"?e.jsx(e.Fragment,{children:n}):(c("RouteGuard","User not authorized for admin access","warning"),e.jsx(Fe,{to:"/reader",replace:!0})):(c("RouteGuard","User not authenticated, redirecting to login","info"),e.jsx(Fe,{to:"/login",state:{from:o},replace:!0}));default:return c("RouteGuard",`Unknown route type: ${t}, treating as verified route`,"warning"),r?s?e.jsx(e.Fragment,{children:n}):e.jsx(Fe,{to:"/verify",state:{from:o},replace:!0}):e.jsx(Fe,{to:"/login",state:{from:o},replace:!0})}};var Lt={},fi;function kc(){if(fi)return Lt;fi=1;var n=W();Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.default=void 0;var t=n(Y()),r=H();return Lt.default=(0,t.default)((0,r.jsx)("path",{d:"M3 18h18v-2H3zm0-5h18v-2H3zm0-7v2h18V6z"}),"Menu"),Lt}var Ec=kc();const Cc=G(Ec);var Mt={},pi;function Rc(){if(pi)return Mt;pi=1;var n=W();Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.default=void 0;var t=n(Y()),r=H();return Mt.default=(0,t.default)((0,r.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 4c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6m0 14c-2.03 0-4.43-.82-6.14-2.88C7.55 15.8 9.68 15 12 15s4.45.8 6.14 2.12C16.43 19.18 14.03 20 12 20"}),"AccountCircle"),Mt}var Ic=Rc();const mi=G(Ic);var Bt={},xi;function Ac(){if(xi)return Bt;xi=1;var n=W();Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.default=void 0;var t=n(Y()),r=H();return Bt.default=(0,t.default)((0,r.jsx)("path",{d:"m17 7-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4z"}),"Logout"),Bt}var Pc=Ac();const vi=G(Pc),Tc=()=>{var k,I;const{user:n,signOut:t}=ke(),r=Ze(),i=mt(),s=wr(),a=Pn(s.breakpoints.down("sm")),[o,d]=Z.useState(null),[h,u]=Z.useState(null),f=!!o,m=!!h,v=E=>{d(E.currentTarget)},b=E=>{u(E.currentTarget)},p=()=>{d(null),u(null)},y=async()=>{p();try{await t(),r("/")}catch(E){console.error("Error signing out:",E)}},_=E=>{p(),r(E)};if(i.pathname==="/")return null;const w=e.jsxs(Sn,{anchorEl:o,anchorOrigin:{vertical:"bottom",horizontal:"right"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:f,onClose:p,children:[n&&e.jsxs(x,{sx:{px:2,py:1,display:"flex",alignItems:"center"},children:[e.jsx(ft,{sx:{mr:1,width:32,height:32},children:((k=n.email)==null?void 0:k.charAt(0).toUpperCase())||"U"}),e.jsx(l,{variant:"body2",children:n.email})]}),e.jsx(ie,{}),e.jsxs(Ce,{onClick:y,children:[e.jsx(vi,{sx:{mr:1},fontSize:"small"}),"Sign Out"]})]}),S=e.jsx(Sn,{anchorEl:h,anchorOrigin:{vertical:"bottom",horizontal:"right"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:m,onClose:p,children:n?e.jsx(e.Fragment,{children:e.jsxs(Ce,{onClick:y,children:[e.jsx(vi,{sx:{mr:1},fontSize:"small"}),"Sign Out"]})}):e.jsxs(e.Fragment,{children:[e.jsxs(Ce,{onClick:()=>_("/login"),children:[e.jsx(mi,{sx:{mr:1},fontSize:"small"}),"Sign In"]}),e.jsxs(Ce,{onClick:()=>_("/register"),children:[e.jsx(mi,{sx:{mr:1},fontSize:"small"}),"Register"]})]})});return e.jsxs(la,{position:"static",color:"default",elevation:1,children:[e.jsxs(da,{children:[e.jsx(x,{sx:{flexGrow:1}}),a?e.jsx($e,{edge:"end","aria-label":"menu","aria-haspopup":"true",onClick:b,color:"inherit",children:e.jsx(Cc,{})}):e.jsx(x,{sx:{display:"flex"},children:n?e.jsx(e.Fragment,{children:e.jsx($e,{edge:"end","aria-label":"account of current user","aria-haspopup":"true",onClick:v,color:"inherit",children:e.jsx(ft,{sx:{width:32,height:32},children:((I=n.email)==null?void 0:I.charAt(0).toUpperCase())||"U"})})}):e.jsxs(e.Fragment,{children:[e.jsx(A,{color:"inherit",component:U,to:"/login",children:"Sign In"}),e.jsx(A,{color:"primary",variant:"contained",component:U,to:"/register",sx:{ml:1},children:"Register"})]})})]}),w,S]})};let kt=!1;function ta(){c("ServiceInitializers","Registering service initializers","info"),M.registerInitializer(K.AUTH_SERVICE,async()=>{try{console.log("ServiceInitializers: Importing authService module");const n=await be(()=>Promise.resolve().then(()=>Ss),void 0);if(console.log("ServiceInitializers: authService module imported:",n),typeof n.createAuthService!="function")throw console.error("ServiceInitializers: createAuthService is not a function in the imported module"),new Error("createAuthService is not a function");return console.log("ServiceInitializers: Creating auth service"),n.createAuthService()}catch(n){throw console.error("ServiceInitializers: Error initializing auth service:",n),n}}),M.registerInitializer(K.BOOK_SERVICE,async()=>{try{console.log("ServiceInitializers: Importing bookService module");const n=await be(()=>Promise.resolve().then(()=>Os),void 0);if(console.log("ServiceInitializers: bookService module imported:",n),typeof n.createBookService!="function")throw console.error("ServiceInitializers: createBookService is not a function in the imported module"),new Error("createBookService is not a function");return console.log("ServiceInitializers: Creating book service"),n.createBookService()}catch(n){throw console.error("ServiceInitializers: Error initializing book service:",n),n}}),M.registerInitializer(K.DICTIONARY_SERVICE,async()=>{const{createDictionaryService:n}=await be(async()=>{const{createDictionaryService:t}=await import("./dictionaryService-w9KxFbS3.js");return{createDictionaryService:t}},__vite__mapDeps([0,1,2,3,4,5]));return n()}),M.registerInitializer(K.AI_SERVICE,async()=>{const{createAIService:n}=await be(async()=>{const{createAIService:t}=await Promise.resolve().then(()=>ho);return{createAIService:t}},void 0);return n()}),M.registerInitializer(K.FEEDBACK_SERVICE,async()=>{const{createFeedbackService:n}=await be(async()=>{const{createFeedbackService:t}=await Promise.resolve().then(()=>wo);return{createFeedbackService:t}},void 0);return n()}),M.registerInitializer(K.TRIGGER_SERVICE,async()=>{const{createTriggerService:n}=await be(async()=>{const{createTriggerService:t}=await Promise.resolve().then(()=>Eo);return{createTriggerService:t}},void 0);return n()}),M.registerInitializer(K.STATISTICS_SERVICE,async()=>{const{createStatisticsService:n}=await be(async()=>{const{createStatisticsService:t}=await Promise.resolve().then(()=>Ro);return{createStatisticsService:t}},void 0);return n()}),M.registerInitializer(K.CONSULTANT_SERVICE,async()=>{const{createConsultantService:n}=await be(async()=>{const{createConsultantService:t}=await Promise.resolve().then(()=>Ao);return{createConsultantService:t}},void 0);return n()}),M.registerInitializer(K.INTERACTION_SERVICE,async()=>{const{createInteractionService:n}=await be(async()=>{const{createInteractionService:t}=await Promise.resolve().then(()=>To);return{createInteractionService:t}},void 0);return n()}),M.registerInitializer(K.MONITORING_SERVICE,async()=>{const{createMonitoringService:n}=await be(async()=>{const{createMonitoringService:t}=await Promise.resolve().then(()=>Oo);return{createMonitoringService:t}},void 0);return n()}),M.registerInitializer(K.DATABASE_SERVICE,async()=>{const{createDatabaseService:n}=await be(async()=>{const{createDatabaseService:t}=await Promise.resolve().then(()=>zo);return{createDatabaseService:t}},void 0);return n()}),M.registerInitializer(K.ANALYTICS_SERVICE,async()=>{const{createAnalyticsService:n}=await be(async()=>{const{createAnalyticsService:t}=await Promise.resolve().then(()=>qo);return{createAnalyticsService:t}},void 0);return n()}),M.registerInitializer(K.SAMPLE_SERVICE,async()=>{const{createSampleService:n}=await be(async()=>{const{createSampleService:t}=await import("./sampleService-BBJxm_Pu.js");return{createSampleService:t}},__vite__mapDeps([6,1,2,3,4,5]));return n()}),c("ServiceInitializers","All service initializers registered successfully","success")}function Pr(){console.log("ServiceInitializers: initializeServices called, initialized =",kt),kt?console.log("ServiceInitializers: Services already initialized"):(console.log("ServiceInitializers: Calling registerServiceInitializers"),ta(),console.log("ServiceInitializers: Service initializers registered"),kt=!0,console.log("ServiceInitializers: Services initialized successfully"))}function An(){return kt}async function Dc(n){try{return kt||Pr(),await M.getService(n)}catch(t){const r=t instanceof le?t:new le(`Failed to initialize service "${n}": ${t instanceof Error?t.message:String(t)}`,Qe.SERVICE_INITIALIZATION_ERROR,{serviceName:n,originalError:t});throw c("ServiceInitializers",r.message,"error"),r}}async function Oc(n){try{kt||Pr(),await Promise.all(n.map(t=>M.getService(t)))}catch(t){const r=t instanceof le?t:new le(`Failed to initialize services: ${t instanceof Error?t.message:String(t)}`,Qe.SERVICE_INITIALIZATION_ERROR,{originalError:t});throw c("ServiceInitializers",r.message,"error"),r}}Pr();const $c=Object.freeze(Object.defineProperty({__proto__:null,initializeService:Dc,initializeServices:Pr,initializeServices2:Oc,isInitialized:An,registerServiceInitializers:ta},Symbol.toStringTag,{value:"Module"}));function Je(n){const[t,r]=g.useState(null),[i,s]=g.useState(!0),[a,o]=g.useState(null),[d,h]=g.useState(An());return g.useEffect(()=>{let u=!0;return(async()=>{try{if(An()||(c("useService",`Registering service initializers for ${n}`,"info"),Pr(),u&&h(!0)),u){c("useService",`Getting service ${n}`,"info");const m=await M.getService(n);u&&r(m)}}catch(m){if(u){const v=m instanceof Error?m:new Error(String(m));c("useService",`Error getting service ${n}: ${v.message}`,"error"),o(v)}}finally{u&&s(!1)}})(),()=>{u=!1}},[n]),{service:t,loading:i,error:a,initialized:d}}function en(){return Je(K.BOOK_SERVICE)}function zc(){return Je(K.AI_SERVICE)}function qc(){return Je(K.TRIGGER_SERVICE)}function Lc(){return Je(K.STATISTICS_SERVICE)}function qn(){return Je(K.CONSULTANT_SERVICE)}function Mc(){return Je(K.MONITORING_SERVICE)}function ra(){return Je(K.DICTIONARY_SERVICE)}function na(){return Je(K.AUTH_SERVICE)}function Re(){return Je(K.ANALYTICS_SERVICE)}function ze(n){const{service:t}=Re(),r=g.useRef(performance.now()),i=g.useRef(null);return g.useEffect(()=>{const s=performance.now()-r.current;if(i.current=s,n.trackRender&&t&&t.trackPerformance("render_time",s,{component:n.componentName}),n.trackPageLoad&&t&&window.performance&&window.performance.timing){const a=window.performance.timing,o=a.loadEventEnd-a.navigationStart;o>0&&t.trackPerformance("page_load",o,{page:n.componentName})}return()=>{const a=performance.now()-r.current;t&&t.trackPerformance("component_lifetime",a,{component:n.componentName})}},[n.componentName,n.trackPageLoad,n.trackRender,t]),{trackInteraction:(s,a)=>{const o=performance.now()-a;return t&&t.trackPerformance("interaction",o,{component:n.componentName,interaction:s}),o},trackApiCall:(s,a)=>{const o=performance.now()-a;return t&&t.trackPerformance("api_call",o,{component:n.componentName,endpoint:s}),o},getRenderTime:()=>i.current}}var Ut={},yi;function Bc(){if(yi)return Ut;yi=1;var n=W();Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.default=void 0;var t=n(Y()),r=H();return Ut.default=(0,t.default)((0,r.jsx)("path",{d:"M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2M6 4h5v8l-2.5-1.5L6 12z"}),"Book"),Ut}var Uc=Bc();const Yr=G(Uc);var Vt={},bi;function Vc(){if(bi)return Vt;bi=1;var n=W();Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.default=void 0;var t=n(Y()),r=H();return Vt.default=(0,t.default)((0,r.jsx)("path",{d:"M20 9V7c0-1.1-.9-2-2-2h-3c0-1.66-1.34-3-3-3S9 3.34 9 5H6c-1.1 0-2 .9-2 2v2c-1.66 0-3 1.34-3 3s1.34 3 3 3v4c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-4c1.66 0 3-1.34 3-3s-1.34-3-3-3M7.5 11.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5S9.83 13 9 13s-1.5-.67-1.5-1.5M16 17H8v-2h8zm-1-4c-.83 0-1.5-.67-1.5-1.5S14.17 10 15 10s1.5.67 1.5 1.5S15.83 13 15 13"}),"SmartToy"),Vt}var Fc=Vc();const jr=G(Fc);var Ft={},Si;function Nc(){if(Si)return Ft;Si=1;var n=W();Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.default=void 0;var t=n(Y()),r=H();return Ft.default=(0,t.default)((0,r.jsx)("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"Person"),Ft}var Wc=Nc();const Sr=G(Wc),ia="/alice-reader-app-final/assets/alice_book_cover-BKYPLSg-.jpg",Hc=()=>{const n=wr();Pn(n.breakpoints.down("sm"));const{user:t,isVerified:r}=ke(),i=Ze(),{service:s}=Re();return ze({trackPageLoad:!0,trackRender:!0,componentName:"LandingPage"}),g.useEffect(()=>{t&&r&&i("/reader")},[t,r,i]),g.useEffect(()=>{s&&s.trackPageView("landing_page")},[s]),e.jsx(x,{sx:{minHeight:"100vh",backgroundImage:"linear-gradient(rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7)), url('https://images.unsplash.com/photo-1543002588-bfa74002ed7e?q=80&w=2730&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D')",backgroundSize:"cover",backgroundPosition:"center",pt:8,pb:6},children:e.jsxs(Ct,{maxWidth:"lg",children:[e.jsxs(x,{sx:{textAlign:"center",mb:8,animation:"fadeIn 1.2s ease-in-out","@keyframes fadeIn":{"0%":{opacity:0,transform:"translateY(20px)"},"100%":{opacity:1,transform:"translateY(0)"}}},children:[e.jsx(l,{component:"h1",variant:"h2",color:"primary.main",gutterBottom:!0,sx:{fontFamily:'"Alice", serif',fontWeight:"bold",textShadow:"1px 1px 2px rgba(0,0,0,0.1)"},children:"Alice Reader"}),e.jsx(l,{variant:"h5",color:"text.secondary",paragraph:!0,sx:{maxWidth:600,mx:"auto",mb:4},children:"Your AI-powered reading companion for exploring the wonders of literature. Discover deeper meaning, expand your vocabulary, and enhance your reading experience."}),e.jsxs(x,{sx:{display:"flex",justifyContent:"center",gap:2,flexWrap:"wrap"},children:[e.jsx(A,{component:U,to:"/register",variant:"contained",size:"large",color:"primary",sx:{px:4,py:1.5,fontSize:"1.1rem",transition:"all 0.3s","&:hover":{transform:"translateY(-3px)",boxShadow:n.shadows[8]}},children:"Sign Up"}),e.jsx(A,{component:U,to:"/login",variant:"outlined",size:"large",sx:{px:4,py:1.5,fontSize:"1.1rem",transition:"all 0.3s","&:hover":{transform:"translateY(-3px)",boxShadow:n.shadows[2]}},children:"Login"})]})]}),e.jsx(O,{elevation:3,sx:{p:4,mb:8,borderRadius:2,background:"rgba(255, 255, 255, 0.9)",boxShadow:"0 8px 32px rgba(31, 38, 135, 0.15)",backdropFilter:"blur(4px)",border:"1px solid rgba(255, 255, 255, 0.18)"},children:e.jsxs(j,{container:!0,spacing:4,alignItems:"center",children:[e.jsx(j,{item:!0,xs:12,md:4,children:e.jsx(x,{component:"img",src:ia,alt:"Alice in Wonderland",sx:{width:"100%",maxWidth:300,height:"auto",borderRadius:2,boxShadow:"0 10px 20px rgba(0,0,0,0.2)",transform:"rotate(-3deg)",mx:"auto",display:"block"}})}),e.jsxs(j,{item:!0,xs:12,md:8,children:[e.jsx(l,{variant:"h4",component:"h2",gutterBottom:!0,color:"primary.dark",children:"Alice in Wonderland"}),e.jsx(l,{variant:"subtitle1",gutterBottom:!0,color:"text.secondary",children:"By Lewis Carroll"}),e.jsx(l,{variant:"body1",paragraph:!0,sx:{mt:2},children:"Begin your journey down the rabbit hole with Alice! This interactive reading experience brings the classic tale to life with AI-powered assistance, vocabulary building tools, and personalized reading insights."}),e.jsx(x,{sx:{mt:3},children:e.jsx(A,{component:U,to:"/register",variant:"contained",color:"secondary",startIcon:e.jsx(Yr,{}),children:"Start Reading"})})]})]})}),e.jsx(l,{variant:"h4",component:"h2",align:"center",gutterBottom:!0,sx:{mb:4},children:"Key Features"}),e.jsxs(j,{container:!0,spacing:4,children:[e.jsx(j,{item:!0,xs:12,md:4,children:e.jsx(Fr,{sx:{height:"100%",display:"flex",flexDirection:"column",transition:"transform 0.3s","&:hover":{transform:"translateY(-8px)"}},children:e.jsxs(rt,{sx:{flexGrow:1,textAlign:"center",p:3},children:[e.jsx(x,{sx:{mb:2},children:e.jsx(Yr,{color:"primary",sx:{fontSize:60}})}),e.jsx(l,{variant:"h5",component:"h3",gutterBottom:!0,children:"Interactive Dictionary"}),e.jsx(l,{children:"Instantly look up any word by simply highlighting it. Build your vocabulary and deepen your understanding of the text."})]})})}),e.jsx(j,{item:!0,xs:12,md:4,children:e.jsx(Fr,{sx:{height:"100%",display:"flex",flexDirection:"column",transition:"transform 0.3s","&:hover":{transform:"translateY(-8px)"}},children:e.jsxs(rt,{sx:{flexGrow:1,textAlign:"center",p:3},children:[e.jsx(x,{sx:{mb:2},children:e.jsx(jr,{color:"secondary",sx:{fontSize:60}})}),e.jsx(l,{variant:"h5",component:"h3",gutterBottom:!0,children:"AI Reading Assistant"}),e.jsx(l,{children:"Ask questions about the text, get explanations, and explore themes with our intelligent AI assistant that understands the context of what you're reading."})]})})}),e.jsx(j,{item:!0,xs:12,md:4,children:e.jsx(Fr,{sx:{height:"100%",display:"flex",flexDirection:"column",transition:"transform 0.3s","&:hover":{transform:"translateY(-8px)"}},children:e.jsxs(rt,{sx:{flexGrow:1,textAlign:"center",p:3},children:[e.jsx(x,{sx:{mb:2},children:e.jsx(Sr,{color:"info",sx:{fontSize:60}})}),e.jsx(l,{variant:"h5",component:"h3",gutterBottom:!0,children:"Reading Consultant"}),e.jsx(l,{children:"Get personalized guidance from reading consultants who can help you navigate difficult passages and provide insights tailored to your needs."})]})})})]}),e.jsxs(x,{sx:{textAlign:"center",mt:8,p:4,borderRadius:2,background:n.palette.primary.main,color:"white"},children:[e.jsx(l,{variant:"h5",component:"p",gutterBottom:!0,children:"Ready to transform your reading experience?"}),e.jsx(A,{component:U,to:"/register",variant:"contained",size:"large",color:"secondary",sx:{mt:2,px:4},children:"Get Started Now"})]}),e.jsx(x,{sx:{mt:8,pt:3,borderTop:`1px solid ${n.palette.divider}`},children:e.jsxs(l,{variant:"body2",color:"text.secondary",align:"center",children:["© ",new Date().getFullYear()," Alice Reader. All rights reserved."]})})]})})},Gc=()=>{const n=Ze(),t=mt(),{signIn:r,user:i,isVerified:s}=ke(),{service:a}=Re(),[o,d]=g.useState(""),[h,u]=g.useState(""),[f,m]=g.useState(null),[v,b]=g.useState(!1),[p,y]=g.useState(null);ze({trackPageLoad:!0,trackRender:!0,componentName:"LoginPage"}),g.useEffect(()=>{i&&n(s?"/reader":"/verify")},[i,s,n]),g.useEffect(()=>{if(t.state&&t.state.message){y(t.state.message);const w=setTimeout(()=>y(null),5e3);return()=>clearTimeout(w)}},[t.state]),g.useEffect(()=>{a&&a.trackPageView("login_page")},[a]);const _=async w=>{if(w.preventDefault(),!o.trim()||!h.trim()){m("Please enter both email and password");return}b(!0),m(null);try{console.log("LoginPage: Attempting login with email:",o);const S=performance.now(),{error:k,user:I}=await r(o,h);if(k)throw console.error("LoginPage: Login error:",k),k;console.log("LoginPage: Login successful, user:",I),console.log("LoginPage: Verification status:",s),a&&a.trackEvent("login_attempt",{success:!0,timeToComplete:performance.now()-S}),y("Login successful!"),await new Promise(E=>setTimeout(E,1e3)),s?(console.log("LoginPage: User is verified, navigating to dashboard"),n("/dashboard")):(console.log("LoginPage: User is not verified, navigating to verification page"),n("/verify"))}catch(S){console.error("LoginPage: Login failed:",S),m(S.message||"Login failed. Please check your credentials."),a&&a.trackEvent("login_attempt",{success:!1,error:S.message})}finally{b(!1)}};return e.jsx(Ct,{maxWidth:"sm",children:e.jsx(x,{sx:{mt:8,display:"flex",flexDirection:"column",alignItems:"center"},children:e.jsxs(O,{elevation:3,sx:{p:4,width:"100%",borderRadius:2},children:[e.jsx(l,{component:"h1",variant:"h4",align:"center",gutterBottom:!0,children:"Welcome Back"}),e.jsx(l,{variant:"body1",align:"center",color:"text.secondary",sx:{mb:3},children:"Sign in to continue your reading journey"}),f&&e.jsx(je,{severity:"error",sx:{mb:3},children:f}),p&&e.jsx(je,{severity:"success",sx:{mb:3},children:p}),e.jsxs(x,{component:"form",onSubmit:_,noValidate:!0,children:[e.jsx(he,{margin:"normal",required:!0,fullWidth:!0,id:"email",label:"Email Address",name:"email",autoComplete:"email",autoFocus:!0,value:o,onChange:w=>d(w.target.value),error:!!f&&!o.trim()}),e.jsx(he,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",autoComplete:"current-password",value:h,onChange:w=>u(w.target.value),error:!!f&&!h.trim()}),e.jsx(A,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2,py:1.5},disabled:v,children:v?e.jsx(ge,{size:24}):"Sign In"}),e.jsx(x,{sx:{mt:2,textAlign:"center"},children:e.jsx(wt,{component:U,to:"/forgot-password",variant:"body2",children:"Forgot password?"})}),e.jsx(x,{sx:{mt:3,textAlign:"center"},children:e.jsxs(l,{variant:"body2",children:["Don't have an account?"," ",e.jsx(wt,{component:U,to:"/register",children:"Sign Up"})]})})]})]})})})},Yc=n=>{if(!n)return{score:0,feedback:"Password is required"};let t=0,r="";return n.length>=8&&(t+=1),n.length>=12&&(t+=1),/[A-Z]/.test(n)&&(t+=1),/[a-z]/.test(n)&&(t+=1),/[0-9]/.test(n)&&(t+=1),/[^A-Za-z0-9]/.test(n)&&(t+=1),t<3?r="Weak password. Try adding numbers, symbols, and mixed case letters.":t<5?r="Moderate password. Consider making it longer or more complex.":r="Strong password!",{score:Math.min(t,5),feedback:r}},Qc=()=>{const n=Ze(),t=mt(),{signUp:r,user:i}=ke(),{service:s}=Re(),[a,o]=g.useState(""),[d,h]=g.useState(""),[u,f]=g.useState(""),[m,v]=g.useState(""),[b,p]=g.useState(""),[y,_]=g.useState(!1),[w,S]=g.useState(0),[k,I]=g.useState(null),[E,$]=g.useState(!1),[P,Q]=g.useState({score:0,feedback:""});ze({trackPageLoad:!0,trackRender:!0,componentName:"RegisterPage"}),g.useEffect(()=>{var D;i&&!((D=t.state)!=null&&D.fromRegistration)&&n("/verify")},[i,n,t.state]),g.useEffect(()=>{s&&s.trackPageView("register_page")},[s]),g.useEffect(()=>{Q(Yc(d))},[d]);const V=()=>{if(w===0){if(!a||!d||!u){I("Please fill in all required fields");return}if(d!==u){I("Passwords do not match");return}if(P.score<3){I("Please use a stronger password");return}}I(null),S(D=>D+1)},te=()=>{S(D=>D-1),I(null)},C=async D=>{if(D.preventDefault(),!m||!b||!y){I("Please fill in all required fields and agree to the terms");return}$(!0),I(null);try{console.log("RegisterPage: Starting signup process with:",{email:a,firstName:m,lastName:b});const fe=performance.now(),{error:de,user:R}=await r(a,d,m,b);if(de)throw console.error("RegisterPage: Signup error:",de),de;console.log("RegisterPage: Signup successful, user:",R),s&&s.trackEvent("registration_complete",{success:!0,timeToComplete:performance.now()-fe}),console.log("RegisterPage: Navigating to verification page"),n("/verify",{state:{message:"Registration successful! Please verify your book to continue.",fromRegistration:!0,firstName:m,lastName:b,email:a,userId:R==null?void 0:R.id},replace:!0}),console.log("RegisterPage: Navigation to verification page initiated")}catch(fe){I(fe.message||"Registration failed. Please try again."),s&&s.trackEvent("registration_attempt",{success:!1,error:fe.message})}finally{$(!1)}},B=()=>{const{score:D}=P;return D<3?"error":D<5?"warning":"success"};return e.jsx(Ct,{maxWidth:"sm",children:e.jsx(x,{sx:{mt:8,mb:8,display:"flex",flexDirection:"column",alignItems:"center"},children:e.jsxs(O,{elevation:3,sx:{p:4,width:"100%",borderRadius:2},children:[e.jsx(l,{component:"h1",variant:"h4",align:"center",gutterBottom:!0,children:"Create Your Account"}),e.jsx(l,{variant:"body1",align:"center",color:"text.secondary",sx:{mb:4},children:"Join Alice Reader to begin your interactive reading journey"}),e.jsxs(Zi,{activeStep:w,sx:{mb:4},children:[e.jsx(mr,{children:e.jsx(xr,{children:"Account Details"})}),e.jsx(mr,{children:e.jsx(xr,{children:"Personal Information"})})]}),k&&e.jsx(je,{severity:"error",sx:{mb:3},children:k}),e.jsxs(x,{component:"form",onSubmit:w===1?C:V,noValidate:!0,children:[w===0?e.jsxs(e.Fragment,{children:[e.jsx(he,{margin:"normal",required:!0,fullWidth:!0,id:"email",label:"Email Address",name:"email",autoComplete:"email",autoFocus:!0,value:a,onChange:D=>o(D.target.value),error:!!k&&!a}),e.jsx(he,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",autoComplete:"new-password",value:d,onChange:D=>h(D.target.value),error:!!k&&(!d||P.score<3),helperText:d?P.feedback:"Password is required",FormHelperTextProps:{sx:{color:B()}}}),e.jsx(he,{margin:"normal",required:!0,fullWidth:!0,name:"confirmPassword",label:"Confirm Password",type:"password",id:"confirmPassword",autoComplete:"new-password",value:u,onChange:D=>f(D.target.value),error:!!k&&(!u||d!==u),helperText:u&&d!==u?"Passwords do not match":""}),e.jsx(A,{type:"button",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2,py:1.5},onClick:V,children:"Next"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(j,{container:!0,spacing:2,children:[e.jsx(j,{item:!0,xs:12,sm:6,children:e.jsx(he,{required:!0,fullWidth:!0,id:"firstName",label:"First Name",name:"firstName",autoComplete:"given-name",value:m,onChange:D=>v(D.target.value),error:!!k&&!m})}),e.jsx(j,{item:!0,xs:12,sm:6,children:e.jsx(he,{required:!0,fullWidth:!0,id:"lastName",label:"Last Name",name:"lastName",autoComplete:"family-name",value:b,onChange:D=>p(D.target.value),error:!!k&&!b})})]}),e.jsx(pr,{control:e.jsx(ua,{checked:y,onChange:D=>_(D.target.checked),color:"primary"}),label:e.jsxs(l,{variant:"body2",children:["I agree to the"," ",e.jsx(wt,{component:U,to:"/terms",children:"Terms of Service"})," ","and"," ",e.jsx(wt,{component:U,to:"/privacy",children:"Privacy Policy"})]}),sx:{mt:2}}),e.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",mt:3},children:[e.jsx(A,{type:"button",variant:"outlined",onClick:te,sx:{py:1.5,px:3},children:"Back"}),e.jsx(A,{type:"submit",variant:"contained",sx:{py:1.5,px:3},disabled:E||!y,children:E?e.jsx(ge,{size:24}):"Create Account"})]})]}),e.jsx(x,{sx:{mt:3,textAlign:"center"},children:e.jsxs(l,{variant:"body2",children:["Already have an account?"," ",e.jsx(wt,{component:U,to:"/login",children:"Sign In"})]})})]})]})})})},Zc=()=>{const n=Ze(),t=mt(),{user:r,isVerified:i,setIsVerified:s,verifyBook:a}=ke(),{service:o}=Re(),[d,h]=g.useState(""),[u,f]=g.useState(""),[m,v]=g.useState(""),[b,p]=g.useState(""),[y,_]=g.useState(null),[w,S]=g.useState(null),[k,I]=g.useState(!1),[E,$]=g.useState(null),[P,Q]=g.useState(!1),[V,te]=g.useState(0);ze({trackPageLoad:!0,trackRender:!0,componentName:"VerifyPage"}),g.useEffect(()=>{var D;const B=(D=t.state)==null?void 0:D.fromRegistration;console.log("VerifyPage: Initial auth check - user:",!!r,"isVerified:",i,"fromRegistration:",B),!B&&r&&i?(console.log("VerifyPage: User already verified, redirecting to reader interaction page"),n("/reader/interaction",{replace:!0})):!r&&!B?(console.log("VerifyPage: No user found, redirecting to login"),n("/login",{replace:!0})):console.log("VerifyPage: User needs verification or coming from registration, staying on page")},[r,i,n,t.state]),g.useEffect(()=>{var B;(B=t.state)!=null&&B.fromRegistration&&(f(t.state.firstName||""),v(t.state.lastName||""),p(t.state.email||""),_(t.state.userId||null),n(".",{replace:!0,state:{...t.state,fromRegistration:!1}}))},[t.state,n]),g.useEffect(()=>{if(t.state&&t.state.message){$(t.state.message);const B=setTimeout(()=>$(null),5e3);return()=>clearTimeout(B)}},[t.state]),g.useEffect(()=>{o&&o.trackPageView("verify_page")},[o]),g.useEffect(()=>{i&&r&&(console.log("VerifyPage: isVerified changed to true, redirecting to reader interaction page"),n("/reader/interaction",{replace:!0}))},[i,r,n]);const C=async B=>{if(B.preventDefault(),!d.trim()){S("Please enter your verification code");return}if(!u.trim()){S("Please enter your first name");return}if(!m.trim()){S("Please enter your last name");return}I(!0),S(null);try{console.log("VerifyPage: Starting verification with:",{verificationCode:d,firstName:u,lastName:m});const D=performance.now();console.log("VerifyPage: About to call verifyBook");const{error:fe,success:de}=await a(d,u,m);if(console.log("VerifyPage: verifyBook call completed with result:",{error:fe,success:de}),fe)throw console.error("VerifyPage: Verification error:",fe),fe;o&&o.trackEvent("book_verification",{success:!0,timeToComplete:performance.now()-D}),console.log("VerifyPage: Updating UI state after successful verification"),Q(!0),$("Verification successful! Redirecting to your dashboard..."),console.log("VerifyPage: Setting isVerified to true locally"),s(!0),te(1),console.log("VerifyPage: Setting up redirect to reader interaction page"),setTimeout(()=>{console.log("VerifyPage: Executing redirect to reader interaction page"),n("/reader/interaction",{replace:!0})},1e3)}catch(D){console.error("VerifyPage: Verification failed:",D),S(D.message||"Verification failed. Please check your code and try again."),o&&o.trackEvent("book_verification",{success:!1,error:D.message})}finally{I(!1)}};return e.jsx(Ct,{maxWidth:"sm",children:e.jsx(x,{sx:{mt:8,mb:8,display:"flex",flexDirection:"column",alignItems:"center"},children:e.jsxs(O,{elevation:3,sx:{p:4,width:"100%",borderRadius:2},children:[e.jsx(l,{component:"h1",variant:"h4",align:"center",gutterBottom:!0,children:"Verify Your Book"}),e.jsx(l,{variant:"body1",align:"center",color:"text.secondary",sx:{mb:4},children:"Enter the verification code from your physical copy of Alice in Wonderland"}),w&&e.jsx(je,{severity:"error",sx:{mb:3},children:w}),E&&e.jsx(je,{severity:"success",sx:{mb:3},children:E}),e.jsxs(Zi,{activeStep:V,orientation:"vertical",sx:{mb:4},children:[e.jsxs(mr,{children:[e.jsx(xr,{children:"Enter Verification Code"}),e.jsx(nn,{children:e.jsxs(x,{component:"form",onSubmit:C,noValidate:!0,children:[e.jsx(he,{margin:"normal",required:!0,fullWidth:!0,id:"verificationCode",label:"Verification Code",name:"verificationCode",autoComplete:"off",autoFocus:!0,value:d,onChange:B=>h(B.target.value.toUpperCase()),error:!!w&&!d.trim(),placeholder:"e.g. BETA001",inputProps:{style:{textTransform:"uppercase",letterSpacing:"0.1em"}},disabled:k||P}),e.jsx(he,{margin:"normal",required:!0,fullWidth:!0,id:"firstName",label:"First Name",name:"firstName",value:u,onChange:B=>f(B.target.value),error:!!w&&!u.trim(),disabled:k||P}),e.jsx(he,{margin:"normal",required:!0,fullWidth:!0,id:"lastName",label:"Last Name",name:"lastName",value:m,onChange:B=>v(B.target.value),error:!!w&&!m.trim(),disabled:k||P}),e.jsx(l,{variant:"body2",color:"text.secondary",sx:{mt:1,mb:3},children:"The verification code can be found on the inside cover of your book or on your purchase receipt."}),e.jsx(A,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:1,mb:2,py:1.5},disabled:k||P,children:k?e.jsx(ge,{size:24}):"Verify Book"})]})})]}),e.jsxs(mr,{children:[e.jsx(xr,{children:"Verification Complete"}),e.jsx(nn,{children:e.jsxs(x,{sx:{py:2},children:[e.jsx(ha,{in:V===1,children:e.jsxs(x,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(yr,{color:"success",sx:{fontSize:40,mr:2}}),e.jsx(l,{variant:"h6",children:"Book Successfully Verified!"})]})}),e.jsx(l,{variant:"body1",children:"Your copy of Alice in Wonderland has been verified. You now have full access to all interactive features."})]})})]}),e.jsxs(mr,{children:[e.jsx(xr,{children:"Preparing Your Experience"}),e.jsx(nn,{children:e.jsxs(x,{sx:{py:2},children:[e.jsx(l,{variant:"body1",paragraph:!0,children:"Setting up your personalized reading experience..."}),e.jsxs(x,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[e.jsx(_e,{label:"Dictionary Service",color:"success"}),e.jsx(_e,{label:"AI Assistant",color:"success"}),e.jsx(_e,{label:"Reading Progress",color:"success"}),e.jsx(_e,{label:"Consultant Support",color:"success"})]})]})})]})]}),e.jsx(ie,{sx:{my:3}}),e.jsxs(x,{sx:{mt:2},children:[e.jsxs(l,{variant:"body2",color:"text.secondary",paragraph:!0,children:[e.jsx("strong",{children:"Note:"})," By verifying your book, you agree that your reading progress and interactions may be monitored by our reading consultants to provide personalized assistance when needed."]}),e.jsx(l,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Your privacy is important to us. All data is handled according to our Privacy Policy."})]}),e.jsx(ie,{sx:{my:3}})]})})})},Jc=()=>{const{service:n,loading:t}=na(),{service:r}=Re(),[i,s]=g.useState(""),[a,o]=g.useState(null),[d,h]=g.useState(null),[u,f]=g.useState(!1);ze({trackPageLoad:!0,trackRender:!0,componentName:"ForgotPasswordPage"}),g.useEffect(()=>{r&&r.trackPageView("forgot_password_page")},[r]);const m=async v=>{if(v.preventDefault(),!i.trim()){o("Please enter your email address");return}if(!n){o("Authentication service not available");return}f(!0),o(null),h(null);try{const b=performance.now(),{error:p}=await n.resetPassword(i);if(p)throw p;h("Password reset instructions have been sent to your email."),r&&r.trackEvent("password_reset_request",{success:!0,timeToComplete:performance.now()-b})}catch(b){o(b.message||"Failed to send password reset email. Please try again."),r&&r.trackEvent("password_reset_request",{success:!1,error:b.message})}finally{f(!1)}};return t?e.jsx(x,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:e.jsx(ge,{})}):e.jsx(Ct,{maxWidth:"sm",children:e.jsx(x,{sx:{mt:8,display:"flex",flexDirection:"column",alignItems:"center"},children:e.jsxs(O,{elevation:3,sx:{p:4,width:"100%",borderRadius:2},children:[e.jsx(l,{component:"h1",variant:"h4",align:"center",gutterBottom:!0,children:"Reset Password"}),e.jsx(l,{variant:"body1",align:"center",color:"text.secondary",sx:{mb:3},children:"Enter your email address and we'll send you instructions to reset your password"}),a&&e.jsx(je,{severity:"error",sx:{mb:3},children:a}),d&&e.jsx(je,{severity:"success",sx:{mb:3},children:d}),e.jsxs(x,{component:"form",onSubmit:m,noValidate:!0,children:[e.jsx(he,{margin:"normal",required:!0,fullWidth:!0,id:"email",label:"Email Address",name:"email",autoComplete:"email",autoFocus:!0,value:i,onChange:v=>s(v.target.value),error:!!a&&!i.trim(),disabled:!!d}),e.jsx(A,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2,py:1.5},disabled:u||!!d,children:u?e.jsx(ge,{size:24}):"Reset Password"}),e.jsx(x,{sx:{mt:3,textAlign:"center"},children:e.jsxs(l,{variant:"body2",children:["Remember your password?"," ",e.jsx(wt,{component:U,to:"/login",children:"Sign In"})]})})]})]})})})};var Nt={},ji;function Kc(){if(ji)return Nt;ji=1;var n=W();Object.defineProperty(Nt,"__esModule",{value:!0}),Nt.default=void 0;var t=n(Y()),r=H();return Nt.default=(0,t.default)([(0,r.jsx)("path",{d:"M21 5c-1.11-.35-2.33-.5-3.5-.5-1.95 0-4.05.4-5.5 1.5-1.45-1.1-3.55-1.5-5.5-1.5S2.45 4.9 1 6v14.65c0 .25.25.5.5.5.1 0 .15-.05.25-.05C3.1 20.45 5.05 20 6.5 20c1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.3 4.75 1.05.1.05.15.05.25.05.25 0 .5-.25.5-.5V6c-.6-.45-1.25-.75-2-1m0 13.5c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V8c1.35-.85 3.8-1.5 5.5-1.5 1.2 0 2.4.15 3.5.5z"},"0"),(0,r.jsx)("path",{d:"M17.5 10.5c.88 0 1.73.09 2.5.26V9.24c-.79-.15-1.64-.24-2.5-.24-1.7 0-3.24.29-4.5.83v1.66c1.13-.64 2.7-.99 4.5-.99M13 12.49v1.66c1.13-.64 2.7-.99 4.5-.99.88 0 1.73.09 2.5.26V11.9c-.79-.15-1.64-.24-2.5-.24-1.7 0-3.24.3-4.5.83m4.5 1.84c-1.7 0-3.24.29-4.5.83v1.66c1.13-.64 2.7-.99 4.5-.99.88 0 1.73.09 2.5.26v-1.52c-.79-.16-1.64-.24-2.5-.24"},"1")],"MenuBook"),Nt}var Xc=Kc();const Qr=G(Xc);var Wt={},_i;function el(){if(_i)return Wt;_i=1;var n=W();Object.defineProperty(Wt,"__esModule",{value:!0}),Wt.default=void 0;var t=n(Y()),r=H();return Wt.default=(0,t.default)((0,r.jsx)("path",{d:"M21 3H3c-1.11 0-2 .89-2 2v12c0 1.1.89 2 2 2h5v2h8v-2h5c1.1 0 1.99-.9 1.99-2L23 5c0-1.11-.9-2-2-2m0 14H3V5h18zm-5-6-7 4V7z"}),"OndemandVideo"),Wt}var tl=el();const rl=G(tl);var Ht={},wi;function nl(){if(wi)return Ht;wi=1;var n=W();Object.defineProperty(Ht,"__esModule",{value:!0}),Ht.default=void 0;var t=n(Y()),r=H();return Ht.default=(0,t.default)((0,r.jsx)("path",{d:"m10 16.5 6-4.5-6-4.5zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"}),"PlayCircleOutline"),Ht}var il=nl();const sl=G(il);var Gt={},ki;function al(){if(ki)return Gt;ki=1;var n=W();Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.default=void 0;var t=n(Y()),r=H();return Gt.default=(0,t.default)((0,r.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 17h-2v-2h2zm2.07-7.75-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25"}),"Help"),Gt}var ol=al();const _r=G(ol),cl=()=>{console.log("ReaderDashboard: Rendering component");const n=Ze(),{service:t,loading:r}=en(),{loading:i}=na(),{service:s}=Re(),{user:a,profile:o}=ke(),[d,h]=g.useState(null),[u,f]=g.useState(!0),[m,v]=g.useState(null);return ze({trackPageLoad:!0,trackRender:!0,componentName:"ReaderDashboard"}),g.useEffect(()=>{if(console.log("ReaderDashboard: useEffect triggered",{hasBookService:!!t,hasUser:!!a,userId:a==null?void 0:a.id}),!t||!a){console.log("ReaderDashboard: Missing bookService or user, skipping data load");return}(async()=>{console.log("ReaderDashboard: Starting to load data");try{console.log("ReaderDashboard: Fetching book data");const p=await t.getBook("alice-in-wonderland");console.log("ReaderDashboard: Book data received",p),h(p),s&&(console.log("ReaderDashboard: Tracking page view"),s.trackPageView("reader_dashboard",{userId:a.id,bookId:"alice-in-wonderland"}))}catch(p){console.error("ReaderDashboard: Error loading data:",p),v(p instanceof Error?p.message:"An error occurred while loading data")}finally{console.log("ReaderDashboard: Finished loading data, setting loading to false"),f(!1)}})()},[t,a,s]),i||r||u?(console.log("ReaderDashboard: Showing loading state"),e.jsx(x,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:e.jsx(ge,{})})):m?(console.log("ReaderDashboard: Showing error state:",m),e.jsx(x,{sx:{p:3,maxWidth:"1200px",mx:"auto"},children:e.jsxs(O,{sx:{p:4,borderRadius:2,textAlign:"center"},children:[e.jsx(l,{variant:"h5",color:"error",gutterBottom:!0,children:"Something went wrong"}),e.jsx(l,{variant:"body1",paragraph:!0,children:m}),e.jsx(A,{variant:"contained",onClick:()=>window.location.reload(),children:"Reload Page"})]})})):d?e.jsxs(x,{sx:{p:3,maxWidth:"1200px",mx:"auto"},children:[e.jsxs(x,{sx:{mb:5},children:[e.jsxs(l,{variant:"h3",gutterBottom:!0,sx:{fontWeight:"bold"},children:["Welcome, ",(o==null?void 0:o.first_name)||"Reader","!"]}),e.jsx(l,{variant:"h6",color:"text.secondary",children:"Your reading companion for Alice in Wonderland"})]}),e.jsxs(j,{container:!0,spacing:4,children:[e.jsxs(j,{item:!0,xs:12,md:9,children:[e.jsx(O,{elevation:3,sx:{borderRadius:2,overflow:"hidden",mb:4,textAlign:"center",p:0},children:e.jsxs(x,{sx:{p:0,display:"flex",flexDirection:{xs:"column",sm:"row"},height:{sm:"300px"}},children:[e.jsx(x,{sx:{width:{xs:"100%",sm:"200px"},height:{xs:"200px",sm:"100%"},position:"relative",overflow:"hidden"},children:e.jsx(x,{component:"img",src:ia,alt:(d==null?void 0:d.title)||"Alice in Wonderland",sx:{width:"100%",height:"100%",objectFit:"cover"}})}),e.jsxs(x,{sx:{p:3,flex:1,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",textAlign:"center"},children:[e.jsx(l,{variant:"h5",gutterBottom:!0,children:(d==null?void 0:d.title)||"Alice's Adventures in Wonderland"}),e.jsxs(l,{variant:"subtitle1",gutterBottom:!0,children:["By ",(d==null?void 0:d.author)||"Lewis Carroll"]}),e.jsx(ie,{sx:{my:2,width:"100%"}}),e.jsx(l,{variant:"body1",sx:{mb:3},children:"Ready to continue your reading journey? Sync with your physical book to get contextual help, definitions, and AI assistance."}),e.jsx(A,{onClick:()=>{console.log("ReaderDashboard: Navigating to reader page"),n("/reader/interaction")},variant:"contained",color:"primary",size:"large",startIcon:e.jsx(Qr,{}),sx:{py:2,px:5,fontSize:"1.2rem",fontWeight:"bold",minWidth:"280px",boxShadow:4,mt:2,borderRadius:2,"&:hover":{transform:"translateY(-2px)",boxShadow:6},transition:"all 0.2s"},children:"Open Reading Companion"})]})]})}),e.jsxs(O,{sx:{p:3,borderRadius:2,mb:4},children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"How to Use Your Reading Companion"}),e.jsx(l,{variant:"body1",paragraph:!0,children:"The Alice Reader App is designed to enhance your experience with the physical book, not replace it."}),e.jsx(we,{children:["Tell us what page you're on in your physical copy of Alice in Wonderland","Get contextual information about characters, themes, and plot points","Look up definitions for unfamiliar words by highlighting text","Ask the AI assistant questions about what you're reading"].map((b,p)=>e.jsxs(me,{children:[e.jsx(gt,{sx:{minWidth:"36px"},children:e.jsx(x,{sx:{width:24,height:24,borderRadius:"50%",bgcolor:"primary.main",color:"white",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.8rem",fontWeight:"bold"},children:p+1})}),e.jsx(xe,{primary:b})]},p))})]})]}),e.jsxs(j,{item:!0,xs:12,md:3,children:[e.jsxs(O,{sx:{p:3,borderRadius:2,mb:4},children:[e.jsxs(l,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center"},children:[e.jsx(_r,{sx:{mr:1,color:"primary.main"}}),"Help & Resources"]}),e.jsx(l,{variant:"body2",paragraph:!0,children:"Need help with the Alice Reader app? Check out these resources:"}),e.jsx(we,{children:[{title:"User Guide",link:"/help/guide"},{title:"FAQ",link:"/help/faq"},{title:"Contact Support",link:"/help/contact"}].map((b,p)=>e.jsx(me,{component:U,to:b.link,button:!0,sx:{borderRadius:1,"&:hover":{bgcolor:"action.hover"}},children:e.jsx(xe,{primary:b.title})},p))})]}),e.jsxs(O,{sx:{p:3,borderRadius:2,mb:4},children:[e.jsxs(l,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center"},children:[e.jsx(rl,{sx:{mr:1,color:"primary.main"}}),"Quick Demo"]}),e.jsx(l,{variant:"body2",paragraph:!0,children:"See how the Alice Reader App enhances your reading experience:"}),e.jsx(A,{variant:"outlined",fullWidth:!0,startIcon:e.jsx(sl,{}),disabled:!0,sx:{mt:1},children:"Watch Demo (Coming Soon)"})]})]})]})]}):(console.log("ReaderDashboard: No book data available, showing fallback"),e.jsxs(x,{sx:{p:3,maxWidth:"1200px",mx:"auto"},children:[e.jsxs(l,{variant:"h4",gutterBottom:!0,children:["Welcome back, ",(o==null?void 0:o.first_name)||"Reader","!"]}),e.jsxs(O,{sx:{p:4,borderRadius:2,textAlign:"center"},children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Dashboard Test"}),e.jsx(l,{variant:"body1",paragraph:!0,children:"Your book data is being loaded. If this message persists, please try refreshing the page."})]})]}))};var Yt={},Ei;function ll(){if(Ei)return Yt;Ei=1;var n=W();Object.defineProperty(Yt,"__esModule",{value:!0}),Yt.default=void 0;var t=n(Y()),r=H();return Yt.default=(0,t.default)((0,r.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack"),Yt}var dl=ll();const Zr=G(dl);var Qt={},Ci;function ul(){if(Ci)return Qt;Ci=1;var n=W();Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.default=void 0;var t=n(Y()),r=H();return Qt.default=(0,t.default)((0,r.jsx)("path",{d:"m12 4-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"}),"ArrowForward"),Qt}var hl=ul();const gl=G(hl);var Zt={},Ri;function fl(){if(Ri)return Zt;Ri=1;var n=W();Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.default=void 0;var t=n(Y()),r=H();return Zt.default=(0,t.default)((0,r.jsx)("path",{d:"M11 18h2v-2h-2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4"}),"HelpOutline"),Zt}var pl=fl();const ml=G(pl);var Jt={},Ii;function xl(){if(Ii)return Jt;Ii=1;var n=W();Object.defineProperty(Jt,"__esModule",{value:!0}),Jt.default=void 0;var t=n(Y()),r=H();return Jt.default=(0,t.default)((0,r.jsx)("path",{d:"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"}),"Home"),Jt}var vl=xl();const Jr=G(vl),yl=({variant:n="text",count:t=1,height:r,width:i="100%"})=>{const s=()=>{switch(n){case"card":return e.jsxs(x,{sx:{width:i,height:r||200,borderRadius:1,overflow:"hidden"},children:[e.jsx(qe,{variant:"rectangular",width:"100%",height:"60%"}),e.jsxs(x,{sx:{p:1},children:[e.jsx(qe,{variant:"text",width:"80%"}),e.jsx(qe,{variant:"text",width:"60%"})]})]});case"list":return e.jsxs(Mn,{spacing:1,width:i,children:[e.jsx(qe,{variant:"text",width:"100%",height:40}),e.jsx(qe,{variant:"text",width:"90%",height:40}),e.jsx(qe,{variant:"text",width:"95%",height:40})]});case"profile":return e.jsxs(x,{sx:{width:i},children:[e.jsx(qe,{variant:"circular",width:80,height:80,sx:{mb:2}}),e.jsx(qe,{variant:"text",width:"60%",height:32,sx:{mb:1}}),e.jsx(qe,{variant:"text",width:"40%",height:24,sx:{mb:2}}),e.jsx(qe,{variant:"rectangular",width:"100%",height:120})]});default:return e.jsx(qe,{variant:"text",width:i,height:r||24})}};return e.jsx(Mn,{spacing:2,children:Array.from({length:t}).map((a,o)=>e.jsx(Z.Fragment,{children:s()},o))})},bl=({word:n,definition:t,onClose:r,onAskAI:i,anchorEl:s})=>e.jsx(pa,{open:!!s,anchorEl:s,onClose:r,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},sx:{mt:1},children:e.jsxs(x,{sx:{p:2,maxWidth:300},children:[e.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(l,{variant:"h6",component:"h3",children:n}),e.jsx($e,{size:"small",onClick:r,children:e.jsx(Kr,{fontSize:"small"})})]}),e.jsx(l,{variant:"body2",paragraph:!0,children:t}),e.jsx(A,{size:"small",startIcon:e.jsx(jr,{}),onClick:i,sx:{mt:1},children:"Ask AI about this"})]})}),Sl=({open:n,onClose:t,context:r})=>{const[i,s]=g.useState(""),[a,o]=g.useState(""),[d,h]=g.useState(!1),[u,f]=g.useState([]),{service:m}=zc(),{service:v}=Re(),b=g.useRef(null);g.useEffect(()=>{r&&n&&r.word&&s(`Tell me more about "${r.word}" in this context: "${r.sentence}"`)},[r,n]),g.useEffect(()=>{b.current&&b.current.scrollIntoView({behavior:"smooth"})},[u]);const p=async y=>{if(y.preventDefault(),!(!i.trim()||!m)){f([...u,{role:"user",content:i}]),v&&v.trackReaderAction("ai_query",{bookId:"alice-in-wonderland",pageNumber:1,content:i}),h(!0);try{const _=performance.now(),w=await m.getResponse(i,(r==null?void 0:r.sentence)||"");f([...u,{role:"user",content:i},{role:"assistant",content:w.response}]),s(""),v&&v.trackPerformance("api_call",performance.now()-_,{endpoint:"ai_response",success:!0})}catch(_){console.error("Error getting AI response:",_),f([...u,{role:"user",content:i},{role:"assistant",content:"I apologize, but I encountered an error processing your request. Please try again."}]),v&&v.trackEvent("ai_error",{query:i,error:String(_)})}finally{h(!1)}}};return e.jsxs(ma,{anchor:"right",open:n,onClose:t,sx:{"& .MuiDrawer-paper":{width:{xs:"100%",sm:400},p:2,display:"flex",flexDirection:"column"}},children:[e.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(l,{variant:"h6",children:"AI Reading Assistant"}),e.jsx($e,{onClick:t,children:e.jsx(Kr,{})})]}),e.jsx(ie,{sx:{mb:2}}),e.jsx(x,{sx:{flexGrow:1,overflow:"auto",mb:2},children:u.length===0?e.jsxs(x,{sx:{p:2,textAlign:"center"},children:[e.jsx(jr,{sx:{fontSize:60,color:"primary.main",mb:2}}),e.jsx(l,{variant:"body1",paragraph:!0,children:"Ask me anything about the story, characters, or themes in Alice in Wonderland."}),e.jsx(l,{variant:"body2",color:"text.secondary",children:"I can help explain difficult passages, provide context, or discuss literary elements."})]}):e.jsxs(x,{sx:{px:1},children:[u.map((y,_)=>e.jsx(x,{sx:{mb:2,p:2,borderRadius:2,maxWidth:"85%",bgcolor:y.role==="user"?"primary.light":"background.paper",color:y.role==="user"?"primary.contrastText":"text.primary",alignSelf:y.role==="user"?"flex-end":"flex-start",ml:y.role==="user"?"auto":0,boxShadow:1},children:e.jsx(l,{variant:"body1",children:y.content})},_)),e.jsx("div",{ref:b})]})}),e.jsx(ie,{sx:{mb:2}}),e.jsxs(x,{component:"form",onSubmit:p,children:[e.jsx(he,{fullWidth:!0,variant:"outlined",placeholder:"Ask about the story...",value:i,onChange:y=>s(y.target.value),disabled:d,multiline:!0,maxRows:3,sx:{mb:1}}),e.jsxs(x,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(A,{variant:"outlined",startIcon:e.jsx(ml,{}),component:"a",href:"/help/request",target:"_blank",children:"Request Help"}),e.jsx(A,{type:"submit",variant:"contained",disabled:!i.trim()||d,endIcon:d?e.jsx(ge,{size:16}):e.jsx(jr,{}),children:d?"Thinking...":"Ask"})]})]})]})},jl=({prompt:n,onRespond:t,onDismiss:r})=>e.jsx(Ji,{open:!0,anchorOrigin:{vertical:"bottom",horizontal:"right"},sx:{mb:8},children:e.jsxs(je,{severity:"info",sx:{width:"100%","& .MuiAlert-message":{width:"100%"}},onClose:()=>r(n.id),children:[e.jsx(l,{variant:"body2",paragraph:!0,children:n.message}),n.type==="feedback"&&e.jsx(x,{sx:{display:"flex",justifyContent:"space-between",gap:1},children:["😊","🤔","😕","😄"].map(i=>e.jsx(A,{variant:"outlined",size:"small",onClick:()=>t(n.id,i),sx:{minWidth:"auto"},children:i},i))})]})}),_l=()=>{const{bookId:n="alice-in-wonderland",pageNumber:t="1"}=rs(),r=Ze(),i=wr();Pn(i.breakpoints.down("sm"));const{user:s}=ke(),{service:a,loading:o}=en(),{service:d,loading:h}=ra(),{service:u}=Re(),{service:f}=qc(),{settings:m}=Vs(),[v,b]=g.useState(null),[p,y]=g.useState(null),[_,w]=g.useState(0),[S,k]=g.useState(!1),[I,E]=g.useState(!0),[$,P]=g.useState(null),[Q,V]=g.useState(null),[te,C]=g.useState(null),[B,D]=g.useState(null),[fe,de]=g.useState(""),[R,Ee]=g.useState(!1),[Ie,vt]=g.useState(void 0),[it,Ke]=g.useState(null),tn=g.useRef(null),st=g.useRef(Ae.now()),Ae=ze({trackPageLoad:!0,trackRender:!0,componentName:"ReaderPage"});g.useEffect(()=>{if(console.log("ReaderPage: useEffect triggered for loading book content",{hasBookService:!!a,bookId:n,pageNumber:t}),!a){console.log("ReaderPage: No bookService available, skipping data load");return}(async()=>{E(!0),P(null);try{const J=Ae.now(),ve=await a.getBook(n);if(Ae.trackApiCall("getBook",J),console.log("ReaderPage: Book data received:",ve),ve)b(ve),w(ve.totalPages||100);else throw new Error("Failed to load book data");const at=await a.getPage(n,parseInt(t));if(console.log("ReaderPage: Page data received:",at),at)y(at),k(!0);else throw new Error("Failed to load page content");u&&s&&u.trackPageView("reader_page",{userId:s.id,bookId:n,pageNumber:t}),st.current=Ae.now()}catch(J){console.error("Error loading book content:",J),P("Failed to load book content. Please try again."),u&&u.trackEvent("reader_error",{bookId:n,pageNumber:t,error:String(J)})}finally{E(!1)}})()},[n,t,a,u,s,Ae]),g.useEffect(()=>{if(!f||!s)return;const F=f.subscribeToTriggers(s.id,J=>{Ke(J)});return()=>{F&&F()}},[f,s]),g.useEffect(()=>()=>{if(console.log("ReaderPage: Unmounting component, updating reading progress",{hasBookService:!!a,hasUser:!!s,bookId:n,pageNumber:t}),a&&s&&n&&t){const F=Math.round((Ae.now()-st.current)/1e3);if(F>=5)try{a.updateReadingProgress(s.id,n,parseInt(t),F),console.log("ReaderPage: Successfully updated reading progress",{userId:s.id,bookId:n,pageNumber:t,readingTime:F}),u&&u.trackEvent("reading_session",{bookId:n,pageNumber:t,duration:F})}catch(J){console.error("ReaderPage: Error updating reading progress:",J)}}},[a,s,n,t,u]);const L=g.useCallback(async F=>{const J=window.getSelection();if(!J||J.rangeCount===0)return;const ve=J.toString().trim();if(!ve||ve.split(" ").length>3)return;const se=J.getRangeAt(0).startContainer.parentNode,Te=(se==null?void 0:se.textContent)||"";if(V(ve),C(Te),D(F.currentTarget),d)try{const re=Ae.now(),De=await d.getDefinition(ve);Ae.trackApiCall("getDefinition",re),de(De.definition||"No definition found"),u&&s&&u.trackReaderAction("definition",{bookId:n,pageNumber:parseInt(t),content:ve})}catch(re){console.error("Error getting definition:",re),de("Definition not available")}},[d,u,s,n,t,Ae]),N=F=>{if(console.log("ReaderPage: Navigating to page",{newPage:F,totalPages:_}),F<1||F>_){console.log("ReaderPage: Invalid page number, not navigating");return}if(a&&s&&n){const J=Math.round((Ae.now()-st.current)/1e3);if(J>=5)try{a.updateReadingProgress(s.id,n,parseInt(t),J),console.log("ReaderPage: Updated reading progress before navigation")}catch(ve){console.error("ReaderPage: Error updating reading progress before navigation:",ve)}}k(!1),E(!0),console.log("ReaderPage: Navigating to",`/reader/${n}/page/${F}`),r(`/reader/${n}/page/${F}`)},oe=F=>{vt(F&&Q?{word:Q,sentence:te||""}:void 0),Ee(!0),D(null)},Be=(F,J)=>{f&&f.markTriggerProcessed(F,J),u&&u.trackEvent("prompt_response",{promptId:F,response:J}),Ke(null)},We=F=>{f&&f.markTriggerProcessed(F,"dismissed"),u&&u.trackEvent("prompt_dismissed",{promptId:F}),Ke(null)};if(I||o||h)return console.log("ReaderPage: Showing loading state"),e.jsx(yl,{type:"reader"});if($)return console.log("ReaderPage: Showing error state:",$),e.jsxs(x,{sx:{p:3,textAlign:"center"},children:[e.jsx(l,{color:"error",variant:"h6",gutterBottom:!0,children:$}),e.jsx(A,{variant:"contained",onClick:()=>r("/reader"),startIcon:e.jsx(Jr,{}),sx:{mt:2},children:"Return to Dashboard"})]});if(!S||!v||!p)return console.log("ReaderPage: Not fully initialized or missing required data",{initialized:S,bookData:v,currentPage:p}),e.jsxs(x,{sx:{p:3,textAlign:"center"},children:[e.jsx(l,{color:"error",variant:"h6",gutterBottom:!0,children:"Something went wrong... Cannot access required data."}),e.jsx(l,{variant:"body1",color:"text.secondary",paragraph:!0,children:"The reader page could not be loaded because some required data is missing."}),e.jsx(A,{variant:"contained",onClick:()=>r("/reader"),startIcon:e.jsx(Jr,{}),sx:{mt:2},children:"Return to Dashboard"})]});const Pe={fontSize:`${m.fontSize/100}rem`,lineHeight:m.lineHeight};return e.jsxs(x,{sx:{position:"relative",minHeight:"100vh"},children:[e.jsx(x,{sx:{position:"sticky",top:0,zIndex:10,bgcolor:"background.paper",boxShadow:1,p:1},children:e.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center"},children:[e.jsx($e,{onClick:()=>r("/reader"),"aria-label":"Back to dashboard",children:e.jsx(Zr,{})}),e.jsx(l,{variant:"subtitle1",sx:{ml:1,display:{xs:"none",sm:"block"}},children:(v==null?void 0:v.title)||"Alice in Wonderland"})]}),e.jsxs(x,{sx:{display:"flex",alignItems:"center"},children:[e.jsxs(l,{variant:"body2",sx:{mr:2},children:["Page ",t," of ",_]}),e.jsx(No,{})]})]})}),e.jsx(Ct,{maxWidth:"md",sx:{py:4},children:e.jsxs(O,{elevation:2,sx:{p:4,borderRadius:2,position:"relative"},children:[e.jsx(l,{variant:"h5",component:"h1",gutterBottom:!0,children:(p==null?void 0:p.title)||`Chapter ${t}`}),e.jsx(ie,{sx:{my:2}}),e.jsx(x,{ref:tn,onClick:L,sx:{mt:2,"& p":{...Pe,mb:2}},children:p!=null&&p.content?p.content.split(`

`).map((F,J)=>e.jsx(l,{component:"p",paragraph:!0,sx:Pe,children:F},J)):e.jsx(l,{variant:"body1",children:"No content available for this page."})}),e.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",mt:4},children:[e.jsx(A,{variant:"outlined",startIcon:e.jsx(Zr,{}),onClick:()=>N(parseInt(t)-1),disabled:parseInt(t)<=1,children:"Previous"}),e.jsx(A,{variant:"outlined",endIcon:e.jsx(gl,{}),onClick:()=>N(parseInt(t)+1),disabled:parseInt(t)>=_,children:"Next"})]})]})}),Q&&e.jsx(bl,{word:Q,definition:fe,onClose:()=>D(null),onAskAI:()=>oe(!0),anchorEl:B}),e.jsx(Sl,{open:R,onClose:()=>Ee(!1),context:Ie}),e.jsx(ga,{in:!R,children:e.jsx(fa,{color:"primary","aria-label":"AI Assistant",onClick:()=>oe(),sx:{position:"fixed",bottom:16,right:16},children:e.jsx(jr,{})})}),it&&e.jsx(jl,{prompt:it,onRespond:Be,onDismiss:We})]})};var Kt={},Ai;function wl(){if(Ai)return Kt;Ai=1;var n=W();Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.default=void 0;var t=n(Y()),r=H();return Kt.default=(0,t.default)((0,r.jsx)("path",{d:"M9 1h6v2H9zm10.03 6.39 1.42-1.42c-.43-.51-.9-.99-1.41-1.41l-1.42 1.42C16.07 4.74 14.12 4 12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9 9-4.03 9-9c0-2.12-.74-4.07-1.97-5.61M13 14h-2V8h2z"}),"Timer"),Kt}var kl=wl();const El=G(kl);var Xt={},Pi;function Cl(){if(Pi)return Xt;Pi=1;var n=W();Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.default=void 0;var t=n(Y()),r=H();return Xt.default=(0,t.default)((0,r.jsx)("path",{d:"m16 6 2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"}),"TrendingUp"),Xt}var Rl=Cl();const Il=G(Rl);var er={},Ti;function Al(){if(Ti)return er;Ti=1;var n=W();Object.defineProperty(er,"__esModule",{value:!0}),er.default=void 0;var t=n(Y()),r=H();return er.default=(0,t.default)((0,r.jsx)("path",{d:"M20 3h-1V1h-2v2H7V1H5v2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 18H4V8h16z"}),"CalendarToday"),er}var Pl=Al();const Tl=G(Pl),Dl={dailyReadingTime:[15,25,10,30,20,35,15],weeklyProgress:[5,12,8,15,10,20,18],pagesPerSession:[3,5,2,7,4,8,3],readingSpeed:[120,130,110,140,125,135,130],daysActive:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],vocabularyGrowth:[5,8,12,15,18,22,25],aiInteractions:[2,1,3,0,2,4,1]};function pn(n){const{children:t,value:r,index:i,...s}=n;return e.jsx("div",{role:"tabpanel",hidden:r!==i,id:`stats-tabpanel-${i}`,"aria-labelledby":`stats-tab-${i}`,...s,children:r===i&&e.jsx(x,{sx:{p:3},children:t})})}const Ol=()=>{const n=wr(),{user:t}=ke(),{loading:r}=en(),{service:i,loading:s}=Lc(),{service:a}=Re(),[o,d]=g.useState(!0),[h,u]=g.useState(null),[f,m]=g.useState(null),[v,b]=g.useState(0);ze({trackPageLoad:!0,trackRender:!0,componentName:"ReaderStatistics"}),g.useEffect(()=>{if(!i||!t)return;(async()=>{d(!0),u(null);try{const _=performance.now(),w=await i.getReadingStatistics(t.id,"alice-in-wonderland");m({...Dl,totalReadingTime:150,totalPagesRead:68,totalChaptersCompleted:3,averageReadingSpeed:130,vocabularyLookups:25,aiAssistantUsage:12,lastReadDate:new Date().toISOString(),...w}),a&&a.trackPageView("reader_statistics",{userId:t.id,bookId:"alice-in-wonderland"})}catch(_){console.error("Error loading statistics:",_),u("Failed to load reading statistics. Please try again."),a&&a.trackEvent("statistics_error",{error:String(_)})}finally{d(!1)}})()},[i,t,a]);const p=(y,_)=>{b(_),a&&a.trackEvent("statistics_tab_change",{tabIndex:_})};return o||r||s?e.jsx(x,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:e.jsx(ge,{})}):h?e.jsxs(x,{sx:{p:3,textAlign:"center"},children:[e.jsx(l,{color:"error",variant:"h6",gutterBottom:!0,children:h}),e.jsx(A,{variant:"contained",component:U,to:"/reader",startIcon:e.jsx(Jr,{}),sx:{mt:2},children:"Return to Dashboard"})]}):e.jsxs(x,{sx:{p:3,maxWidth:"1200px",mx:"auto"},children:[e.jsxs(x,{sx:{mb:4},children:[e.jsx(l,{variant:"h4",gutterBottom:!0,children:"Reading Statistics"}),e.jsx(l,{variant:"body1",color:"text.secondary",children:"Track your reading progress and habits"})]}),e.jsx(j,{container:!0,spacing:3,sx:{mb:4},children:[{title:"Total Reading Time",value:`${f.totalReadingTime} mins`,icon:e.jsx(El,{sx:{fontSize:40,color:n.palette.primary.main}}),color:n.palette.primary.light},{title:"Pages Read",value:`${f.totalPagesRead} pages`,icon:e.jsx(Qr,{sx:{fontSize:40,color:n.palette.secondary.main}}),color:n.palette.secondary.light},{title:"Reading Speed",value:`${f.averageReadingSpeed} wpm`,icon:e.jsx(Il,{sx:{fontSize:40,color:n.palette.success.main}}),color:n.palette.success.light},{title:"Last Read",value:new Date(f.lastReadDate).toLocaleDateString(),icon:e.jsx(Tl,{sx:{fontSize:40,color:n.palette.info.main}}),color:n.palette.info.light}].map((y,_)=>e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(O,{elevation:2,sx:{p:3,height:"100%",display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center",bgcolor:y.color,borderRadius:2},children:[e.jsx(x,{sx:{mb:2},children:y.icon}),e.jsx(l,{variant:"h6",gutterBottom:!0,children:y.title}),e.jsx(l,{variant:"h4",children:y.value})]})},_))}),e.jsxs(O,{sx:{mb:4,borderRadius:2},children:[e.jsxs(kr,{value:v,onChange:p,indicatorColor:"primary",textColor:"primary",variant:"fullWidth",children:[e.jsx(Se,{label:"Reading Activity"}),e.jsx(Se,{label:"Vocabulary"}),e.jsx(Se,{label:"AI Assistance"})]}),e.jsx(pn,{value:v,index:0,children:e.jsxs(j,{container:!0,spacing:4,children:[e.jsxs(j,{item:!0,xs:12,md:6,children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Daily Reading Time"}),e.jsx(O,{elevation:1,sx:{p:3,height:300,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(l,{variant:"body1",color:"text.secondary",children:"[Bar Chart Visualization]"})})]}),e.jsxs(j,{item:!0,xs:12,md:6,children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Reading Progress"}),e.jsx(O,{elevation:1,sx:{p:3,height:300,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(l,{variant:"body1",color:"text.secondary",children:"[Line Chart Visualization]"})})]}),e.jsxs(j,{item:!0,xs:12,children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Reading Habits"}),e.jsx(O,{elevation:1,sx:{p:3},children:e.jsxs(j,{container:!0,spacing:2,children:[e.jsx(j,{item:!0,xs:12,sm:4,children:e.jsxs(x,{sx:{textAlign:"center",p:2},children:[e.jsx(l,{variant:"h3",color:"primary",children:f.totalChaptersCompleted}),e.jsx(l,{variant:"body1",children:"Chapters Completed"})]})}),e.jsx(j,{item:!0,xs:12,sm:4,children:e.jsxs(x,{sx:{textAlign:"center",p:2},children:[e.jsx(l,{variant:"h3",color:"primary",children:Math.round(f.totalPagesRead/7)}),e.jsx(l,{variant:"body1",children:"Pages Per Day"})]})}),e.jsx(j,{item:!0,xs:12,sm:4,children:e.jsxs(x,{sx:{textAlign:"center",p:2},children:[e.jsx(l,{variant:"h3",color:"primary",children:Math.round(f.totalReadingTime/f.totalPagesRead)}),e.jsx(l,{variant:"body1",children:"Minutes Per Page"})]})})]})})]})]})}),e.jsx(pn,{value:v,index:1,children:e.jsxs(j,{container:!0,spacing:4,children:[e.jsxs(j,{item:!0,xs:12,md:6,children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Vocabulary Growth"}),e.jsx(O,{elevation:1,sx:{p:3,height:300,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(l,{variant:"body1",color:"text.secondary",children:"[Line Chart Visualization]"})})]}),e.jsxs(j,{item:!0,xs:12,md:6,children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Most Looked Up Words"}),e.jsx(O,{elevation:1,sx:{p:3,height:300,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(l,{variant:"body1",color:"text.secondary",children:"[Word Cloud Visualization]"})})]}),e.jsxs(j,{item:!0,xs:12,children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Vocabulary Summary"}),e.jsx(O,{elevation:1,sx:{p:3},children:e.jsxs(j,{container:!0,spacing:2,children:[e.jsx(j,{item:!0,xs:12,sm:4,children:e.jsxs(x,{sx:{textAlign:"center",p:2},children:[e.jsx(l,{variant:"h3",color:"secondary",children:f.vocabularyLookups}),e.jsx(l,{variant:"body1",children:"Words Looked Up"})]})}),e.jsx(j,{item:!0,xs:12,sm:4,children:e.jsxs(x,{sx:{textAlign:"center",p:2},children:[e.jsx(l,{variant:"h3",color:"secondary",children:Math.round(f.vocabularyLookups*.8)}),e.jsx(l,{variant:"body1",children:"Unique Words"})]})}),e.jsx(j,{item:!0,xs:12,sm:4,children:e.jsxs(x,{sx:{textAlign:"center",p:2},children:[e.jsx(l,{variant:"h3",color:"secondary",children:Math.round(f.vocabularyLookups/f.totalPagesRead*10)/10}),e.jsx(l,{variant:"body1",children:"Lookups Per Page"})]})})]})})]})]})}),e.jsx(pn,{value:v,index:2,children:e.jsxs(j,{container:!0,spacing:4,children:[e.jsxs(j,{item:!0,xs:12,md:6,children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"AI Assistant Usage"}),e.jsx(O,{elevation:1,sx:{p:3,height:300,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(l,{variant:"body1",color:"text.secondary",children:"[Bar Chart Visualization]"})})]}),e.jsxs(j,{item:!0,xs:12,md:6,children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Common AI Questions"}),e.jsx(O,{elevation:1,sx:{p:3,height:300,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(l,{variant:"body1",color:"text.secondary",children:"[Topic Visualization]"})})]}),e.jsxs(j,{item:!0,xs:12,children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"AI Assistance Summary"}),e.jsx(O,{elevation:1,sx:{p:3},children:e.jsxs(j,{container:!0,spacing:2,children:[e.jsx(j,{item:!0,xs:12,sm:4,children:e.jsxs(x,{sx:{textAlign:"center",p:2},children:[e.jsx(l,{variant:"h3",color:"info.main",children:f.aiAssistantUsage}),e.jsx(l,{variant:"body1",children:"AI Interactions"})]})}),e.jsx(j,{item:!0,xs:12,sm:4,children:e.jsxs(x,{sx:{textAlign:"center",p:2},children:[e.jsx(l,{variant:"h3",color:"info.main",children:Math.round(f.aiAssistantUsage*.7)}),e.jsx(l,{variant:"body1",children:"Questions Asked"})]})}),e.jsx(j,{item:!0,xs:12,sm:4,children:e.jsxs(x,{sx:{textAlign:"center",p:2},children:[e.jsx(l,{variant:"h3",color:"info.main",children:Math.round(f.aiAssistantUsage*.3)}),e.jsx(l,{variant:"body1",children:"Help Requests"})]})})]})})]})]})})]}),e.jsxs(x,{sx:{display:"flex",justifyContent:"center",mt:4},children:[e.jsx(A,{variant:"contained",component:U,to:"/reader",startIcon:e.jsx(Jr,{}),sx:{mr:2},children:"Return to Dashboard"}),e.jsx(A,{variant:"outlined",component:U,to:"/reader/alice-in-wonderland/page/1",startIcon:e.jsx(Qr,{}),children:"Continue Reading"})]})]})},mn=({fullHeight:n=!1,minHeight:t="200px",size:r=40,message:i,...s})=>e.jsxs(x,{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minHeight:n?"100vh":t,width:"100%",children:[e.jsx(ge,{size:r,...s}),i&&e.jsx(l,{variant:"body2",color:"text.secondary",sx:{mt:2},children:i})]});var tr={},Di;function $l(){if(Di)return tr;Di=1;var n=W();Object.defineProperty(tr,"__esModule",{value:!0}),tr.default=void 0;var t=n(Y()),r=H();return tr.default=(0,t.default)((0,r.jsx)("path",{d:"M10 20h4V4h-4zm-6 0h4v-8H4zM16 9v11h4V9z"}),"Equalizer"),tr}var zl=$l();const ql=G(zl);var rr={},Oi;function Ll(){if(Oi)return rr;Oi=1;var n=W();Object.defineProperty(rr,"__esModule",{value:!0}),rr.default=void 0;var t=n(Y()),r=H();return rr.default=(0,t.default)((0,r.jsx)("path",{d:"m22 10-6-6H4c-1.1 0-2 .9-2 2v12.01c0 1.1.9 1.99 2 1.99l16-.01c1.1 0 2-.89 2-1.99zm-7-4.5 5.5 5.5H15z"}),"Note"),rr}var Ml=Ll();const Bl=G(Ml);var nr={},$i;function Ul(){if($i)return nr;$i=1;var n=W();Object.defineProperty(nr,"__esModule",{value:!0}),nr.default=void 0;var t=n(Y()),r=H();return nr.default=(0,t.default)((0,r.jsx)("path",{d:"M21 6h-2v9H6v2c0 .55.45 1 1 1h11l4 4V7c0-.55-.45-1-1-1m-4 6V3c0-.55-.45-1-1-1H3c-.55 0-1 .45-1 1v14l4-4h10c.55 0 1-.45 1-1"}),"QuestionAnswer"),nr}var Vl=Ul();const Fl=G(Vl);class Nl{async getSection(t){const r=await z();console.log("Fetching section with ID:",t);const{data:i,error:s}=await r.from("sections").select(`
        id,
        title,
        content,
        chapter:chapter_id (
          id,
          title
        )
      `).eq("id",t).single();if(s)throw console.error("Error fetching section:",s),s;console.log("Raw section data received:",i);const a={id:i.id,title:i.title,content:i.content,chapter:i.chapter||{}};return console.log("Transformed section data:",a),a}async getSectionSnippetsForPage(t,r){const i=await z(),{data:s,error:a}=await i.rpc("get_section_snippets_for_page",{book_id_param:t,page_number_param:r});if(a)throw a;return s||[]}async requestHelp(t){const r=await z(),{error:i}=await r.from("help_requests").insert({section_id:t,status:"PENDING"});if(i)throw i}}const zi=new Nl,qi=()=>{Ze();const{bookId:n="alice-in-wonderland"}=rs(),{user:t,profile:r,loading:i}=ke(),{service:s,loading:a}=en(),{service:o,loading:d}=ra(),{enqueueSnackbar:h}=Sc(),u="550e8400-e29b-41d4-a716-446655440000",[f,m]=g.useState(""),[v,b]=g.useState(null),[p,y]=g.useState(!1),[_,w]=g.useState([]),[S,k]=g.useState(null),[I,E]=g.useState(null),[$,P]=g.useState("page_input"),[Q,V]=g.useState(null),[te,C]=g.useState(null),[B,D]=g.useState(!1),fe=g.useRef(null),de=g.useRef(null),[R,Ee]=g.useState(!1);g.useEffect(()=>{!i&&!a&&!d&&t&&s&&o&&Ee(!0)},[i,a,d,t,s,o]),g.useEffect(()=>{if(R&&de.current&&$==="page_input"){const L=setTimeout(()=>{var N;(N=de.current)==null||N.focus()},100);return()=>clearTimeout(L)}},[R,$]);const Ie=async()=>{const L=parseInt(f,10);if(isNaN(L)||L<=0){E("Please enter a valid page number.");return}y(!0),E(null),w([]),k(null),b(L),console.log(`Fetching sections for page: ${L}`);try{const N=await zi.getSectionSnippetsForPage(u,L);w(N||[]),N.length===0?E(`No sections found on page ${L}.`):P("section_selection")}catch(N){console.error("Error fetching sections:",N),E(`Failed to load sections for page ${L}. ${N.message||""}`),w([])}finally{y(!1)}},vt=async L=>{const N=_.find(oe=>oe.id===L);if(!N){console.error(`No snippet found with ID: ${L}`);return}console.log("Selected snippet:",N),y(!0),E(null),k(null),console.log(`Fetching full content for section: ${L}`);try{const oe=await zi.getSection(L);console.log("Received full section data:",oe);const Be={id:oe.id,number:N.number,preview:N.preview,content:oe.content};console.log("Setting selected section with content:",Be),k(Be),w([]),st(),P("content_interaction")}catch(oe){console.error("Error fetching section content:",oe),E(`Failed to load content for section ${N.number}. ${oe.message||""}`),k(null)}finally{y(!1)}},it=(L,N,oe,Be="first")=>{const We=/[\w''\-]/,Pe=/\s/;let F=N;for(;F>0&&We.test(L[F-1]);)F--;let J=oe;for(;J<L.length&&We.test(L[J]);)J++;const ve=L.substring(F,J);if(/\s/.test(ve)&&Be!=="all"){if(Be==="first"){let se=F;for(;se<J&&!Pe.test(L[se]);)se++;J=se}else if(Be==="last"){let se=J;for(;se>F&&!Pe.test(L[se-1]);)se--;for(;se>F&&Pe.test(L[se-1]);)se--;F=se}}return{expandedStart:F,expandedEnd:J}},Ke=L=>{if(!L)return"";let N=L.trim();return N=N.replace(/^[^\w]+|[^\w]+$/g,""),N.length===0&&L.length>0?(console.log("Word contained only punctuation:",L),""):N},tn=async()=>{try{const L=window.getSelection();if(!L||L.rangeCount===0||!S)return;const N=L.toString().trim();if(!N)return;if(N.length>50){console.log("Selection too long for definition lookup:",N.length,"characters");return}if(N.length<2){console.log("Selection too short for definition lookup:",N.length,"characters");return}console.log("Original highlight detected:",N);const oe=L.getRangeAt(0),Be=oe.startContainer!==oe.endContainer;let We,Pe;if(Be){Pe=oe.commonAncestorContainer,We=Pe.textContent||"",console.log("Multi-node selection detected, using selected text directly");const re=Ke(N);if(!re)return;D(!0),C(null);try{const De=await o.getDefinition(u,re);De?(C({word:re,definition:De.definition,examples:De.examples||[],source:De.source||"database"}),t&&o.logDictionaryLookup(t.id,u,S==null?void 0:S.id,re,!0).catch(rn=>console.error("Error logging dictionary lookup:",rn))):(C({word:re,definition:`No definition found for "${re}".`,examples:[],source:"not_found"}),t&&o.logDictionaryLookup(t.id,u,S==null?void 0:S.id,re,!1).catch(rn=>console.error("Error logging dictionary lookup:",rn)))}catch(De){console.error("Error fetching definition:",De),C({word:re,definition:`Error looking up "${re}".`,examples:[],source:"error"})}finally{D(!1)}return}if(Pe=oe.startContainer,Pe.nodeType!==Node.TEXT_NODE)return;We=Pe.textContent||"";const F=oe.startOffset,J=oe.endOffset,{expandedStart:ve,expandedEnd:at}=it(We,F,J,"first"),se=We.substring(ve,at);if(se!==N){console.log(`Selection expanded from "${N}" to "${se}"`);const re=se.length/N.length;re>5&&console.log(`Significant expansion detected (${re.toFixed(1)}x). Proceeding anyway.`)}const Te=Ke(se);if(!Te)return;console.log("Expanded to full word:",Te),D(!0),C(null);try{const re=await o.getDefinition(u,Te);re?(C({word:Te,definition:re.definition,examples:re.examples||[],source:re.source||"database"}),t&&o.logDictionaryLookup(t.id,u,S==null?void 0:S.id,Te,!0).catch(De=>console.error("Error logging dictionary lookup:",De))):(C({word:Te,definition:`No definition found for "${Te}".`,examples:[],source:"not_found"}),t&&o.logDictionaryLookup(t.id,u,S==null?void 0:S.id,Te,!1).catch(De=>console.error("Error logging dictionary lookup:",De)))}catch(re){console.error("Error fetching definition:",re),C({word:Te,definition:`Error looking up "${Te}".`,examples:[],source:"error"})}finally{D(!1)}}catch(L){console.error("Error in text selection handling:",L)}},st=()=>{V(null),C(null),D(!1)},Ae=()=>{console.log("AI Assistant Clicked - Section Context:",S),h("AI Assistant feature coming soon!",{variant:"info"})};return g.useEffect(()=>{const L=N=>{N.key==="Escape"&&st()};return document.addEventListener("keydown",L),()=>document.removeEventListener("keydown",L)},[]),R?e.jsxs(x,{sx:{display:"flex",height:"calc(100vh - 64px)"},children:[" ",e.jsxs(x,{sx:{flexGrow:1,p:3,overflowY:"auto"},children:[e.jsxs(x,{sx:{display:"flex",flexDirection:"column",mb:3},children:[e.jsxs(l,{variant:"h4",color:"primary",sx:{fontWeight:"bold"},children:["Hi ",(r==null?void 0:r.first_name)||"Reader",","]}),e.jsx(l,{variant:"subtitle1",color:"text.secondary",children:"Let me help you with your Alice in Wonderland book"})]}),e.jsxs(O,{elevation:$==="page_input"?3:1,sx:{p:3,mb:3,display:"flex",flexDirection:"column",borderLeft:$==="page_input"?"4px solid":"none",borderColor:"primary.main",transition:"all 0.3s ease"},children:[e.jsx(l,{variant:"h6",color:"primary",gutterBottom:!0,children:"Step 1: Tell me what page you're reading"}),e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2,mt:1},children:[e.jsx(l,{sx:{whiteSpace:"nowrap"},children:"What page are you on?"}),e.jsx(he,{inputRef:de,type:"number",size:"small",variant:"outlined",value:f,onChange:L=>m(L.target.value),sx:{maxWidth:"150px"},onKeyDown:L=>L.key==="Enter"&&Ie(),placeholder:"Enter page #"}),e.jsx(A,{variant:"contained",onClick:Ie,disabled:p,sx:{minWidth:"120px"},children:p?"Loading...":"Find Sections"})]}),$==="page_input"&&e.jsx(l,{variant:"body2",color:"text.secondary",sx:{mt:2},children:"Enter the page number from your physical book to find the corresponding sections."})]}),e.jsxs(x,{sx:{minHeight:"300px"},children:[p&&e.jsx(mn,{message:"Loading sections..."}),I&&e.jsx(mn,{message:I}),!p&&!I&&_.length>0&&!S&&e.jsxs(O,{elevation:$==="section_selection"?3:1,sx:{p:3,borderLeft:$==="section_selection"?"4px solid":"none",borderColor:"primary.main",transition:"all 0.3s ease"},children:[e.jsx(l,{variant:"h6",color:"primary",gutterBottom:!0,children:"Step 2: Select the section you're reading"}),e.jsxs(l,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["I found ",_.length," section",_.length!==1?"s":""," on page ",v,". Click on the section that matches what you're currently reading in your book."]}),e.jsx(we,{children:_.map(L=>e.jsx(me,{onClick:()=>vt(L.id),sx:{cursor:"pointer",border:"1px solid",borderColor:"divider",borderRadius:1,mb:1,"&:hover":{backgroundColor:"action.hover",borderColor:"primary.light"}},children:e.jsx(xe,{primary:`Section ${L.number}`,secondary:L.preview,primaryTypographyProps:{fontWeight:"bold"}})},L.id))})]}),!p&&!I&&S&&e.jsxs(O,{elevation:$==="content_interaction"?3:1,sx:{p:3,mt:2,borderLeft:$==="content_interaction"?"4px solid":"none",borderColor:"primary.main",transition:"all 0.3s ease"},ref:fe,onMouseUp:tn,children:[e.jsx(l,{variant:"h6",color:"primary",gutterBottom:!0,children:"Step 3: Interact with the text"}),e.jsx(x,{sx:{display:"flex",alignItems:"center",mb:2,p:2,backgroundColor:"info.light",borderRadius:1,color:"info.contrastText"},children:e.jsxs(l,{variant:"body2",children:[e.jsx("strong",{children:"Tip:"})," Highlight any word or phrase you'd like to understand better. I'll show you definitions in the sidebar."]})}),e.jsx(x,{sx:{p:2,border:"1px solid",borderColor:"divider",borderRadius:1,backgroundColor:"background.paper",position:"relative"},children:e.jsx(l,{variant:"body1",sx:{whiteSpace:"pre-wrap"},children:S.content})})]})]})]}),e.jsxs(O,{elevation:3,sx:{width:"250px",borderLeft:"1px solid",borderColor:"divider",p:2,display:"flex",flexDirection:"column",overflowY:"auto"},children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Companion"}),e.jsxs(x,{mb:2,children:[e.jsx(l,{variant:"overline",children:"Location"}),e.jsxs(l,{variant:"body2",children:[v?`Page ${v}`:"Sync Page Above",S?`, Section ${S.number}`:""]})]}),e.jsx(ie,{sx:{mb:2}}),e.jsxs(x,{mb:2,flexGrow:1,children:[" ",e.jsx(l,{variant:"overline",children:"Definition"}),B&&e.jsx(ge,{size:20}),te&&e.jsxs(x,{children:[e.jsx($e,{size:"small",onClick:st,sx:{float:"right"},children:e.jsx(Kr,{fontSize:"small"})}),e.jsx(l,{variant:"body1",fontWeight:"bold",children:te.word}),e.jsx(l,{variant:"body2",sx:{mt:1},children:te.definition}),e.jsxs(l,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:1},children:["Source: ",te.source]})]}),!B&&!te&&e.jsx(l,{variant:"caption",color:"text.secondary",children:"Highlight text in the section content area to look up definitions."})]}),e.jsx(ie,{sx:{mb:2}}),e.jsxs(x,{children:[e.jsx(l,{variant:"overline",children:"AI Assistant"}),e.jsx(A,{size:"small",variant:"contained",color:"primary",startIcon:e.jsx(Fl,{}),sx:{mt:1,width:"100%",display:"flex",justifyContent:"flex-start",textTransform:"none",boxShadow:2,"&:hover":{boxShadow:3}},disabled:!S,onClick:Ae,children:"Ask AI about this section"}),!S&&e.jsx(l,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:1},children:"Select a section to enable AI assistance."})]}),e.jsx(ie,{sx:{my:2}}),e.jsxs(x,{children:[e.jsx(l,{variant:"overline",children:"Notes"}),e.jsx(A,{size:"small",variant:"outlined",sx:{mt:1},disabled:!S,children:"Add Note"})]}),e.jsx(ie,{sx:{my:2}}),e.jsxs(x,{children:[e.jsx(l,{variant:"overline",children:"My Reading"}),e.jsxs(we,{dense:!0,sx:{mt:1},children:[e.jsxs(me,{button:!0,component:U,to:"/reader/statistics",sx:{borderRadius:1,"&:hover":{bgcolor:"action.hover"}},children:[e.jsx(gt,{sx:{minWidth:"30px"},children:e.jsx(ql,{fontSize:"small",color:"primary"})}),e.jsx(xe,{primary:"My Progress & Stats",primaryTypographyProps:{variant:"body2"}})]}),e.jsxs(me,{button:!0,onClick:()=>alert("Notes feature coming soon!"),sx:{borderRadius:1,"&:hover":{bgcolor:"action.hover"}},children:[e.jsx(gt,{sx:{minWidth:"30px"},children:e.jsx(Bl,{fontSize:"small",color:"primary"})}),e.jsx(xe,{primary:"My Notes",primaryTypographyProps:{variant:"body2"}})]})]})]}),e.jsx(ie,{sx:{my:2}}),e.jsxs(x,{children:[e.jsx(l,{variant:"overline",children:"Help & Tutorials"}),e.jsxs(we,{dense:!0,sx:{mt:1},children:[e.jsxs(me,{button:!0,component:U,to:"/reader",sx:{borderRadius:1,"&:hover":{bgcolor:"action.hover"}},children:[e.jsx(gt,{sx:{minWidth:"30px"},children:e.jsx(Qr,{fontSize:"small",color:"primary"})}),e.jsx(xe,{primary:"Welcome Page",primaryTypographyProps:{variant:"body2"}})]}),e.jsxs(me,{button:!0,onClick:()=>alert("Tutorials coming soon!"),sx:{borderRadius:1,"&:hover":{bgcolor:"action.hover"}},children:[e.jsx(gt,{sx:{minWidth:"30px"},children:e.jsx(_r,{fontSize:"small",color:"primary"})}),e.jsx(xe,{primary:"Tutorials",primaryTypographyProps:{variant:"body2"}})]})]})]})]})]}):e.jsx(x,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:e.jsx(mn,{message:"Initializing Companion..."})})};var ir={},Li;function Wl(){if(Li)return ir;Li=1;var n=W();Object.defineProperty(ir,"__esModule",{value:!0}),ir.default=void 0;var t=n(Y()),r=H();return ir.default=(0,t.default)((0,r.jsx)("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3m-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3m0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5m8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5"}),"People"),ir}var Hl=Wl();const sa=G(Hl);var sr={},Mi;function Gl(){if(Mi)return sr;Mi=1;var n=W();Object.defineProperty(sr,"__esModule",{value:!0}),sr.default=void 0;var t=n(Y()),r=H();return sr.default=(0,t.default)((0,r.jsx)("path",{d:"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-7 12h-2v-2h2zm0-4h-2V6h2z"}),"Feedback"),sr}var Yl=Gl();const Ql=G(Yl);var ar={},Bi;function Zl(){if(Bi)return ar;Bi=1;var n=W();Object.defineProperty(ar,"__esModule",{value:!0}),ar.default=void 0;var t=n(Y()),r=H();return ar.default=(0,t.default)((0,r.jsx)("path",{d:"M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2m6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1z"}),"Notifications"),ar}var Jl=Zl();const Ui=G(Jl);function xn(n){const{children:t,value:r,index:i,...s}=n;return e.jsx("div",{role:"tabpanel",hidden:r!==i,id:`dashboard-tabpanel-${i}`,"aria-labelledby":`dashboard-tab-${i}`,...s,children:r===i&&e.jsx(x,{sx:{p:3},children:t})})}const Kl=()=>{const{user:n,profile:t}=ke(),{service:r,loading:i}=qn(),{service:s}=Re(),[a,o]=g.useState(!0),[d,h]=g.useState(null),[u,f]=g.useState(null),[m,v]=g.useState(0);ze({trackPageLoad:!0,trackRender:!0,componentName:"ConsultantDashboard"}),g.useEffect(()=>{if(!r||!n)return;(async()=>{o(!0),h(null);try{const y=performance.now(),_=await r.getDashboardData(n.id);f({assignedReaders:[{id:"r1",name:"Leo Johnson",progress:35,lastActive:"2 hours ago",status:"active"},{id:"r2",name:"Sarah Williams",progress:68,lastActive:"1 day ago",status:"inactive"},{id:"r3",name:"Michael Brown",progress:12,lastActive:"3 hours ago",status:"active"}],helpRequests:[{id:"h1",reader:"Leo Johnson",question:"I don't understand why the Queen wants to cut off heads?",status:"pending",time:"30 minutes ago"},{id:"h2",reader:"Michael Brown",question:'What does "curiouser and curiouser" mean?',status:"pending",time:"2 hours ago"}],feedback:[{id:"f1",reader:"Sarah Williams",type:"Aha! Moment",content:"I finally understand the symbolism of the rabbit hole!",rating:5,time:"1 day ago"},{id:"f2",reader:"Leo Johnson",type:"Positive Experience",content:"The AI assistant helped me understand the Mad Hatter's character.",rating:4,time:"3 days ago"}],stats:{totalReaders:3,activeReaders:2,pendingHelpRequests:2,resolvedHelpRequests:5,feedbackCount:8,promptsSent:12},..._}),s&&s.trackPageView("consultant_dashboard",{userId:n.id})}catch(y){console.error("Error loading dashboard data:",y),h("Failed to load dashboard data. Please try again."),s&&s.trackEvent("consultant_dashboard_error",{error:String(y)})}finally{o(!1)}})()},[r,n,s]);const b=(p,y)=>{v(y),s&&s.trackEvent("consultant_tab_change",{tabIndex:y})};return a||i?e.jsx(x,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:e.jsx(ge,{})}):d?e.jsxs(x,{sx:{p:3,textAlign:"center"},children:[e.jsx(l,{color:"error",variant:"h6",gutterBottom:!0,children:d}),e.jsx(A,{variant:"contained",onClick:()=>window.location.reload(),sx:{mt:2},children:"Retry"})]}):t!=null&&t.is_consultant?e.jsxs(x,{sx:{p:3,maxWidth:"1200px",mx:"auto"},children:[e.jsxs(x,{sx:{mb:4,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(x,{children:[e.jsx(l,{variant:"h4",gutterBottom:!0,children:"Consultant Dashboard"}),e.jsx(l,{variant:"body1",color:"text.secondary",children:"Monitor and assist your assigned readers"})]}),e.jsxs(x,{children:[e.jsx($e,{color:"primary",sx:{mr:2},children:e.jsx(xa,{badgeContent:u.helpRequests.length,color:"error",children:e.jsx(Ui,{})})}),e.jsx(A,{variant:"contained",component:U,to:"/consultant/help-requests",startIcon:e.jsx(_r,{}),children:"Help Requests"})]})]}),e.jsx(j,{container:!0,spacing:3,sx:{mb:4},children:[{title:"Assigned Readers",value:u.stats.totalReaders,secondary:`${u.stats.activeReaders} active`,icon:e.jsx(sa,{sx:{fontSize:40}}),color:"primary.main",link:"/consultant/readers"},{title:"Help Requests",value:u.stats.pendingHelpRequests,secondary:`${u.stats.resolvedHelpRequests} resolved`,icon:e.jsx(_r,{sx:{fontSize:40}}),color:"error.main",link:"/consultant/help-requests"},{title:"Reader Feedback",value:u.stats.feedbackCount,secondary:"Last 7 days",icon:e.jsx(Ql,{sx:{fontSize:40}}),color:"success.main",link:"/consultant/feedback"},{title:"Prompts Sent",value:u.stats.promptsSent,secondary:"Last 7 days",icon:e.jsx(Ui,{sx:{fontSize:40}}),color:"info.main",link:"/consultant/prompts"}].map((p,y)=>e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(O,{elevation:2,sx:{p:3,height:"100%",display:"flex",flexDirection:"column",borderRadius:2},children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(ft,{sx:{bgcolor:p.color,mr:2},children:p.icon}),e.jsx(l,{variant:"h6",children:p.title})]}),e.jsx(l,{variant:"h3",sx:{mb:1},children:p.value}),e.jsx(l,{variant:"body2",color:"text.secondary",sx:{mb:2},children:p.secondary}),e.jsx(x,{sx:{mt:"auto"},children:e.jsx(A,{component:U,to:p.link,size:"small",children:"View Details"})})]})},y))}),e.jsxs(O,{sx:{mb:4,borderRadius:2},children:[e.jsxs(kr,{value:m,onChange:b,indicatorColor:"primary",textColor:"primary",variant:"fullWidth",children:[e.jsx(Se,{label:"Assigned Readers"}),e.jsx(Se,{label:"Help Requests"}),e.jsx(Se,{label:"Recent Feedback"})]}),e.jsxs(xn,{value:m,index:0,children:[e.jsx(we,{children:u.assignedReaders.map(p=>e.jsxs(me,{sx:{mb:2,p:2,bgcolor:"background.paper",borderRadius:2,boxShadow:1},children:[e.jsx(Wr,{children:e.jsx(ft,{children:e.jsx(Sr,{})})}),e.jsx(xe,{primary:e.jsxs(x,{sx:{display:"flex",alignItems:"center"},children:[p.name,e.jsx(_e,{label:p.status==="active"?"Active":"Inactive",color:p.status==="active"?"success":"default",size:"small",sx:{ml:2}})]}),secondary:e.jsx(e.Fragment,{children:e.jsxs(l,{component:"span",variant:"body2",children:["Progress: ",p.progress,"% • Last active: ",p.lastActive]})})}),e.jsx(A,{variant:"outlined",size:"small",component:U,to:`/consultant/readers/${p.id}`,children:"View Profile"})]},p.id))}),e.jsx(x,{sx:{textAlign:"center",mt:2},children:e.jsx(A,{variant:"contained",component:U,to:"/consultant/readers",children:"View All Readers"})})]}),e.jsxs(xn,{value:m,index:1,children:[e.jsx(we,{children:u.helpRequests.map(p=>e.jsx(me,{sx:{mb:2,p:2,bgcolor:"background.paper",borderRadius:2,boxShadow:1},children:e.jsx(xe,{primary:e.jsxs(x,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(l,{variant:"subtitle1",children:p.reader}),e.jsx(_e,{label:p.status,color:p.status==="pending"?"error":"success",size:"small",sx:{ml:2}}),e.jsx(l,{variant:"body2",color:"text.secondary",sx:{ml:"auto"},children:p.time})]}),secondary:e.jsxs(l,{variant:"body1",sx:{mt:1},children:['"',p.question,'"']})})},p.id))}),e.jsx(x,{sx:{textAlign:"center",mt:2},children:e.jsx(A,{variant:"contained",component:U,to:"/consultant/help-requests",color:"error",children:"Respond to Help Requests"})})]}),e.jsxs(xn,{value:m,index:2,children:[e.jsx(we,{children:u.feedback.map(p=>e.jsx(me,{sx:{mb:2,p:2,bgcolor:"background.paper",borderRadius:2,boxShadow:1},children:e.jsx(xe,{primary:e.jsxs(x,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(l,{variant:"subtitle1",children:p.reader}),e.jsx(_e,{label:p.type,color:"primary",size:"small",sx:{ml:2}}),e.jsx(x,{sx:{ml:2},children:Array(p.rating).fill(0).map((y,_)=>e.jsx("span",{role:"img","aria-label":"star",children:"⭐"},_))}),e.jsx(l,{variant:"body2",color:"text.secondary",sx:{ml:"auto"},children:p.time})]}),secondary:e.jsxs(l,{variant:"body1",sx:{mt:1},children:['"',p.content,'"']})})},p.id))}),e.jsx(x,{sx:{textAlign:"center",mt:2},children:e.jsx(A,{variant:"contained",component:U,to:"/consultant/feedback",color:"primary",children:"View All Feedback"})})]})]}),e.jsxs(O,{sx:{p:3,borderRadius:2},children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Quick Actions"}),e.jsx(ie,{sx:{mb:2}}),e.jsxs(j,{container:!0,spacing:2,children:[e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsx(A,{variant:"outlined",fullWidth:!0,component:U,to:"/consultant/send-prompt",sx:{py:1.5},children:"Send Subtle Prompt"})}),e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsx(A,{variant:"outlined",fullWidth:!0,component:U,to:"/consultant/reading-insights",sx:{py:1.5},children:"Generate Insights"})}),e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsx(A,{variant:"outlined",fullWidth:!0,component:U,to:"/consultant/assign-readers",sx:{py:1.5},children:"Assign Readers"})}),e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsx(A,{variant:"outlined",fullWidth:!0,component:U,to:"/consultant/reports",sx:{py:1.5},children:"Generate Reports"})})]})]})]}):e.jsxs(x,{sx:{p:3,textAlign:"center"},children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"You don't have consultant access."}),e.jsx(A,{variant:"contained",component:U,to:"/reader",sx:{mt:2},children:"Go to Reader Dashboard"})]})};var or={},Vi;function Xl(){if(Vi)return or;Vi=1;var n=W();Object.defineProperty(or,"__esModule",{value:!0}),or.default=void 0;var t=n(Y()),r=H();return or.default=(0,t.default)((0,r.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search"),or}var ed=Xl();const td=G(ed);var cr={},Fi;function rd(){if(Fi)return cr;Fi=1;var n=W();Object.defineProperty(cr,"__esModule",{value:!0}),cr.default=void 0;var t=n(Y()),r=H();return cr.default=(0,t.default)((0,r.jsx)("path",{d:"M10 18h4v-2h-4zM3 6v2h18V6zm3 7h12v-2H6z"}),"FilterList"),cr}var nd=rd();const id=G(nd);var lr={},Ni;function sd(){if(Ni)return lr;Ni=1;var n=W();Object.defineProperty(lr,"__esModule",{value:!0}),lr.default=void 0;var t=n(Y()),r=H();return lr.default=(0,t.default)((0,r.jsx)("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"Visibility"),lr}var ad=sd();const od=G(ad);var dr={},Wi;function cd(){if(Wi)return dr;Wi=1;var n=W();Object.defineProperty(dr,"__esModule",{value:!0}),dr.default=void 0;var t=n(Y()),r=H();return dr.default=(0,t.default)((0,r.jsx)("path",{d:"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-2 12H6v-2h12zm0-3H6V9h12zm0-3H6V6h12z"}),"Message"),dr}var ld=cd();const dd=G(ld),ud=()=>{const{user:n}=ke(),{service:t,loading:r}=qn(),{service:i}=Re(),[s,a]=g.useState(!0),[o,d]=g.useState(null),[h,u]=g.useState([]),[f,m]=g.useState([]),[v,b]=g.useState(0),[p,y]=g.useState(10),[_,w]=g.useState(""),[S,k]=g.useState("all"),[I,E]=g.useState("all");ze({trackPageLoad:!0,trackRender:!0,componentName:"ReadersList"}),g.useEffect(()=>{if(!t||!n)return;(async()=>{a(!0),d(null);try{const B=performance.now(),D=await t.getAssignedReaders(n.id),fe=[{id:"r1",name:"Leo Johnson",email:"leo.j@example.com",progress:35,lastActive:"2 hours ago",status:"active",helpRequests:1,book:"Alice in Wonderland",joinDate:"2023-05-15"},{id:"r2",name:"Sarah Williams",email:"sarah.w@example.com",progress:68,lastActive:"1 day ago",status:"inactive",helpRequests:0,book:"Alice in Wonderland",joinDate:"2023-04-22"},{id:"r3",name:"Michael Brown",email:"michael.b@example.com",progress:12,lastActive:"3 hours ago",status:"active",helpRequests:1,book:"Alice in Wonderland",joinDate:"2023-06-01"},{id:"r4",name:"Emma Davis",email:"emma.d@example.com",progress:89,lastActive:"5 hours ago",status:"active",helpRequests:0,book:"Alice in Wonderland",joinDate:"2023-03-10"},{id:"r5",name:"James Wilson",email:"james.w@example.com",progress:45,lastActive:"2 days ago",status:"inactive",helpRequests:0,book:"Alice in Wonderland",joinDate:"2023-05-05"},{id:"r6",name:"Olivia Martinez",email:"olivia.m@example.com",progress:22,lastActive:"1 hour ago",status:"active",helpRequests:0,book:"Alice in Wonderland",joinDate:"2023-06-10"},{id:"r7",name:"William Taylor",email:"william.t@example.com",progress:75,lastActive:"4 hours ago",status:"active",helpRequests:0,book:"Alice in Wonderland",joinDate:"2023-04-15"},{id:"r8",name:"Sophia Anderson",email:"sophia.a@example.com",progress:5,lastActive:"3 days ago",status:"inactive",helpRequests:0,book:"Alice in Wonderland",joinDate:"2023-06-05"},{id:"r9",name:"Benjamin Thomas",email:"benjamin.t@example.com",progress:50,lastActive:"6 hours ago",status:"active",helpRequests:0,book:"Alice in Wonderland",joinDate:"2023-05-20"},{id:"r10",name:"Isabella Jackson",email:"isabella.j@example.com",progress:95,lastActive:"30 minutes ago",status:"active",helpRequests:0,book:"Alice in Wonderland",joinDate:"2023-03-25"},{id:"r11",name:"Mason White",email:"mason.w@example.com",progress:60,lastActive:"1 day ago",status:"inactive",helpRequests:0,book:"Alice in Wonderland",joinDate:"2023-04-30"},{id:"r12",name:"Charlotte Harris",email:"charlotte.h@example.com",progress:40,lastActive:"5 hours ago",status:"active",helpRequests:0,book:"Alice in Wonderland",joinDate:"2023-05-25"}];u((D==null?void 0:D.readers)||fe),m((D==null?void 0:D.readers)||fe),i&&i.trackPageView("readers_list",{userId:n.id})}catch(B){console.error("Error loading readers:",B),d("Failed to load readers. Please try again."),i&&i.trackEvent("readers_list_error",{error:String(B)})}finally{a(!1)}})()},[t,n,i]),g.useEffect(()=>{if(!h.length)return;let C=[...h];if(_){const B=_.toLowerCase();C=C.filter(D=>D.name.toLowerCase().includes(B)||D.email.toLowerCase().includes(B))}if(S!=="all"&&(C=C.filter(B=>B.status===S)),I!=="all")switch(I){case"beginner":C=C.filter(B=>B.progress<25);break;case"intermediate":C=C.filter(B=>B.progress>=25&&B.progress<75);break;case"advanced":C=C.filter(B=>B.progress>=75);break}m(C),b(0)},[h,_,S,I]);const $=(C,B)=>{b(B)},P=C=>{y(parseInt(C.target.value,10)),b(0)},Q=C=>{k(C.target.value),i&&i.trackEvent("reader_filter_change",{filterType:"status",value:C.target.value})},V=C=>{E(C.target.value),i&&i.trackEvent("reader_filter_change",{filterType:"progress",value:C.target.value})},te=C=>{w(C.target.value),i&&C.target.value&&i.trackEvent("reader_search",{query:C.target.value})};return s||r?e.jsx(x,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:e.jsx(ge,{})}):o?e.jsxs(x,{sx:{p:3,textAlign:"center"},children:[e.jsx(l,{color:"error",variant:"h6",gutterBottom:!0,children:o}),e.jsx(A,{variant:"contained",onClick:()=>window.location.reload(),sx:{mt:2},children:"Retry"})]}):e.jsxs(x,{sx:{p:3,maxWidth:"1200px",mx:"auto"},children:[e.jsxs(x,{sx:{mb:4,display:"flex",alignItems:"center"},children:[e.jsx(A,{component:U,to:"/consultant",startIcon:e.jsx(Zr,{}),sx:{mr:2},children:"Dashboard"}),e.jsx(l,{variant:"h4",children:"Assigned Readers"})]}),e.jsx(O,{sx:{p:3,mb:4,borderRadius:2},children:e.jsxs(j,{container:!0,spacing:3,alignItems:"center",children:[e.jsx(j,{item:!0,xs:12,md:4,children:e.jsx(he,{fullWidth:!0,placeholder:"Search by name or email",value:_,onChange:te,InputProps:{startAdornment:e.jsx(va,{position:"start",children:e.jsx(td,{})})}})}),e.jsx(j,{item:!0,xs:12,md:3,children:e.jsxs(jn,{fullWidth:!0,children:[e.jsx(_n,{id:"status-filter-label",children:"Status"}),e.jsxs(wn,{labelId:"status-filter-label",id:"status-filter",value:S,label:"Status",onChange:Q,children:[e.jsx(Ce,{value:"all",children:"All Statuses"}),e.jsx(Ce,{value:"active",children:"Active"}),e.jsx(Ce,{value:"inactive",children:"Inactive"})]})]})}),e.jsx(j,{item:!0,xs:12,md:3,children:e.jsxs(jn,{fullWidth:!0,children:[e.jsx(_n,{id:"progress-filter-label",children:"Progress"}),e.jsxs(wn,{labelId:"progress-filter-label",id:"progress-filter",value:I,label:"Progress",onChange:V,children:[e.jsx(Ce,{value:"all",children:"All Progress"}),e.jsx(Ce,{value:"beginner",children:"Beginner (0-25%)"}),e.jsx(Ce,{value:"intermediate",children:"Intermediate (25-75%)"}),e.jsx(Ce,{value:"advanced",children:"Advanced (75-100%)"})]})]})}),e.jsx(j,{item:!0,xs:12,md:2,children:e.jsx(x,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(A,{variant:"outlined",startIcon:e.jsx(id,{}),onClick:()=>{w(""),k("all"),E("all")},children:"Reset"})})})]})}),e.jsxs(O,{sx:{width:"100%",mb:4,borderRadius:2,overflow:"hidden"},children:[e.jsx(Ki,{children:e.jsxs(Xi,{sx:{minWidth:650},children:[e.jsx(es,{children:e.jsxs(vr,{sx:{bgcolor:"primary.light"},children:[e.jsx(ae,{children:"Reader"}),e.jsx(ae,{children:"Status"}),e.jsx(ae,{children:"Progress"}),e.jsx(ae,{children:"Last Active"}),e.jsx(ae,{children:"Help Requests"}),e.jsx(ae,{align:"right",children:"Actions"})]})}),e.jsxs(ts,{children:[f.slice(v*p,v*p+p).map(C=>e.jsxs(vr,{hover:!0,children:[e.jsx(ae,{children:e.jsxs(x,{children:[e.jsx(l,{variant:"subtitle2",children:C.name}),e.jsx(l,{variant:"body2",color:"text.secondary",children:C.email})]})}),e.jsx(ae,{children:e.jsx(_e,{label:C.status==="active"?"Active":"Inactive",color:C.status==="active"?"success":"default",size:"small"})}),e.jsx(ae,{children:e.jsxs(x,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(x,{sx:{width:"100%",mr:1},children:e.jsx(kn,{variant:"determinate",value:C.progress,sx:{height:8,borderRadius:5}})}),e.jsx(x,{sx:{minWidth:35},children:e.jsx(l,{variant:"body2",color:"text.secondary",children:`${Math.round(C.progress)}%`})})]})}),e.jsx(ae,{children:C.lastActive}),e.jsx(ae,{children:C.helpRequests>0?e.jsx(_e,{label:C.helpRequests,color:"error",size:"small"}):e.jsx(l,{variant:"body2",children:"None"})}),e.jsxs(ae,{align:"right",children:[e.jsx(sn,{title:"View Profile",children:e.jsx($e,{component:U,to:`/consultant/readers/${C.id}`,color:"primary",children:e.jsx(od,{})})}),e.jsx(sn,{title:"Send Message",children:e.jsx($e,{component:U,to:`/consultant/message/${C.id}`,color:"secondary",children:e.jsx(dd,{})})}),C.helpRequests>0&&e.jsx(sn,{title:"View Help Requests",children:e.jsx($e,{component:U,to:`/consultant/help-requests?reader=${C.id}`,color:"error",children:e.jsx(_r,{})})})]})]},C.id)),f.length===0&&e.jsx(vr,{children:e.jsx(ae,{colSpan:6,align:"center",sx:{py:3},children:e.jsx(l,{variant:"body1",children:"No readers found matching your filters"})})})]})]})}),e.jsx(ya,{rowsPerPageOptions:[5,10,25],component:"div",count:f.length,rowsPerPage:p,page:v,onPageChange:$,onRowsPerPageChange:P})]}),e.jsxs(O,{sx:{p:3,borderRadius:2},children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Summary"}),e.jsxs(j,{container:!0,spacing:3,children:[e.jsxs(j,{item:!0,xs:12,sm:4,children:[e.jsx(l,{variant:"body2",color:"text.secondary",children:"Total Readers:"}),e.jsx(l,{variant:"h5",children:h.length})]}),e.jsxs(j,{item:!0,xs:12,sm:4,children:[e.jsx(l,{variant:"body2",color:"text.secondary",children:"Active Readers:"}),e.jsx(l,{variant:"h5",children:h.filter(C=>C.status==="active").length})]}),e.jsxs(j,{item:!0,xs:12,sm:4,children:[e.jsx(l,{variant:"body2",color:"text.secondary",children:"Pending Help Requests:"}),e.jsx(l,{variant:"h5",children:h.reduce((C,B)=>C+B.helpRequests,0)})]})]})]})]})};var ur={},Hi;function hd(){if(Hi)return ur;Hi=1;var n=W();Object.defineProperty(ur,"__esModule",{value:!0}),ur.default=void 0;var t=n(Y()),r=H();return ur.default=(0,t.default)((0,r.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send"),ur}var gd=hd();const fd=G(gd);function vn(n){const{children:t,value:r,index:i,...s}=n;return e.jsx("div",{role:"tabpanel",hidden:r!==i,id:`help-tabpanel-${i}`,"aria-labelledby":`help-tab-${i}`,...s,children:r===i&&e.jsx(x,{sx:{p:3},children:t})})}function pd(){return new URLSearchParams(mt().search)}const md=()=>{const{user:n}=ke(),{service:t,loading:r}=qn(),{service:i}=Re(),a=pd().get("reader"),[o,d]=g.useState(!0),[h,u]=g.useState(null),[f,m]=g.useState([]),[v,b]=g.useState(0),[p,y]=g.useState(null),[_,w]=g.useState(""),[S,k]=g.useState("text"),[I,E]=g.useState(!1),[$,P]=g.useState(!1);ze({trackPageLoad:!0,trackRender:!0,componentName:"HelpRequests"}),g.useEffect(()=>{if(!t||!n)return;(async()=>{d(!0),u(null);try{const Ee=performance.now(),Ie=await t.getHelpRequests(n.id),vt=[{id:"h1",reader:{id:"r1",name:"Leo Johnson",avatar:null},question:"I don't understand why the Queen wants to cut off heads?",context:"Chapter 8: The Queen's Croquet Ground",status:"pending",created_at:"2023-06-15T10:30:00Z",book_page:45,priority:"high"},{id:"h2",reader:{id:"r3",name:"Michael Brown",avatar:null},question:'What does "curiouser and curiouser" mean?',context:"Chapter 2: The Pool of Tears",status:"pending",created_at:"2023-06-15T08:15:00Z",book_page:12,priority:"medium"},{id:"h3",reader:{id:"r5",name:"James Wilson",avatar:null},question:"Why is the Cheshire Cat always smiling?",context:"Chapter 6: Pig and Pepper",status:"resolved",created_at:"2023-06-14T14:45:00Z",resolved_at:"2023-06-14T15:20:00Z",response:"The Cheshire Cat's smile is a symbol of enigmatic knowledge. In the story, it represents the mysterious and sometimes nonsensical nature of Wonderland. The cat appears and disappears at will, but its smile remains, suggesting that in Wonderland, nothing is quite as it seems.",book_page:32,priority:"medium"},{id:"h4",reader:{id:"r2",name:"Sarah Williams",avatar:null},question:'What is the significance of the "Drink Me" bottle?',context:"Chapter 1: Down the Rabbit Hole",status:"resolved",created_at:"2023-06-13T09:30:00Z",resolved_at:"2023-06-13T10:15:00Z",response:`The "Drink Me" bottle represents Alice's willingness to embrace the unknown. By drinking from it, she shows her curiosity and adaptability, key themes in the story. The resulting size change is also a metaphor for the confusing transitions of childhood to adulthood.`,book_page:5,priority:"low"},{id:"h5",reader:{id:"r1",name:"Leo Johnson",avatar:null},question:"Why is the Mad Hatter mad?",context:"Chapter 7: A Mad Tea-Party",status:"resolved",created_at:"2023-06-12T16:20:00Z",resolved_at:"2023-06-12T17:00:00Z",response:`The term "mad as a hatter" comes from the 19th century when hat makers often suffered from mercury poisoning due to the hat-making process, causing neurological damage. Carroll used this common phrase to create his eccentric character. In the story, the Hatter is "mad" because he's stuck in a perpetual tea time due to his quarrel with Time.`,book_page:38,priority:"medium"}];let it=vt;a&&(it=vt.filter(Ke=>Ke.reader.id===a),b(2)),m((Ie==null?void 0:Ie.helpRequests)||it),i&&i.trackPageView("help_requests",{userId:n.id,readerFilter:a||"none"})}catch(Ee){console.error("Error loading help requests:",Ee),u("Failed to load help requests. Please try again."),i&&i.trackEvent("help_requests_error",{error:String(Ee)})}finally{d(!1)}})()},[t,n,i,a]);const Q=(R,Ee)=>{b(Ee),i&&i.trackEvent("help_requests_tab_change",{tabIndex:Ee})},V=R=>{k(R.target.value)},te=R=>{y(R),w(""),k("text"),E(!0),i&&i.trackEvent("help_request_response_start",{requestId:R.id,readerId:R.reader.id})},C=()=>{E(!1),y(null)},B=async()=>{if(!(!p||!_.trim()||!t)){P(!0);try{const R=performance.now();await t.respondToHelpRequest(p.id,{response:_,responseType:S}),m(Ee=>Ee.map(Ie=>Ie.id===p.id?{...Ie,status:"resolved",response:_,resolved_at:new Date().toISOString()}:Ie)),i&&i.trackEvent("help_request_response_submit",{requestId:p.id,readerId:p.reader.id,responseType:S,timeToComplete:performance.now()-R}),C()}catch(R){console.error("Error submitting response:",R),i&&i.trackEvent("help_request_response_error",{requestId:p.id,error:String(R)})}finally{P(!1)}}},D=R=>new Date(R).toLocaleString(),fe=()=>v===0?f.filter(R=>R.status==="pending"):v===1?f.filter(R=>R.status==="resolved"):f;if(o||r)return e.jsx(x,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:e.jsx(ge,{})});if(h)return e.jsxs(x,{sx:{p:3,textAlign:"center"},children:[e.jsx(l,{color:"error",variant:"h6",gutterBottom:!0,children:h}),e.jsx(A,{variant:"contained",onClick:()=>window.location.reload(),sx:{mt:2},children:"Retry"})]});const de=fe();return e.jsxs(x,{sx:{p:3,maxWidth:"1200px",mx:"auto"},children:[e.jsxs(x,{sx:{mb:4,display:"flex",alignItems:"center"},children:[e.jsx(A,{component:U,to:"/consultant",startIcon:e.jsx(Zr,{}),sx:{mr:2},children:"Dashboard"}),e.jsxs(l,{variant:"h4",children:["Help Requests",a&&" (Filtered by Reader)"]})]}),e.jsxs(O,{sx:{mb:4,borderRadius:2,overflow:"hidden"},children:[e.jsxs(kr,{value:v,onChange:Q,indicatorColor:"primary",textColor:"primary",variant:"fullWidth",children:[e.jsx(Se,{label:e.jsxs(x,{sx:{display:"flex",alignItems:"center"},children:["Pending",e.jsx(_e,{label:f.filter(R=>R.status==="pending").length,color:"error",size:"small",sx:{ml:1}})]})}),e.jsx(Se,{label:"Resolved"}),e.jsx(Se,{label:"All Requests"})]}),e.jsx(vn,{value:v,index:0,children:de.length===0?e.jsx(x,{sx:{textAlign:"center",py:4},children:e.jsx(l,{variant:"h6",color:"text.secondary",children:"No pending help requests"})}):e.jsx(we,{children:de.map(R=>e.jsxs(me,{sx:{mb:2,p:3,bgcolor:"background.paper",borderRadius:2,boxShadow:1},children:[e.jsx(Wr,{children:e.jsx(ft,{children:e.jsx(Sr,{})})}),e.jsx(xe,{primary:e.jsxs(x,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(l,{variant:"subtitle1",children:R.reader.name}),e.jsx(_e,{label:R.priority,color:R.priority==="high"?"error":R.priority==="medium"?"warning":"info",size:"small",sx:{ml:2}}),e.jsx(l,{variant:"body2",color:"text.secondary",sx:{ml:"auto"},children:D(R.created_at)})]}),secondary:e.jsxs(e.Fragment,{children:[e.jsxs(l,{variant:"body1",sx:{mt:1,mb:1},children:['"',R.question,'"']}),e.jsxs(l,{variant:"body2",color:"text.secondary",children:["Context: ",R.context," (Page ",R.book_page,")"]})]})}),e.jsx(x,{sx:{ml:2},children:e.jsx(A,{variant:"contained",color:"primary",onClick:()=>te(R),children:"Respond"})})]},R.id))})}),e.jsx(vn,{value:v,index:1,children:de.length===0?e.jsx(x,{sx:{textAlign:"center",py:4},children:e.jsx(l,{variant:"h6",color:"text.secondary",children:"No resolved help requests"})}):e.jsx(we,{children:de.map(R=>e.jsxs(me,{sx:{mb:2,p:3,bgcolor:"background.paper",borderRadius:2,boxShadow:1},children:[e.jsx(Wr,{children:e.jsx(ft,{children:e.jsx(Sr,{})})}),e.jsx(xe,{primary:e.jsxs(x,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(l,{variant:"subtitle1",children:R.reader.name}),e.jsx(_e,{label:"Resolved",color:"success",size:"small",sx:{ml:2}}),e.jsxs(l,{variant:"body2",color:"text.secondary",sx:{ml:"auto"},children:["Resolved: ",D(R.resolved_at)]})]}),secondary:e.jsxs(e.Fragment,{children:[e.jsxs(l,{variant:"body1",sx:{mt:1,mb:1},children:['Question: "',R.question,'"']}),e.jsxs(l,{variant:"body2",color:"text.secondary",children:["Context: ",R.context," (Page ",R.book_page,")"]}),e.jsx(ie,{sx:{my:2}}),e.jsxs(l,{variant:"body1",children:['Response: "',R.response,'"']})]})})]},R.id))})}),e.jsx(vn,{value:v,index:2,children:de.length===0?e.jsx(x,{sx:{textAlign:"center",py:4},children:e.jsx(l,{variant:"h6",color:"text.secondary",children:"No help requests found"})}):e.jsx(we,{children:de.map(R=>e.jsxs(me,{sx:{mb:2,p:3,bgcolor:"background.paper",borderRadius:2,boxShadow:1},children:[e.jsx(Wr,{children:e.jsx(ft,{children:e.jsx(Sr,{})})}),e.jsx(xe,{primary:e.jsxs(x,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(l,{variant:"subtitle1",children:R.reader.name}),e.jsx(_e,{label:R.status==="pending"?"Pending":"Resolved",color:R.status==="pending"?"error":"success",size:"small",sx:{ml:2}}),e.jsx(l,{variant:"body2",color:"text.secondary",sx:{ml:"auto"},children:R.status==="pending"?`Requested: ${D(R.created_at)}`:`Resolved: ${D(R.resolved_at)}`})]}),secondary:e.jsxs(e.Fragment,{children:[e.jsxs(l,{variant:"body1",sx:{mt:1,mb:1},children:['Question: "',R.question,'"']}),e.jsxs(l,{variant:"body2",color:"text.secondary",children:["Context: ",R.context," (Page ",R.book_page,")"]}),R.status==="resolved"&&e.jsxs(e.Fragment,{children:[e.jsx(ie,{sx:{my:2}}),e.jsxs(l,{variant:"body1",children:['Response: "',R.response,'"']})]})]})}),R.status==="pending"&&e.jsx(x,{sx:{ml:2},children:e.jsx(A,{variant:"contained",color:"primary",onClick:()=>te(R),children:"Respond"})})]},R.id))})})]}),e.jsxs(O,{sx:{p:3,borderRadius:2},children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Summary"}),e.jsxs(j,{container:!0,spacing:3,children:[e.jsxs(j,{item:!0,xs:12,sm:4,children:[e.jsx(l,{variant:"body2",color:"text.secondary",children:"Total Requests:"}),e.jsx(l,{variant:"h5",children:f.length})]}),e.jsxs(j,{item:!0,xs:12,sm:4,children:[e.jsx(l,{variant:"body2",color:"text.secondary",children:"Pending Requests:"}),e.jsx(l,{variant:"h5",children:f.filter(R=>R.status==="pending").length})]}),e.jsxs(j,{item:!0,xs:12,sm:4,children:[e.jsx(l,{variant:"body2",color:"text.secondary",children:"Resolved Requests:"}),e.jsx(l,{variant:"h5",children:f.filter(R=>R.status==="resolved").length})]})]})]}),e.jsxs(ba,{open:I,onClose:C,fullWidth:!0,maxWidth:"md",children:[e.jsx(Sa,{children:e.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(l,{variant:"h6",children:"Respond to Help Request"}),e.jsx($e,{onClick:C,children:e.jsx(Kr,{})})]})}),e.jsx(ja,{dividers:!0,children:p&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{sx:{mb:3},children:[e.jsxs(l,{variant:"subtitle1",gutterBottom:!0,children:["Reader: ",p.reader.name]}),e.jsxs(l,{variant:"body1",gutterBottom:!0,children:['Question: "',p.question,'"']}),e.jsxs(l,{variant:"body2",color:"text.secondary",children:["Context: ",p.context," (Page ",p.book_page,")"]})]}),e.jsx(ie,{sx:{my:3}}),e.jsxs(jn,{fullWidth:!0,sx:{mb:3},children:[e.jsx(_n,{id:"response-type-label",children:"Response Type"}),e.jsxs(wn,{labelId:"response-type-label",id:"response-type",value:S,label:"Response Type",onChange:V,children:[e.jsx(Ce,{value:"text",children:"Direct Text Response"}),e.jsx(Ce,{value:"prompt",children:"Subtle AI Prompt"}),e.jsx(Ce,{value:"resource",children:"Resource Recommendation"})]})]}),e.jsx(he,{fullWidth:!0,multiline:!0,rows:6,label:"Your Response",value:_,onChange:R=>w(R.target.value),placeholder:S==="text"?"Provide a clear, helpful explanation...":S==="prompt"?"Write a subtle prompt for the AI assistant to deliver...":"Recommend resources or pages to review..."}),S==="prompt"&&e.jsx(l,{variant:"body2",color:"text.secondary",sx:{mt:2},children:"Note: This will be delivered as a subtle prompt through the AI assistant, not as a direct message from you."})]})}),e.jsxs(_a,{children:[e.jsx(A,{onClick:C,children:"Cancel"}),e.jsx(A,{variant:"contained",color:"primary",onClick:B,disabled:!_.trim()||$,startIcon:$?e.jsx(ge,{size:20}):e.jsx(fd,{}),children:$?"Sending...":"Send Response"})]})]})]})};var hr={},Gi;function xd(){if(Gi)return hr;Gi=1;var n=W();Object.defineProperty(hr,"__esModule",{value:!0}),hr.default=void 0;var t=n(Y()),r=H();return hr.default=(0,t.default)((0,r.jsx)("path",{d:"M2 20h20v-4H2zm2-3h2v2H4zM2 4v4h20V4zm4 3H4V5h2zm-4 7h20v-4H2zm2-3h2v2H4z"}),"Storage"),hr}var vd=xd();const yd=G(vd);var gr={},Yi;function bd(){if(Yi)return gr;Yi=1;var n=W();Object.defineProperty(gr,"__esModule",{value:!0}),gr.default=void 0;var t=n(Y()),r=H();return gr.default=(0,t.default)((0,r.jsx)("path",{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6"}),"Settings"),gr}var Sd=bd();const jd=G(Sd);function Vr(n){const{children:t,value:r,index:i,...s}=n;return e.jsx("div",{role:"tabpanel",hidden:r!==i,id:`admin-tabpanel-${i}`,"aria-labelledby":`admin-tab-${i}`,...s,children:r===i&&e.jsx(x,{sx:{p:3},children:t})})}const _d=()=>{const{user:n,profile:t}=ke(),{service:r}=Re(),{service:i,loading:s}=Mc(),[a,o]=g.useState(!0),[d,h]=g.useState(null),[u,f]=g.useState(null),[m,v]=g.useState(0);ze({trackPageLoad:!0,trackRender:!0,componentName:"AdminDashboard"}),g.useEffect(()=>{if(!i||!n)return;(async()=>{o(!0),h(null);try{const _=performance.now(),w=await i.getSystemStatus();f({services:[{name:"Authentication Service",status:"healthy",uptime:"99.9%",lastIssue:null},{name:"Book Service",status:"healthy",uptime:"99.7%",lastIssue:"2023-06-10T15:30:00Z"},{name:"Dictionary Service",status:"degraded",uptime:"98.5%",lastIssue:"2023-06-15T08:45:00Z"},{name:"AI Service",status:"healthy",uptime:"99.8%",lastIssue:"2023-06-12T11:20:00Z"},{name:"Feedback Service",status:"healthy",uptime:"99.9%",lastIssue:null},{name:"Trigger Service",status:"healthy",uptime:"99.9%",lastIssue:null},{name:"Statistics Service",status:"healthy",uptime:"99.9%",lastIssue:null},{name:"Consultant Service",status:"healthy",uptime:"99.8%",lastIssue:"2023-06-11T09:15:00Z"}],database:{status:"healthy",connectionPool:"12/20",avgQueryTime:"45ms",storage:{used:"2.3GB",total:"20GB",percentage:11.5}},users:{total:125,active:78,consultants:5,admins:2},activity:{registrations:[5,8,12,7,10,15,9],logins:[25,30,28,35,40,38,42],aiQueries:[120,145,135,160,180,175,190],helpRequests:[8,12,10,15,18,14,16]},alerts:[{id:"a1",type:"warning",message:"Dictionary Service experiencing increased latency",timestamp:"2023-06-15T08:45:00Z"},{id:"a2",type:"info",message:"System update scheduled for June 20, 2023",timestamp:"2023-06-14T10:00:00Z"}],...w}),r&&r.trackPageView("admin_dashboard",{userId:n.id})}catch(_){console.error("Error loading system status:",_),h("Failed to load system status. Please try again."),r&&r.trackEvent("admin_dashboard_error",{error:String(_)})}finally{o(!1)}})()},[i,n,r]);const b=(y,_)=>{v(_),r&&r.trackEvent("admin_tab_change",{tabIndex:_})},p=y=>y?new Date(y).toLocaleString():"Never";return a||s?e.jsx(x,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:e.jsx(ge,{})}):d?e.jsxs(x,{sx:{p:3,textAlign:"center"},children:[e.jsx(l,{color:"error",variant:"h6",gutterBottom:!0,children:d}),e.jsx(A,{variant:"contained",onClick:()=>window.location.reload(),sx:{mt:2},children:"Retry"})]}):t!=null&&t.is_admin?e.jsxs(x,{sx:{p:3,maxWidth:"1200px",mx:"auto"},children:[e.jsxs(x,{sx:{mb:4},children:[e.jsx(l,{variant:"h4",gutterBottom:!0,children:"Admin Dashboard"}),e.jsx(l,{variant:"body1",color:"text.secondary",children:"System monitoring and management"})]}),u.alerts.length>0&&e.jsx(x,{sx:{mb:4},children:u.alerts.map(y=>e.jsxs(je,{severity:y.type,sx:{mb:2},children:[e.jsx(l,{variant:"body1",children:y.message}),e.jsx(l,{variant:"body2",color:"text.secondary",children:p(y.timestamp)})]},y.id))}),e.jsxs(j,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(O,{elevation:2,sx:{height:"100%",borderRadius:2},children:[e.jsx(x,{sx:{p:2,bgcolor:"primary.main",color:"white",borderTopLeftRadius:8,borderTopRightRadius:8},children:e.jsx(l,{variant:"h6",children:"Users"})}),e.jsxs(rt,{children:[e.jsx(l,{variant:"h3",align:"center",gutterBottom:!0,children:u.users.total}),e.jsx(ie,{sx:{my:2}}),e.jsxs(j,{container:!0,spacing:1,children:[e.jsxs(j,{item:!0,xs:6,children:[e.jsx(l,{variant:"body2",color:"text.secondary",children:"Active:"}),e.jsx(l,{variant:"body1",children:u.users.active})]}),e.jsxs(j,{item:!0,xs:6,children:[e.jsx(l,{variant:"body2",color:"text.secondary",children:"Consultants:"}),e.jsx(l,{variant:"body1",children:u.users.consultants})]})]})]})]})}),e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(O,{elevation:2,sx:{height:"100%",borderRadius:2},children:[e.jsx(x,{sx:{p:2,bgcolor:"secondary.main",color:"white",borderTopLeftRadius:8,borderTopRightRadius:8},children:e.jsx(l,{variant:"h6",children:"Services"})}),e.jsxs(rt,{children:[e.jsx(l,{variant:"h3",align:"center",gutterBottom:!0,children:u.services.length}),e.jsx(ie,{sx:{my:2}}),e.jsxs(j,{container:!0,spacing:1,children:[e.jsxs(j,{item:!0,xs:6,children:[e.jsx(l,{variant:"body2",color:"text.secondary",children:"Healthy:"}),e.jsx(l,{variant:"body1",children:u.services.filter(y=>y.status==="healthy").length})]}),e.jsxs(j,{item:!0,xs:6,children:[e.jsx(l,{variant:"body2",color:"text.secondary",children:"Issues:"}),e.jsx(l,{variant:"body1",children:u.services.filter(y=>y.status!=="healthy").length})]})]})]})]})}),e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(O,{elevation:2,sx:{height:"100%",borderRadius:2},children:[e.jsx(x,{sx:{p:2,bgcolor:"success.main",color:"white",borderTopLeftRadius:8,borderTopRightRadius:8},children:e.jsx(l,{variant:"h6",children:"Database"})}),e.jsxs(rt,{children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",justifyContent:"center",mb:2},children:[e.jsx(l,{variant:"h6",align:"center",children:u.database.status==="healthy"?"Healthy":"Issues"}),u.database.status==="healthy"?e.jsx(yr,{color:"success",sx:{ml:1}}):e.jsx(Hr,{color:"error",sx:{ml:1}})]}),e.jsx(ie,{sx:{my:2}}),e.jsx(l,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Storage:"}),e.jsxs(x,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(x,{sx:{width:"100%",mr:1},children:e.jsx(kn,{variant:"determinate",value:u.database.storage.percentage,sx:{height:8,borderRadius:5}})}),e.jsx(x,{sx:{minWidth:35},children:e.jsxs(l,{variant:"body2",color:"text.secondary",children:[u.database.storage.percentage,"%"]})})]}),e.jsxs(l,{variant:"body2",children:[u.database.storage.used," / ",u.database.storage.total]})]})]})}),e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(O,{elevation:2,sx:{height:"100%",borderRadius:2},children:[e.jsx(x,{sx:{p:2,bgcolor:"info.main",color:"white",borderTopLeftRadius:8,borderTopRightRadius:8},children:e.jsx(l,{variant:"h6",children:"Today's Activity"})}),e.jsx(rt,{children:e.jsxs(j,{container:!0,spacing:1,children:[e.jsxs(j,{item:!0,xs:6,children:[e.jsx(l,{variant:"body2",color:"text.secondary",children:"Logins:"}),e.jsx(l,{variant:"h6",children:u.activity.logins[u.activity.logins.length-1]})]}),e.jsxs(j,{item:!0,xs:6,children:[e.jsx(l,{variant:"body2",color:"text.secondary",children:"Registrations:"}),e.jsx(l,{variant:"h6",children:u.activity.registrations[u.activity.registrations.length-1]})]}),e.jsxs(j,{item:!0,xs:6,children:[e.jsx(l,{variant:"body2",color:"text.secondary",children:"AI Queries:"}),e.jsx(l,{variant:"h6",children:u.activity.aiQueries[u.activity.aiQueries.length-1]})]}),e.jsxs(j,{item:!0,xs:6,children:[e.jsx(l,{variant:"body2",color:"text.secondary",children:"Help Requests:"}),e.jsx(l,{variant:"h6",children:u.activity.helpRequests[u.activity.helpRequests.length-1]})]})]})})]})})]}),e.jsxs(O,{sx:{mb:4,borderRadius:2,overflow:"hidden"},children:[e.jsxs(kr,{value:m,onChange:b,indicatorColor:"primary",textColor:"primary",variant:"fullWidth",children:[e.jsx(Se,{icon:e.jsx(jd,{}),label:"Services"}),e.jsx(Se,{icon:e.jsx(yd,{}),label:"Database"}),e.jsx(Se,{icon:e.jsx(sa,{}),label:"Users"}),e.jsx(Se,{icon:e.jsx(Yr,{}),label:"Content"})]}),e.jsxs(Vr,{value:m,index:0,children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Service Status"}),e.jsx(we,{children:u.services.map((y,_)=>e.jsxs(me,{sx:{mb:2,p:2,bgcolor:"background.paper",borderRadius:2,boxShadow:1},children:[e.jsx(gt,{children:y.status==="healthy"?e.jsx(yr,{color:"success"}):y.status==="degraded"?e.jsx(ns,{color:"warning"}):e.jsx(Hr,{color:"error"})}),e.jsx(xe,{primary:y.name,secondary:e.jsx(e.Fragment,{children:e.jsxs(l,{component:"span",variant:"body2",children:["Uptime: ",y.uptime," • Last Issue: ",p(y.lastIssue)]})})}),e.jsx(_e,{label:y.status,color:y.status==="healthy"?"success":y.status==="degraded"?"warning":"error"})]},_))})]}),e.jsxs(Vr,{value:m,index:1,children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Database Status"}),e.jsx(O,{sx:{p:3,mb:3},children:e.jsxs(j,{container:!0,spacing:3,children:[e.jsxs(j,{item:!0,xs:12,md:4,children:[e.jsx(l,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Status:"}),e.jsxs(x,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(l,{variant:"h6",children:u.database.status==="healthy"?"Healthy":"Issues"}),u.database.status==="healthy"?e.jsx(yr,{color:"success",sx:{ml:1}}):e.jsx(Hr,{color:"error",sx:{ml:1}})]})]}),e.jsxs(j,{item:!0,xs:12,md:4,children:[e.jsx(l,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Connection Pool:"}),e.jsx(l,{variant:"h6",children:u.database.connectionPool})]}),e.jsxs(j,{item:!0,xs:12,md:4,children:[e.jsx(l,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Average Query Time:"}),e.jsx(l,{variant:"h6",children:u.database.avgQueryTime})]})]})}),e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Storage Usage"}),e.jsxs(O,{sx:{p:3},children:[e.jsxs(l,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[u.database.storage.used," used of ",u.database.storage.total," total"]}),e.jsx(kn,{variant:"determinate",value:u.database.storage.percentage,sx:{height:10,borderRadius:5,mb:2}}),e.jsxs(j,{container:!0,spacing:2,children:[e.jsx(j,{item:!0,xs:12,sm:4,children:e.jsxs(O,{sx:{p:2,bgcolor:"primary.light"},children:[e.jsx(l,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"User Data"}),e.jsx(l,{variant:"h6",children:"0.5GB"})]})}),e.jsx(j,{item:!0,xs:12,sm:4,children:e.jsxs(O,{sx:{p:2,bgcolor:"secondary.light"},children:[e.jsx(l,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Book Content"}),e.jsx(l,{variant:"h6",children:"1.2GB"})]})}),e.jsx(j,{item:!0,xs:12,sm:4,children:e.jsxs(O,{sx:{p:2,bgcolor:"info.light"},children:[e.jsx(l,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Analytics"}),e.jsx(l,{variant:"h6",children:"0.6GB"})]})})]})]})]}),e.jsxs(Vr,{value:m,index:2,children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"User Statistics"}),e.jsxs(j,{container:!0,spacing:3,children:[e.jsx(j,{item:!0,xs:12,md:6,children:e.jsxs(O,{sx:{p:3,height:"100%"},children:[e.jsx(l,{variant:"subtitle1",gutterBottom:!0,children:"User Breakdown"}),e.jsx(x,{sx:{display:"flex",justifyContent:"center",p:3},children:e.jsx(l,{variant:"body1",color:"text.secondary",children:"[Pie Chart Visualization]"})}),e.jsxs(j,{container:!0,spacing:2,children:[e.jsxs(j,{item:!0,xs:6,children:[e.jsx(l,{variant:"body2",color:"text.secondary",children:"Readers:"}),e.jsx(l,{variant:"h6",children:u.users.total-u.users.consultants-u.users.admins})]}),e.jsxs(j,{item:!0,xs:6,children:[e.jsx(l,{variant:"body2",color:"text.secondary",children:"Consultants:"}),e.jsx(l,{variant:"h6",children:u.users.consultants})]}),e.jsxs(j,{item:!0,xs:6,children:[e.jsx(l,{variant:"body2",color:"text.secondary",children:"Admins:"}),e.jsx(l,{variant:"h6",children:u.users.admins})]}),e.jsxs(j,{item:!0,xs:6,children:[e.jsx(l,{variant:"body2",color:"text.secondary",children:"Active Users:"}),e.jsx(l,{variant:"h6",children:u.users.active})]})]})]})}),e.jsx(j,{item:!0,xs:12,md:6,children:e.jsxs(O,{sx:{p:3,height:"100%"},children:[e.jsx(l,{variant:"subtitle1",gutterBottom:!0,children:"Registration Trend"}),e.jsx(x,{sx:{display:"flex",justifyContent:"center",p:3},children:e.jsx(l,{variant:"body1",color:"text.secondary",children:"[Line Chart Visualization]"})}),e.jsxs(j,{container:!0,spacing:2,children:[e.jsxs(j,{item:!0,xs:6,children:[e.jsx(l,{variant:"body2",color:"text.secondary",children:"Today:"}),e.jsx(l,{variant:"h6",children:u.activity.registrations[u.activity.registrations.length-1]})]}),e.jsxs(j,{item:!0,xs:6,children:[e.jsx(l,{variant:"body2",color:"text.secondary",children:"This Week:"}),e.jsx(l,{variant:"h6",children:u.activity.registrations.reduce((y,_)=>y+_,0)})]}),e.jsx(j,{item:!0,xs:12,children:e.jsx(A,{variant:"outlined",fullWidth:!0,component:U,to:"/admin/users",children:"View User Management"})})]})]})})]})]}),e.jsxs(Vr,{value:m,index:3,children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Content Management"}),e.jsxs(j,{container:!0,spacing:3,children:[e.jsx(j,{item:!0,xs:12,md:6,children:e.jsxs(O,{sx:{p:3},children:[e.jsx(l,{variant:"subtitle1",gutterBottom:!0,children:"Books"}),e.jsx(we,{children:e.jsxs(me,{children:[e.jsx(gt,{children:e.jsx(Yr,{})}),e.jsx(xe,{primary:"Alice in Wonderland",secondary:"Active • 125 readers"}),e.jsx(A,{variant:"outlined",size:"small",component:U,to:"/admin/books/alice-in-wonderland",children:"Manage"})]})}),e.jsx(A,{variant:"contained",fullWidth:!0,component:U,to:"/admin/books/add",sx:{mt:2},children:"Add New Book"})]})}),e.jsx(j,{item:!0,xs:12,md:6,children:e.jsxs(O,{sx:{p:3},children:[e.jsx(l,{variant:"subtitle1",gutterBottom:!0,children:"Content Statistics"}),e.jsxs(j,{container:!0,spacing:2,sx:{mb:3},children:[e.jsxs(j,{item:!0,xs:6,children:[e.jsx(l,{variant:"body2",color:"text.secondary",children:"Total Books:"}),e.jsx(l,{variant:"h6",children:"1"})]}),e.jsxs(j,{item:!0,xs:6,children:[e.jsx(l,{variant:"body2",color:"text.secondary",children:"Total Pages:"}),e.jsx(l,{variant:"h6",children:"100"})]}),e.jsxs(j,{item:!0,xs:6,children:[e.jsx(l,{variant:"body2",color:"text.secondary",children:"Dictionary Entries:"}),e.jsx(l,{variant:"h6",children:"2,500"})]}),e.jsxs(j,{item:!0,xs:6,children:[e.jsx(l,{variant:"body2",color:"text.secondary",children:"AI Prompts:"}),e.jsx(l,{variant:"h6",children:"150"})]})]}),e.jsx(A,{variant:"outlined",fullWidth:!0,component:U,to:"/admin/content",children:"View Content Dashboard"})]})})]})]})]}),e.jsxs(O,{sx:{p:3,borderRadius:2},children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Quick Actions"}),e.jsx(ie,{sx:{mb:2}}),e.jsxs(j,{container:!0,spacing:2,children:[e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsx(A,{variant:"outlined",fullWidth:!0,component:U,to:"/admin/users",sx:{py:1.5},children:"User Management"})}),e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsx(A,{variant:"outlined",fullWidth:!0,component:U,to:"/admin/services",sx:{py:1.5},children:"Service Status"})}),e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsx(A,{variant:"outlined",fullWidth:!0,component:U,to:"/admin/logs",sx:{py:1.5},children:"System Logs"})}),e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsx(A,{variant:"outlined",fullWidth:!0,component:U,to:"/admin/settings",sx:{py:1.5},children:"System Settings"})}),e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsx(A,{variant:"contained",color:"primary",fullWidth:!0,component:U,to:"/proxy-settings",sx:{py:1.5},children:"Proxy Settings"})})]})]})]}):e.jsxs(x,{sx:{p:3,textAlign:"center"},children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"You don't have admin access."}),e.jsx(A,{variant:"contained",component:U,to:"/reader",sx:{mt:2},children:"Go to Reader Dashboard"})]})},Qi={host:"",port:8080,username:"",password:"",enabled:!1},wd=()=>{const{user:n}=ke(),[t,r]=g.useState(Qi),[i,s]=g.useState(!1),[a,o]=g.useState(""),[d,h]=g.useState("success");g.useEffect(()=>{const b=localStorage.getItem("proxy_settings");if(b)try{const p=JSON.parse(b);r(p),c("ProxySettings","Loaded proxy settings from localStorage","info")}catch(p){c("ProxySettings","Error parsing saved proxy settings","error"),console.error("Error parsing saved proxy settings:",p)}},[]);const u=b=>{const{name:p,value:y,type:_,checked:w}=b.target;r(S=>({...S,[p]:_==="checkbox"?w:y}))},f=b=>{b.preventDefault();try{localStorage.setItem("proxy_settings",JSON.stringify(t)),o("Proxy settings saved successfully. Please refresh the page for changes to take effect."),h("success"),s(!0),c("ProxySettings","Proxy settings saved","success")}catch(p){o("Error saving proxy settings"),h("error"),s(!0),c("ProxySettings","Error saving proxy settings","error"),console.error("Error saving proxy settings:",p)}},m=()=>{s(!1)},v=()=>{r(Qi),localStorage.removeItem("proxy_settings"),o("Proxy settings reset to defaults"),h("success"),s(!0),c("ProxySettings","Proxy settings reset to defaults","info")};return e.jsxs(x,{sx:{maxWidth:800,mx:"auto",p:3},children:[e.jsx(l,{variant:"h4",gutterBottom:!0,children:"Proxy Settings"}),e.jsxs(O,{sx:{p:3,mb:3},children:[e.jsx(l,{variant:"body1",paragraph:!0,children:"Configure proxy settings for connecting to Supabase through a corporate proxy. These settings will be saved in your browser's local storage."}),e.jsx(je,{severity:"info",sx:{mb:3},children:"After saving your proxy settings, you'll need to refresh the page for the changes to take effect."}),e.jsxs("form",{onSubmit:f,children:[e.jsx(pr,{control:e.jsx(Nr,{checked:t.enabled,onChange:u,name:"enabled",color:"primary"}),label:"Enable Proxy",sx:{mb:2,display:"block"}}),e.jsx(he,{label:"Proxy Host",name:"host",value:t.host,onChange:u,fullWidth:!0,margin:"normal",disabled:!t.enabled,placeholder:"e.g., proxy.company.com",helperText:"Your corporate proxy server hostname or IP address"}),e.jsx(he,{label:"Proxy Port",name:"port",type:"number",value:t.port,onChange:u,fullWidth:!0,margin:"normal",disabled:!t.enabled,placeholder:"e.g., 8080",helperText:"The port number for your proxy server"}),e.jsx(l,{variant:"subtitle1",sx:{mt:2},children:"Authentication (Optional)"}),e.jsx(he,{label:"Username",name:"username",value:t.username,onChange:u,fullWidth:!0,margin:"normal",disabled:!t.enabled,helperText:"Username for proxy authentication (if required)"}),e.jsx(he,{label:"Password",name:"password",type:"password",value:t.password,onChange:u,fullWidth:!0,margin:"normal",disabled:!t.enabled,helperText:"Password for proxy authentication (if required)"}),e.jsxs(x,{sx:{mt:3,display:"flex",justifyContent:"space-between"},children:[e.jsx(A,{variant:"outlined",color:"secondary",onClick:v,children:"Reset to Defaults"}),e.jsx(A,{type:"submit",variant:"contained",color:"primary",disabled:!t.enabled||!t.host,children:"Save Settings"})]})]})]}),e.jsx(Ji,{open:i,autoHideDuration:6e3,onClose:m,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(je,{onClose:m,severity:d,children:a})})]})},kd=()=>{const[n,t]=g.useState(!1),[r,i]=g.useState(null),[s,a]=g.useState("unknown"),[o,d]=g.useState([]),[h,u]=g.useState(!1),[f,m]=g.useState("");g.useEffect(()=>{try{const b=localStorage.getItem("proxy_settings");if(b){const p=JSON.parse(b);u(p.enabled||!1),m(p.host||"Not configured")}else m("Not configured")}catch(b){console.error("Error loading proxy settings:",b),m("Error loading settings")}},[]);const v=async()=>{t(!0),i(null),d([]),a("unknown");const b=[];try{c("SupabaseTest","Starting Supabase connection tests","info");try{const p=await z();b.push({name:"Initialize Supabase Client",status:"success",message:"Supabase client initialized successfully"});try{const y=performance.now(),{data:_,error:w}=await p.from("books").select("count").limit(1),S=performance.now();if(w)throw w;b.push({name:"Ping Supabase",status:"success",message:`Connected to Supabase in ${Math.round(S-y)}ms`});try{const{data:k,error:I}=await p.from("books").select("id, title, author").limit(5);if(I)throw I;b.push({name:"Fetch Books",status:"success",message:`Successfully fetched ${(k==null?void 0:k.length)||0} books`});try{const{data:E,error:$}=await p.auth.getSession();if($)throw $;b.push({name:"Check Auth",status:"success",message:E!=null&&E.session?"User is authenticated":"No active session"}),a("success")}catch(E){b.push({name:"Check Auth",status:"error",message:`Auth error: ${E.message}`}),a("error")}}catch(k){b.push({name:"Fetch Books",status:"error",message:`Error fetching books: ${k.message}`}),a("error")}}catch(y){b.push({name:"Ping Supabase",status:"error",message:`Error connecting to Supabase: ${y.message}`}),a("error")}}catch(p){b.push({name:"Initialize Supabase Client",status:"error",message:`Error initializing Supabase client: ${p.message}`}),a("error")}}catch(p){i(`An unexpected error occurred: ${p.message}`),a("error")}finally{d(b),t(!1),c("SupabaseTest","Supabase connection tests completed","info")}};return e.jsxs(x,{sx:{maxWidth:800,mx:"auto",p:3},children:[e.jsx(l,{variant:"h4",gutterBottom:!0,children:"Supabase Connection Test"}),e.jsxs(O,{sx:{p:3,mb:3},children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Configuration"}),e.jsxs(x,{sx:{mb:2},children:[e.jsxs(l,{variant:"body1",children:[e.jsx("strong",{children:"Backend Mode:"})," "," ",e.jsx("span",{style:{color:"#2196f3",fontWeight:"bold"},children:"REAL Supabase"})]}),e.jsxs(l,{variant:"body1",children:[e.jsx("strong",{children:"Proxy Status:"})," "," ",e.jsx("span",{style:{color:h?"#4caf50":"#f44336",fontWeight:"bold"},children:h?"ENABLED":"DISABLED"})]}),h&&e.jsxs(l,{variant:"body1",children:[e.jsx("strong",{children:"Proxy Host:"})," ",f]})]}),e.jsx(A,{variant:"contained",color:"primary",onClick:v,disabled:n,startIcon:n?e.jsx(ge,{size:20,color:"inherit"}):null,children:n?"Testing...":"Run Connection Test"})]}),s!=="unknown"&&e.jsxs(O,{sx:{p:3},children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Test Results"}),s==="success"?e.jsx(je,{severity:"success",sx:{mb:2},children:"Successfully connected to Supabase!"}):e.jsx(je,{severity:"error",sx:{mb:2},children:"Failed to connect to Supabase. Check the test results below for details."}),r&&e.jsx(je,{severity:"error",sx:{mb:2},children:r}),e.jsx(we,{children:o.map((b,p)=>e.jsxs(Z.Fragment,{children:[e.jsx(me,{children:e.jsx(xe,{primary:e.jsxs(x,{sx:{display:"flex",alignItems:"center"},children:[e.jsx("span",{style:{color:b.status==="success"?"#4caf50":"#f44336",marginRight:"8px",fontWeight:"bold"},children:b.status==="success"?"✓":"✗"}),e.jsx("span",{style:{fontWeight:"bold"},children:b.name})]}),secondary:b.message})}),p<o.length-1&&e.jsx(ie,{})]},p))})]})]})},Ed=()=>{const n=Ze(),[t,r]=g.useState([]),[i,s]=g.useState(!0),[a,o]=g.useState(null);g.useEffect(()=>{(async()=>{try{c("ReaderListView","Fetching verified readers","info");const u=await $s();r(u),o(null)}catch(u){const f=u instanceof Error?u.message:"Failed to fetch readers";o(f),c("ReaderListView",`Error fetching readers: ${f}`,"error")}finally{s(!1)}})()},[]);const d=h=>{c("ReaderListView",`Navigating to reader profile: ${h}`,"info"),n(`/consultant-dashboard/reader/${h}`)};return i?e.jsx(x,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px",children:e.jsx(ge,{})}):a?e.jsx(je,{severity:"error",sx:{mb:2},children:a}):t.length===0?e.jsx(l,{variant:"body1",color:"text.secondary",align:"center",children:"No verified readers found."}):e.jsx(Ki,{component:O,children:e.jsxs(Xi,{children:[e.jsx(es,{children:e.jsxs(vr,{children:[e.jsx(ae,{children:"Name"}),e.jsx(ae,{children:"Email"}),e.jsx(ae,{children:"Book Verified"}),e.jsx(ae,{children:"Joined"})]})}),e.jsx(ts,{children:t.map(h=>e.jsxs(vr,{hover:!0,sx:{cursor:"pointer","&:hover":{backgroundColor:"action.hover"}},onClick:()=>d(h.id),children:[e.jsxs(ae,{children:[h.first_name," ",h.last_name]}),e.jsx(ae,{children:h.email}),e.jsx(ae,{children:h.book_verified?"Yes":"No"}),e.jsx(ae,{children:new Date(h.created_at).toLocaleDateString()})]},h.id))})]})})};function yn(n){const{children:t,value:r,index:i,...s}=n;return e.jsx("div",{role:"tabpanel",hidden:r!==i,id:`consultant-tabpanel-${i}`,"aria-labelledby":`consultant-tab-${i}`,...s,children:r===i&&e.jsx(x,{sx:{p:3},children:t})})}function bn(n){return{id:`consultant-tab-${n}`,"aria-controls":`consultant-tabpanel-${n}`}}const Cd=()=>{const[n,t]=g.useState(0),r=(i,s)=>{c("ConsultantDashboard",`Switching to tab ${s}`,"info"),t(s)};return e.jsxs(x,{sx:{width:"100%",p:3},children:[e.jsx(l,{variant:"h4",component:"h1",gutterBottom:!0,children:"Consultant Dashboard"}),e.jsx(O,{sx:{width:"100%",mb:2},children:e.jsxs(kr,{value:n,onChange:r,"aria-label":"consultant dashboard tabs",children:[e.jsx(Se,{label:"Reader List",...bn(0)}),e.jsx(Se,{label:"Help Requests",...bn(1)}),e.jsx(Se,{label:"Analytics",...bn(2)})]})}),e.jsx(yn,{value:n,index:0,children:e.jsx(Ed,{})}),e.jsx(yn,{value:n,index:1,children:e.jsx(l,{children:"Help Requests (Coming Soon)"})}),e.jsx(yn,{value:n,index:2,children:e.jsx(l,{children:"Analytics (Coming Soon)"})})]})},Rd=()=>{const n=g.useContext(zn);if(n===void 0)throw new Error("useAuth must be used within an AuthProvider");return n},Id=({children:n,requiredRole:t})=>{const{user:r,loading:i,isConsultant:s}=Rd(),a=mt();return i?null:r?t==="consultant"&&!s()?(c("ProtectedRoute","User not authorized as consultant, redirecting to home","warning"),e.jsx(Fe,{to:"/",replace:!0})):e.jsx(e.Fragment,{children:n}):(c("ProtectedRoute","User not authenticated, redirecting to login","info"),e.jsx(Fe,{to:"/login",state:{from:a},replace:!0}))},Ad=()=>e.jsxs("div",{style:{padding:"20px",maxWidth:"800px",margin:"0 auto"},children:[e.jsx("h1",{children:"Simple Test Page"}),e.jsx("p",{children:"This is a simple test page that doesn't rely on any services."}),e.jsx("p",{children:"If you can see this, the basic React rendering is working."}),e.jsxs("div",{style:{marginTop:"20px",padding:"10px",background:"#e8f5e9",border:"1px solid #81c784"},children:[e.jsx("h2",{children:"Debug Information"}),e.jsx("p",{children:"React is working correctly if this component renders."}),e.jsxs("p",{children:["Current URL: ",window.location.href]}),e.jsxs("p",{children:["Timestamp: ",new Date().toISOString()]})]}),e.jsx("button",{onClick:()=>alert("Button clicked!"),style:{marginTop:"20px",padding:"10px 20px",background:"#2196f3",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Click Me"})]}),Pd=()=>{const[n,t]=g.useState(!0),[r,i]=g.useState(null),[s,a]=g.useState([]),[o,d]=g.useState("unknown");return g.useEffect(()=>{async function h(){try{console.log("TestSupabase: Testing Supabase connection...");const u="https://blwypdcobizmpidmuhvq.supabase.co",f="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJsd3lwZGNvYml6bXBpZG11aHZxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQyMDgzNDcsImV4cCI6MjA1OTc4NDM0N30.YP2r-CnSaM4rKclXBivanAMBQh9sMsI95F2p87zIuWM";console.log("TestSupabase: Using Supabase URL:",u),console.log("TestSupabase: Supabase Key present:",!!f);const m=Tn(u,f),{data:v,error:b}=await m.from("books").select("id, title, author").limit(5);if(b)throw b;console.log("TestSupabase: Data fetched successfully:",v),a(v||[]),d("success")}catch(u){console.error("TestSupabase: Error testing Supabase:",u),i(u.message||"Unknown error"),d("error")}finally{t(!1)}}h()},[]),e.jsxs("div",{style:{padding:"20px",maxWidth:"800px",margin:"0 auto"},children:[e.jsx("h1",{children:"Supabase Test Page"}),e.jsx("p",{children:"This page tests the basic Supabase connection."}),e.jsxs("div",{style:{marginTop:"20px",padding:"10px",background:o==="success"?"#e8f5e9":o==="error"?"#ffebee":"#e3f2fd",border:o==="success"?"1px solid #81c784":o==="error"?"1px solid #e57373":"1px solid #90caf9"},children:[e.jsx("h2",{children:"Connection Status"}),n?e.jsx("p",{children:"Testing Supabase connection..."}):o==="success"?e.jsx("p",{children:"✅ Connected to Supabase successfully!"}):e.jsxs("p",{children:["❌ Failed to connect to Supabase: ",r]})]}),o==="success"&&e.jsxs("div",{style:{marginTop:"20px"},children:[e.jsx("h2",{children:"Books from Database"}),s.length===0?e.jsx("p",{children:"No books found in the database."}):e.jsx("ul",{style:{listStyleType:"none",padding:0},children:s.map(h=>e.jsxs("li",{style:{padding:"10px",margin:"5px 0",background:"#f5f5f5",borderRadius:"4px"},children:[e.jsx("strong",{children:h.title})," by ",h.author]},h.id))})]}),e.jsxs("div",{style:{marginTop:"20px"},children:[e.jsx("h2",{children:"Environment Variables"}),e.jsxs("p",{children:["VITE_SUPABASE_URL exists: ","✅"]}),e.jsxs("p",{children:["VITE_SUPABASE_ANON_KEY exists: ","✅"]})]}),e.jsx("button",{onClick:()=>window.location.reload(),style:{marginTop:"20px",padding:"10px 20px",background:"#2196f3",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Reload Page"})]})},Td=async()=>{c("Services","Initializing services using new registry pattern","info"),console.log("Services: Initializing services using new registry pattern");try{console.log("Services: Importing serviceInitializers module");const n=await be(()=>Promise.resolve().then(()=>$c),void 0);if(console.log("Services: serviceInitializers module imported:",n),typeof n.initializeServices!="function")throw console.error("Services: initializeServices is not a function in the imported module:",n),new Error("initializeServices is not a function in the serviceInitializers module");console.log("Services: Calling initializeServices from serviceInitializers"),n.initializeServices(),console.log("Services: Manually initializing authService");const{createAuthService:t}=await be(async()=>{const{createAuthService:i}=await Promise.resolve().then(()=>Ss);return{createAuthService:i}},void 0);console.log("Services: authService module imported, createAuthService:",t),console.log("Services: Manually initializing bookService");const{createBookService:r}=await be(async()=>{const{createBookService:i}=await Promise.resolve().then(()=>Os);return{createBookService:i}},void 0);return console.log("Services: bookService module imported, createBookService:",r),c("Services","Services initialized successfully","success"),console.log("Services: Services initialized successfully"),!0}catch(n){return c("Services",`Error initializing services: ${n.message}`,"error"),console.error("Services: Error initializing services:",n),!1}};function Dd(){console.log("App.tsx: Component rendering");const[n,t]=g.useState(!1),[r,i]=g.useState(null);if(g.useEffect(()=>{const a=async()=>{try{c("App","Initializing services","info"),console.log("App: Initializing services - VERBOSE DEBUG"),console.log("App: Environment check - VITE_SUPABASE_URL exists:",!0),console.log("App: Environment check - VITE_SUPABASE_ANON_KEY exists:",!0),console.log("App: About to call initializeServices()");const o=await Td();console.log("App: Services initialization result:",o),console.log("App: Setting initialized state to true"),t(!0),c("App","Services initialized successfully","success"),console.log("App: Services initialized successfully")}catch(o){console.error("App: Failed to initialize services:",o),console.error("App: Error details:",o.stack||"No stack trace available"),c("App",`Failed to initialize services: ${o.message}`,"error"),i("Failed to initialize application. Please check the console for details.")}};console.log("App: Running init effect"),a()},[]),r)return e.jsxs("div",{className:"error-container",children:[e.jsx("h2",{children:"Initialization Error"}),e.jsx("p",{children:r}),e.jsx("button",{onClick:()=>window.location.reload(),children:"Retry"})]});if(!n)return e.jsxs("div",{className:"loading-container",children:[e.jsx("h2",{children:"Initializing Application..."}),e.jsx("p",{children:"Please wait while the services are being initialized."})]});const s=()=>e.jsx(Ea,{children:e.jsxs("div",{className:"App",children:[e.jsx(_c,{contentId:"main-content"}),e.jsx(Tc,{}),e.jsx("main",{id:"main-content",children:e.jsxs(Ca,{children:[e.jsx(ce,{path:"/",element:e.jsx(ye,{routeType:"public",children:e.jsx(Hc,{})})}),e.jsx(ce,{path:"/login",element:e.jsx(ye,{routeType:"public",children:e.jsx(Gc,{})})}),e.jsx(ce,{path:"/register",element:e.jsx(ye,{routeType:"public",children:e.jsx(Qc,{})})}),e.jsx(ce,{path:"/forgot-password",element:e.jsx(ye,{routeType:"public",children:e.jsx(Jc,{})})}),e.jsx(ce,{path:"/verify",element:e.jsx(ye,{routeType:"auth",children:e.jsx(Zc,{})})}),e.jsx(ce,{path:"/reader",element:e.jsx(ye,{routeType:"verified",children:e.jsx(cl,{})})}),e.jsx(ce,{path:"/reader/interaction",element:e.jsx(ye,{routeType:"verified",children:e.jsx(qi,{})})}),e.jsx(ce,{path:"/reader/book/:bookId",element:e.jsx(ye,{routeType:"verified",children:e.jsx(qi,{})})}),e.jsx(ce,{path:"/reader/:bookId/page/:pageNumber",element:e.jsx(ye,{routeType:"verified",children:e.jsx(_l,{})})}),e.jsx(ce,{path:"/reader/statistics",element:e.jsx(ye,{routeType:"verified",children:e.jsx(Ol,{})})}),e.jsx(ce,{path:"/consultant",element:e.jsx(ye,{routeType:"verified",children:e.jsx(Kl,{})})}),e.jsx(ce,{path:"/consultant/readers",element:e.jsx(ye,{routeType:"verified",children:e.jsx(ud,{})})}),e.jsx(ce,{path:"/consultant/help-requests",element:e.jsx(ye,{routeType:"verified",children:e.jsx(md,{})})}),e.jsx(ce,{path:"/consultant-dashboard",element:e.jsx(ye,{routeType:"verified",children:e.jsx(Id,{requiredRole:"consultant",children:e.jsx(Cd,{})})})}),e.jsx(ce,{path:"/admin",element:e.jsx(ye,{routeType:"admin",children:e.jsx(_d,{})})}),e.jsx(ce,{path:"/service-status",element:e.jsx(ye,{routeType:"admin",children:e.jsx(Mo,{})})}),e.jsx(ce,{path:"/proxy-settings",element:e.jsx(wd,{})}),e.jsx(ce,{path:"/supabase-test",element:e.jsx(kd,{})}),!1,!1,!1,e.jsx(ce,{path:"/test-simple",element:e.jsx(Ad,{})}),e.jsx(ce,{path:"/test-supabase",element:e.jsx(Pd,{})})]})})]})});return e.jsx(wc,{children:e.jsx(Fo,{children:e.jsx(jc,{children:e.jsx(s,{})})})})}const Fd=Object.freeze(Object.defineProperty({__proto__:null,default:Dd},Symbol.toStringTag,{value:"Module"}));export{Fd as A,Le as I,Bd as d,Ud as g,q as h,Ne as l,Vd as s};
